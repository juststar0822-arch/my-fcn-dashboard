<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å…ƒå…ƒè‡´å¯Œç”Ÿå‘½åŠ›è©¦ç®— - å°ˆæ¥­å£½éšªæˆæœ¬åˆ†æ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        body { background: #0f172a; color: #f1f5f9; font-family: sans-serif; }
        .input-group { background: #1e293b; padding: 15px; border-radius: 12px; border: 1px solid #334155; }
        input, select { background: #334155; border: 1px solid #475569; color: white; padding: 8px; border-radius: 6px; width: 100%; }
        .data-card { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 1px solid #38bdf8; }
    </style>
</head>
<body class="p-6">
<div id="app" class="max-w-5xl mx-auto">
    <h1 class="text-3xl font-bold mb-8 text-blue-400 text-center">ğŸ“Š å…ƒå…ƒè‡´å¯Œä¿å–®ç”Ÿå‘½åŠ›è©¦ç®—ç³»çµ±</h1>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="lg:col-span-1 space-y-6">
            <div class="input-group shadow-lg">
                <h3 class="text-blue-300 font-bold mb-4 flex items-center">ğŸ’° è³‡ç”¢è¦æ¨¡ (å°å¹£)</h3>
                <input type="number" v-model="principal" class="text-xl font-bold text-yellow-400">
                <div class="mt-3 flex justify-between text-sm font-mono text-gray-400">
                    <span>USD: ${{ formatCurr(principal/32.5) }}</span>
                    <span>JPY: Â¥{{ formatCurr(principal*4.5) }}</span>
                </div>
            </div>

            <div class="input-group shadow-lg">
                <h3 class="text-green-300 font-bold mb-4">ğŸ›¡ï¸ ä¿éšœèˆ‡å¸‚å ´å‡è¨­</h3>
                <div class="space-y-4">
                    <div>
                        <label class="text-xs text-gray-400">åŸºæœ¬ä¿é¡ (NTD)</label>
                        <input type="number" v-model="faceAmount">
                    </div>
                    <div>
                        <label class="text-xs text-gray-400">å¸‚å ´å³æ™‚è™§æ (%)</label>
                        <input type="number" v-model="marketChange">
                    </div>
                    <div>
                        <label class="text-xs text-gray-400">å¹´åŒ–é…æ¯ç‡ (%)</label>
                        <input type="number" v-model="divRate" step="0.1">
                    </div>
                </div>
            </div>

            <div class="input-group shadow-lg">
                <h3 class="text-purple-300 font-bold mb-4">ğŸ”„ æ”¶ç›Šåˆ†é…</h3>
                <label class="text-xs text-gray-400">é…æ¯ã€Œé ˜èµ°ã€æ¯”ä¾‹ (%)</label>
                <input type="range" min="0" max="100" v-for="n in 1" v-model="withdrawRatio" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-500">
                <div class="flex justify-between text-xs mt-2">
                    <span>å†æŠ•è³‡: {{ 100 - withdrawRatio }}%</span>
                    <span class="text-purple-400 font-bold">é ˜èµ°: {{ withdrawRatio }}%</span>
                </div>
            </div>
        </div>

        <div class="lg:col-span-2 space-y-6">
            <div class="data-card p-8 rounded-2xl shadow-2xl">
                <div class="text-gray-400 text-sm mb-2">é ä¼°ä¿éšœå¯æ”¯æ’å¹´é™</div>
                <div class="flex items-baseline gap-2">
                    <span class="text-7xl font-black text-white">{{ survivalYears }}</span>
                    <span class="text-2xl text-blue-400">å¹´</span>
                </div>
                <div class="mt-4 p-3 bg-blue-500/10 rounded-lg border border-blue-500/30 text-blue-200 text-sm">
                    æ­¤è©¦ç®—ä»¥ <strong>40 æ­²å¥³æ€§</strong> èµ·ç®—ï¼Œè€ƒæ…®é€å¹´è·³å‡ä¹‹å£½éšªæˆæœ¬è²»ç‡ã€‚<br>
                    å¸³æˆ¶é è¨ˆåœ¨ <strong>{{ age + survivalYears }} æ­²</strong> æ™‚å› é¤˜é¡ä¸è¶³è€Œå¤±æ•ˆã€‚
                </div>
            </div>

            <div class="bg-slate-800 rounded-xl overflow-hidden border border-gray-700">
                <table class="w-full text-sm text-left">
                    <thead class="bg-slate-700 text-gray-300">
                        <tr>
                            <th class="p-4">å¹´åº¦(å¹´é½¡)</th>
                            <th class="p-4 text-right">å¸³æˆ¶åƒ¹å€¼</th>
                            <th class="p-4 text-right">æ·¨å±éšªä¿é¡(NAR)</th>
                            <th class="p-4 text-right">æ¯æœˆå£½éšªæˆæœ¬</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="row in simulation" :key="row.age" class="border-b border-gray-700 hover:bg-slate-700/50">
                            <td class="p-4 font-mono">{{ row.year }} ({{ row.age }}æ­²)</td>
                            <td class="p-4 text-right font-bold" :class="row.balance < 100000 ? 'text-red-400' : 'text-green-400'">
                                {{ formatNum(row.balance) }}
                            </td>
                            <td class="p-4 text-right text-gray-400">{{ formatNum(row.nar) }}</td>
                            <td class="p-4 text-right text-red-300">{{ formatNum(row.monthlyCOI) }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
const { createApp, ref, computed } = Vue;

// æ ¹æ“šä¸Šå‚³åœ–ç‰‡æ•´åˆä¹‹ 40 æ­²å¾Œå¥³æ€§è²»ç‡
const COI_TABLE = {
    40: 0.55, 41: 0.59, 42: 0.64, 43: 0.69, 44: 0.74, 45: 0.85, 46: 0.91, 47: 0.98, 48: 1.05, 49: 1.13,
    50: 1.19, 51: 1.27, 52: 1.37, 53: 1.46, 54: 1.56, 55: 1.80, 60: 2.77, 65: 4.67, 70: 8.10, 75: 13.61, 80: 23.99
};

createApp({
    setup() {
        const age = ref(40);
        const principal = ref(500000);
        const faceAmount = ref(10000000);
        const marketChange = ref(-30);
        const divRate = ref(7.3);
        const withdrawRatio = ref(100);

        const formatNum = (v) => Math.round(v).toLocaleString();
        const formatCurr = (v) => v.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0});

        // æ ¸å¿ƒè©¦ç®—é‚è¼¯
        const runSim = (isFull) => {
            let bal = principal.value * (1 + marketChange.value / 100);
            let results = [];
            
            for (let y = 0; y <= 60; y++) {
                let curAge = age.value + y;
                // è²»ç‡è¡¨å–å€¼æˆ–ç·šæ€§æ’è£œ
                let factor = COI_TABLE[curAge] || (COI_TABLE[Math.floor(curAge/5)*5] * Math.pow(1.1, curAge%5));
                
                let nar = Math.max(0, faceAmount.value - bal);
                let mCOI = (nar / 10000) * factor;
                let mAdmin = (bal * 0.0016) + 100;
                let mDiv = (bal * (divRate.value/100) / 12);

                if (y % 5 === 0 && results.length < 10) {
                    results.push({ year: y, age: curAge, balance: bal, nar: nar, monthlyCOI: mCOI });
                }

                // æœˆå¸³æˆ¶è®ŠåŒ–
                let monthlyNet = (mDiv * (1 - withdrawRatio.value/100)) - (mCOI + mAdmin);
                bal += (monthlyNet * 12);
                
                if (bal <= 0) return isFull ? y : results;
            }
            return isFull ? 60 : results;
        };

        const simulation = computed(() => runSim(false));
        const survivalYears = computed(() => runSim(true));

        return { age, principal, faceAmount, marketChange, divRate, withdrawRatio, simulation, survivalYears, formatNum, formatCurr };
    }
}).mount('#app');
</script>
</body>
</html>