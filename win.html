<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶…ç´šæ¥­å‹™æ¦®è­½æ¦œç”Ÿæˆå™¨</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --gold-dark: #B78628;
            --gold: #FCC201;
            --red: #D93025;
            --dark-red: #8B0000;
            --blue: #1A237E;
            --paper: #FFFDF5;
        }

        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #333;
        }

        /* è¼¸å…¥å€å¡Š */
        .controls {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 800px;
            margin-bottom: 30px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr; /* ä¸‰æ¬„ */
            gap: 15px;
            border: 5px solid var(--gold);
        }

        .controls h2 {
            grid-column: 1 / -1;
            margin-top: 0;
            color: var(--blue);
            text-align: center;
            border-bottom: 2px dashed #ccc;
            padding-bottom: 10px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        /* è®“æŸäº›æ¬„ä½è·¨æ¬„ */
        .span-3 { grid-column: span 3; }
        .span-2 { grid-column: span 2; }

        label {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 5px;
            color: #555;
        }

        input, select {
            padding: 10px;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 16px;
            background: #f9f9f9;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--gold);
            background: white;
        }

        button {
            grid-column: 1 / -1;
            background: linear-gradient(to bottom, #ffeb3b, #fbc02d);
            color: #8B0000;
            border: 2px solid #b78628;
            padding: 15px;
            font-size: 20px;
            font-weight: 900;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 0 #b78628;
            transition: all 0.1s;
            margin-top: 10px;
        }

        button:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        /* é è¦½å€ */
        #canvas-container {
            margin-top: 20px;
            padding: 10px;
            background: #555;
            border-radius: 10px;
        }

        /* === çç‹€è¨­è¨ˆ === */
        .certificate {
            width: 800px;
            height: 500px;
            position: relative;
            overflow: hidden;
            box-sizing: border-box;
            background-color: #FFF8E1;
            /* æ”¾å°„ç‹€èƒŒæ™¯ */
            background-image: repeating-conic-gradient(
                from 0deg, 
                #FFF8E1 0deg 10deg, 
                #FFECB3 10deg 20deg
            );
            border: 10px solid var(--red);
            box-shadow: inset 0 0 0 5px white, inset 0 0 0 10px var(--gold);
            display: flex;
        }

        /* è£é£¾ï¼šå½©å¸¶èˆ‡ç¢èŠ± */
        .confetti {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle, var(--red) 10%, transparent 10%), 
                radial-gradient(circle, var(--blue) 10%, transparent 10%),
                radial-gradient(circle, var(--gold) 10%, transparent 10%);
            background-size: 50px 50px;
            background-position: 0 0, 25px 25px, 10px 30px;
            opacity: 0.1;
            z-index: 0;
        }

        /* å·¦ä¸Šè§’æ—¥æœŸ */
        .date-badge {
            position: absolute;
            top: 20px;
            left: 20px;
            background: var(--blue);
            color: white;
            padding: 8px 20px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 50px;
            box-shadow: 3px 3px 0 rgba(0,0,0,0.2);
            z-index: 10;
            border: 2px solid white;
        }

        /* è³€å­— */
        .big-stamp {
            position: absolute;
            top: 0px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 100px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text x="50%" y="80%" font-size="80" fill="%23D93025" font-family="serif" text-anchor="middle" font-weight="bold" stroke="white" stroke-width="2">è³€</text></svg>') no-repeat center;
            z-index: 5;
            opacity: 0.2; /* ç•¶ä½œèƒŒæ™¯æµ®æ°´å° */
            display: none; /* å…ˆéš±è—ï¼Œæ”¹ç”¨å°ç«  */
        }
        
        .medal-icon {
            position: absolute;
            top: 25px;
            right: 25px;
            width: 80px;
            height: 80px;
            background: #FFD700;
            border-radius: 50%;
            border: 4px solid #B78628;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: #B78628;
            font-weight: bold;
            font-size: 14px;
            z-index: 20;
            text-align: center;
            line-height: 1.2;
        }
        .medal-icon::after {
            content: "TOP\A SALES";
            white-space: pre;
        }

        /* å·¦å´åœ–ç‰‡å€ */
        .left-panel {
            flex: 0 0 38%;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            z-index: 2;
        }

        .trophy-img {
            width: 280px;
            height: auto;
            filter: drop-shadow(0 10px 10px rgba(0,0,0,0.3));
            margin-bottom: 40px;
            transform: rotate(-5deg);
        }

        /* éœ¸æ°£çš„è³€å­— */
        .congrats-text {
            position: absolute;
            top: 100px;
            left: 20px;
            font-size: 100px;
            font-family: "KaiTi", "BiauKai", serif;
            color: var(--red);
            font-weight: 900;
            line-height: 1;
            text-shadow: 3px 3px 0 white, 5px 5px 0 rgba(0,0,0,0.1);
            transform: rotate(-15deg);
            z-index: 10;
            border: 5px solid var(--red);
            border-radius: 50%;
            width: 140px;
            height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.8);
        }

        /* å³å´æ–‡å­—å€ */
        .right-panel {
            flex: 1;
            padding: 40px 40px 20px 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            z-index: 2;
        }

        .name-row {
            margin-bottom: 25px;
            border-bottom: 3px solid var(--red);
            padding-bottom: 10px;
            display: flex;
            align-items: baseline;
        }

        .agent-name {
            font-size: 60px;
            font-weight: 900;
            color: #333;
            margin-right: 15px;
            letter-spacing: 2px;
            text-shadow: 2px 2px 0 white;
        }

        .product-badge {
            display: inline-block;
            background: var(--blue);
            color: white;
            padding: 5px 15px;
            font-size: 28px;
            font-weight: bold;
            border-radius: 5px;
            margin-bottom: 15px;
            width: fit-content;
            box-shadow: 3px 3px 0 rgba(0,0,0,0.2);
        }

        /* éŠ·å”®é‡‘é¡å¤§æ¨™ */
        .sales-amount-box {
            background: linear-gradient(90deg, #d93025, #c0392b);
            color: white;
            padding: 10px 20px;
            transform: skewX(-10deg);
            margin-left: 10px;
            margin-bottom: 20px;
            box-shadow: 5px 5px 10px rgba(0,0,0,0.2);
            border-left: 5px solid var(--gold);
            display: inline-block;
            width: fit-content;
        }

        .sales-amount-box span {
            display: block;
            transform: skewX(10deg); /* è½‰æ­£æ–‡å­— */
        }
        
        .amount-title { font-size: 16px; opacity: 0.9; }
        .amount-number { font-size: 48px; font-weight: 900; line-height: 1.1; font-family: Impact, sans-serif; }

        /* æ‰‹æ”¶èˆ‡çé‡‘å€ */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--gold);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .stat-item {
            display: flex;
            flex-direction: column;
        }

        .stat-label {
            font-size: 16px;
            color: #666;
            font-weight: bold;
        }

        .stat-value {
            font-size: 24px;
            color: #333;
            font-weight: bold;
        }

        .bonus-value {
            color: var(--red);
            font-size: 32px;
            font-weight: 900;
        }

    </style>
</head>
<body>

    <div class="controls">
        <h2>ğŸ”¥ æ¥­ç¸¾æˆ°å ±ç”Ÿæˆå™¨</h2>
        
        <div class="form-group">
            <label>éŠ·å”®æ—¥æœŸ</label>
            <input type="date" id="inputDate">
        </div>

        <div class="form-group">
            <label>æ¥­ä»£å§“å</label>
            <select id="inputName">
                <option value="å³å¤é”">å³å¤é”</option>
                <option value="é™³é›…éˆ´">é™³é›…éˆ´</option>
                <option value="è‡ªè¡Œè¼¸å…¥">è‡ªè¡Œè¼¸å…¥...</option>
            </select>
        </div>
        
        <!-- å¦‚æœé¸è‡ªè¡Œè¼¸å…¥ï¼Œå¯ä»¥ç”¨é€™å€‹ -->
        <div class="form-group" id="customNameGroup" style="display:none;">
            <label>è¼¸å…¥å§“å</label>
            <input type="text" id="customNameInput" placeholder="è¼¸å…¥åå­—">
        </div>

        <div class="form-group">
            <label>éŠ·å”®å•†å“</label>
            <select id="inputProduct">
                <option value="FCN">FCN (è‚¡æ¬Šé€£çµ)</option>
                <option value="æµ·å¤–å‚µ">æµ·å¤–å‚µåˆ¸</option>
                <option value="åŸºé‡‘">åŸºé‡‘</option>
                <option value="ä¿éšª">ä¿éšª</option>
                <option value="ETF">ETF</option>
            </select>
        </div>

        <div class="form-group">
            <label>å¹£åˆ¥</label>
            <select id="inputCurrency">
                <option value="USD">ç¾å…ƒ (USD)</option>
                <option value="JPY">æ—¥åœ“ (JPY)</option>
                <option value="TWD">å°å¹£ (TWD)</option>
            </select>
        </div>

        <div class="form-group span-2">
            <label>éŠ·å”®é‡‘é¡ (åŸå¹£)</label>
            <input type="number" id="inputAmount" placeholder="20000" value="20000">
        </div>

        <div class="form-group">
            <label>æ‰‹æ”¶ (NTD)</label>
            <input type="number" id="inputRevenue" placeholder="15169" value="15000">
        </div>

        <div class="form-group">
            <label>çé‡‘è¨ˆç®— (%)</label>
            <input type="number" id="inputRate" value="25">
        </div>

        <div class="form-group">
            <label>çé‡‘é è¦½</label>
            <div style="padding:10px; background:#eee; font-weight:bold; color:red;">
                $ <span id="previewBonus">0</span>
            </div>
        </div>

        <button onclick="generateImage()">âœ¨ ç”Ÿæˆä¸¦ä¸‹è¼‰ç²¾ç¾çç‹€</button>
    </div>

    <div id="canvas-container">
        <div class="certificate" id="certificate">
            <!-- èƒŒæ™¯è£é£¾ -->
            <div class="confetti"></div>
            <div class="medal-icon"></div>

            <!-- å·¦ä¸Šæ—¥æœŸ -->
            <div class="date-badge" id="dispDate">115/1/13</div>

            <!-- å·¦å´çç›ƒ -->
            <div class="left-panel">
                <div class="congrats-text">è³€</div>
                <!-- ä½¿ç”¨æ›´ç«‹é«”çš„çç›ƒ SVG -->
                <svg class="trophy-img" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" />
                            <stop offset="50%" style="stop-color:#FDB931;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#B78628;stop-opacity:1" />
                        </linearGradient>
                        <filter id="dropShadow">
                            <feGaussianBlur in="SourceAlpha" stdDeviation="3" />
                            <feOffset dx="2" dy="2" result="offsetblur" />
                            <feComponentTransfer>
                                <feFuncA type="linear" slope="0.5"/>
                            </feComponentTransfer>
                            <feMerge> 
                                <feMergeNode/>
                                <feMergeNode in="SourceGraphic"/> 
                            </feMerge>
                        </filter>
                    </defs>
                    <path fill="url(#grad1)" stroke="#8B4513" stroke-width="5" d="M384 96H352V64C352 28.65 323.3 0 288 0H224C188.7 0 160 28.65 160 64V96H128C57.31 96 0 153.3 0 224C0 274.9 31.42 318.5 76.25 339.7C86.73 398.3 138.1 442.8 200.5 447.2C194.5 458.7 191.2 471.7 192.1 485.4L192.3 512H319.7L319.9 485.4C320.8 471.7 317.5 458.7 311.5 447.2C373.9 442.8 425.3 398.3 435.8 339.7C480.6 318.5 512 274.9 512 224C512 153.3 454.7 96 384 96zM128 288C92.65 288 64 259.3 64 224C64 188.7 92.65 160 128 160V288zM256 384C211.8 384 176 348.2 176 304V64H336V304C336 348.2 300.2 384 256 384zM384 288V160C419.3 160 448 188.7 448 224C448 259.3 419.3 288 384 288z"/>
                    <path fill="#FFF" opacity="0.4" d="M224 80H256V350H224z" />
                </svg>
            </div>

            <!-- å³å´è³‡è¨Š -->
            <div class="right-panel">
                <div class="name-row">
                    <div class="agent-name" id="dispName">å³å¤é”</div>
                    <div style="font-size: 24px; color:#555; align-self:flex-end; padding-bottom:5px;">æ¦®è­½æ¦œ</div>
                </div>

                <div class="product-badge" id="dispProduct">FCN</div>

                <div class="sales-amount-box">
                    <span>
                        <div class="amount-title">æˆäº¤é‡‘é¡ Amount</div>
                        <div class="amount-number">
                            <span id="dispCurrencySymbol" style="font-size:30px;">$</span>
                            <span id="dispAmount">20,000</span>
                            <span id="dispCurrencyText" style="font-size:20px;">ç¾å…ƒ</span>
                        </div>
                    </span>
                </div>

                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-label">æ‰‹çºŒè²»æ”¶å…¥</span>
                        <span class="stat-value">NT$ <span id="dispRevenue">15,000</span></span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">é ä¼°çé‡‘</span>
                        <span class="bonus-value">$<span id="dispBonus">3,750</span></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('inputDate').valueAsDate = new Date();

        const inputs = document.querySelectorAll('input, select');
        inputs.forEach(input => {
            input.addEventListener('input', updateCard);
        });

        // ç›£è½åå­—é¸æ“‡ï¼Œå¦‚æœæ˜¯è‡ªè¡Œè¼¸å…¥å‰‡é¡¯ç¤ºè¼¸å…¥æ¡†
        document.getElementById('inputName').addEventListener('change', function() {
            const customGroup = document.getElementById('customNameGroup');
            if (this.value === 'è‡ªè¡Œè¼¸å…¥') {
                customGroup.style.display = 'flex';
            } else {
                customGroup.style.display = 'none';
            }
            updateCard();
        });

        function formatMoney(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        const currencyData = {
            'USD': { symbol: '$', text: 'ç¾å…ƒ' },
            'JPY': { symbol: 'Â¥', text: 'æ—¥åœ“' },
            'TWD': { symbol: 'NT$', text: 'å°å¹£' }
        };

        function updateCard() {
            const dateVal = new Date(document.getElementById('inputDate').value);
            
            // åå­—è™•ç†
            let name = document.getElementById('inputName').value;
            if (name === 'è‡ªè¡Œè¼¸å…¥') {
                name = document.getElementById('customNameInput').value || 'å§“å';
            }

            const product = document.getElementById('inputProduct').value;
            const currency = document.getElementById('inputCurrency').value;
            const amount = parseFloat(document.getElementById('inputAmount').value) || 0;
            const revenue = parseFloat(document.getElementById('inputRevenue').value) || 0;
            const rate = parseFloat(document.getElementById('inputRate').value) || 0;

            const bonus = Math.round(revenue * (rate / 100));

            // æ›´æ–°ä»‹é¢
            document.getElementById('previewBonus').textContent = formatMoney(bonus);

            // æ›´æ–°çç‹€
            const rocYear = dateVal.getFullYear() - 1911;
            const rocDateStr = `${rocYear}/${dateVal.getMonth() + 1}/${dateVal.getDate()}`;
            document.getElementById('dispDate').textContent = rocDateStr;

            document.getElementById('dispName').textContent = name;
            
            // å­—é«”å¤§å°è‡ªå‹•èª¿æ•´ (å¦‚æœåå­—å¤ªé•·)
            if(name.length > 3) {
                document.getElementById('dispName').style.fontSize = "45px";
            } else {
                document.getElementById('dispName').style.fontSize = "60px";
            }

            document.getElementById('dispProduct').textContent = product;
            
            // å¹£åˆ¥è™•ç†
            document.getElementById('dispCurrencySymbol').textContent = currencyData[currency].symbol;
            document.getElementById('dispCurrencyText').textContent = currencyData[currency].text;

            document.getElementById('dispAmount').textContent = formatMoney(amount);
            document.getElementById('dispRevenue').textContent = formatMoney(revenue);
            document.getElementById('dispBonus').textContent = formatMoney(bonus);
        }

        function generateImage() {
            const element = document.getElementById("certificate");
            
            // æš«æ™‚ç§»é™¤é™°å½±ä»¥é˜²æˆªåœ–åç§»ï¼Œä¸¦æé«˜è§£æåº¦
            html2canvas(element, {
                scale: 3, 
                backgroundColor: null,
                useCORS: true
            }).then(canvas => {
                const link = document.createElement("a");
                const name = document.getElementById('dispName').textContent;
                const product = document.getElementById('dispProduct').textContent;
                const date = document.getElementById('dispDate').textContent.replace(/\//g, "");
                
                link.download = `${date}_${name}_${product}_æˆ°å ±.png`;
                link.href = canvas.toDataURL("image/png");
                link.click();
            });
        }

        updateCard();
    </script>
</body>
</html>