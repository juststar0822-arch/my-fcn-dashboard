<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¦®è­½æ¦œç”Ÿæˆå™¨ - å°ˆæ¥­ç‰ˆ</title>
    <!-- å¼•å…¥ Vue.js (é‚è¼¯è™•ç†) -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- å¼•å…¥ Tailwind CSS (å¿«é€Ÿæ’ç‰ˆ) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ html2canvas (æˆªåœ–åŠŸèƒ½) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- å¼•å…¥ Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f3f4f6; }
        .serif { font-family: 'Noto Serif TC', serif; }
        
        /* çç‹€å°ˆç”¨æ¨£å¼ - ç¢ºä¿æˆªåœ–æ™‚æ¨£å¼ä¸è·‘ç‰ˆ */
        .certificate-container {
            width: 800px;
            height: 500px;
            position: relative;
            background: #fff;
            overflow: hidden;
            border: 12px solid #B49B58; /* é‡‘è‰²é‚Šæ¡† */
            box-shadow: inset 0 0 0 4px #fff, inset 0 0 0 6px #B91C1C; /* å…§å±¤ç´…ç·š */
            display: flex;
            background-image: radial-gradient(circle at 50% 50%, #fffbf0 0%, #fff 100%);
        }
        
        /* èƒŒæ™¯æµ®æ°´å° */
        .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-30deg);
            font-size: 12rem;
            font-weight: 900;
            color: rgba(180, 155, 88, 0.05);
            pointer-events: none;
            z-index: 0;
            white-space: nowrap;
        }

        /* å·¦å´å¤§çç›ƒå€ */
        .left-panel {
            width: 35%;
            background: linear-gradient(135deg, #FFF8E1 0%, #FFECB3 100%);
            border-right: 2px dashed #D4AF37;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        /* çç›ƒåœ–ç¤º (CSSç¹ªè£½æˆ–SVG) */
        .trophy-icon {
            filter: drop-shadow(0 10px 10px rgba(0,0,0,0.2));
            width: 180px;
            height: 180px;
        }

        /* è³€å­—å°ç«  */
        .stamp-circle {
            width: 100px;
            height: 100px;
            border: 4px solid #B91C1C;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #B91C1C;
            font-weight: 900;
            font-size: 3rem;
            transform: rotate(-15deg);
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.9);
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
            z-index: 10;
        }

        /* å³å´è³‡è¨Šå€ */
        .right-panel {
            width: 65%;
            padding: 20px 30px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
            z-index: 1;
        }

        .date-tag {
            background: #B91C1C;
            color: white;
            padding: 4px 12px;
            border-radius: 99px;
            font-size: 1.1rem;
            font-weight: bold;
            align-self: flex-start;
            margin-bottom: 10px;
        }

        .name-section {
            border-bottom: 2px solid #F3E5AB;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .rep-name {
            font-size: 3.5rem;
            line-height: 1.1;
            color: #1F2937;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.05);
        }

        .rep-title {
            font-size: 1.5rem;
            color: #6B7280;
            margin-left: 10px;
        }

        .product-badge {
            background: #1F2937;
            color: #F3E5AB;
            padding: 5px 20px;
            font-size: 1.8rem;
            font-weight: bold;
            display: inline-block;
            border-radius: 4px;
        }

        .amount-display {
            font-size: 3rem;
            font-weight: 900;
            color: #B91C1C;
            font-family: 'Arial', sans-serif; /* æ•¸å­—ç”¨ç„¡è¥¯ç·šé«”è¼ƒæ¸…æ¥š */
        }

        .currency-label {
            font-size: 1.2rem;
            color: #B91C1C;
            margin-left: 5px;
        }

        .stats-box {
            background: #FFFBEB;
            border: 1px solid #FCD34D;
            border-radius: 10px;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
        }
        .stat-label { font-size: 0.9rem; color: #9CA3AF; font-weight: bold; }
        .stat-value { font-size: 1.4rem; color: #4B5563; font-weight: bold; }
        .stat-value.bonus { color: #D97706; font-size: 1.8rem; }
    </style>
</head>
<body>

<div id="app" class="min-h-screen flex flex-col items-center py-10 px-4">

    <!-- è¼¸å…¥æ§åˆ¶é¢æ¿ -->
    <div class="bg-white p-6 rounded-xl shadow-lg w-full max-w-4xl mb-8 border-t-4 border-yellow-500">
        <h1 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
            <span class="text-3xl mr-2">ğŸ†</span> æ¦®è­½æ¦œç”Ÿæˆå™¨
        </h1>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            
            <!-- æ—¥æœŸ -->
            <div>
                <label class="block text-sm font-bold text-gray-700 mb-2">éŠ·å”®æ—¥æœŸ</label>
                <input type="date" v-model="form.date" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-yellow-400 outline-none">
            </div>

            <!-- æ¥­ä»£ -->
            <div>
                <label class="block text-sm font-bold text-gray-700 mb-2">éŠ·å”®æ¥­ä»£</label>
                <select v-model="form.repIndex" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-yellow-400 outline-none">
                    <option v-for="(rep, index) in repList" :value="index">
                        {{ rep.name }} {{ rep.title }}
                    </option>
                </select>
            </div>

            <!-- å•†å“ç¨®é¡ -->
            <div>
                <label class="block text-sm font-bold text-gray-700 mb-2">å•†å“ç¨®é¡</label>
                <select v-model="form.productType" @change="handleProductChange" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-yellow-400 outline-none">
                    <option value="FCN">FCN</option>
                    <option value="U6">å…ƒå…ƒè‡´å¯Œ U6</option>
                    <option value="U5">å…ƒå…ƒè‡´å¯Œ U5</option>
                    <option value="BOND">æµ·å¤–å‚µ</option>
                </select>
            </div>

            <!-- å¹£åˆ¥ & åŒ¯ç‡ -->
            <div class="flex gap-2">
                <div class="flex-1">
                    <label class="block text-sm font-bold text-gray-700 mb-2">å¹£åˆ¥</label>
                    <select v-model="form.currency" @change="updateExRate" class="w-full border rounded-lg p-2">
                        <option value="USD">ç¾å…ƒ (USD)</option>
                        <option value="JPY">æ—¥åœ“ (JPY)</option>
                        <option value="TWD">å°å¹£ (TWD)</option>
                        <option value="AUD">æ¾³å¹£ (AUD)</option>
                    </select>
                </div>
                <div class="w-24">
                    <label class="block text-sm font-bold text-gray-500 mb-2">å³æ™‚åŒ¯ç‡</label>
                    <input type="number" v-model="form.exRate" step="0.01" class="w-full border rounded-lg p-2 bg-gray-50 text-center">
                </div>
            </div>

            <!-- é‡‘é¡ -->
            <div>
                <label class="block text-sm font-bold text-gray-700 mb-2">éŠ·å”®é‡‘é¡ (åŸå¹£)</label>
                <input type="number" v-model="form.amount" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-yellow-400 outline-none" placeholder="20000">
            </div>

            <!-- æ‰‹æ”¶ç‡ (BP) -->
            <div>
                <label class="block text-sm font-bold text-gray-700 mb-2">
                    æ‰‹æ”¶ç‡ (BP) 
                    <span v-if="isFixedBP" class="text-xs text-red-500">(å›ºå®š)</span>
                </label>
                <input type="number" v-model="form.bp" :disabled="isFixedBP" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-yellow-400 outline-none disabled:bg-gray-100 disabled:text-gray-500">
                <p class="text-xs text-gray-400 mt-1">è¨ˆç®—å…¬å¼: é‡‘é¡ Ã— åŒ¯ç‡ Ã— (BP Ã· 10000)</p>
            </div>

        </div>

        <!-- è©¦ç®—çµæœé¡¯ç¤º -->
        <div class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200 flex flex-wrap gap-6 justify-between items-center">
            <div>
                <span class="text-sm text-gray-500">é©ç”¨çé‡‘ç‡:</span>
                <span class="font-bold text-gray-800">{{ bonusRateDisplay }}%</span>
            </div>
            <div>
                <span class="text-sm text-gray-500">é ä¼°æ‰‹æ”¶ (å°å¹£):</span>
                <span class="font-bold text-blue-600 text-lg">{{ formatNumber(calculatedRevenue) }}</span>
            </div>
            <div>
                <span class="text-sm text-gray-500">é ä¼°çé‡‘ (å°å¹£):</span>
                <span class="font-bold text-red-600 text-xl">{{ formatNumber(calculatedBonus) }}</span>
            </div>
            <button @click="downloadImage" class="ml-auto bg-gradient-to-r from-yellow-500 to-red-600 text-white px-6 py-2 rounded-full font-bold shadow-md hover:shadow-lg transform hover:-translate-y-1 transition">
                âœ¨ ä¸‹è¼‰ç²¾ç¾çç‹€
            </button>
        </div>
    </div>

    <!-- çç‹€é è¦½å€ (éš±è—çš„ Canvas ä¾†æº) -->
    <!-- é€™è£¡ä½¿ç”¨ scale åœ¨æ‰‹æ©Ÿä¸Šç¸®å°é¡¯ç¤ºï¼Œä½†ä¸‹è¼‰æ™‚æœƒæ˜¯åŸå°ºå¯¸ -->
    <div style="overflow: auto; max-width: 100%;">
        <div id="certificate-node" class="certificate-container serif">
            
            <!-- æµ®æ°´å° -->
            <div class="watermark">TOP SALES</div>

            <!-- å·¦å´ -->
            <div class="left-panel">
                <div class="stamp-circle serif">è³€</div>
                <!-- çç›ƒ SVG -->
                <svg class="trophy-icon" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="goldGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#DAA520;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <path fill="url(#goldGrad)" stroke="#B8860B" stroke-width="2" d="M416 96H352V64C352 28.7 323.3 0 288 0H224C188.7 0 160 28.7 160 64V96H96C43 96 0 139 0 192C0 239.5 34.5 279 80 286.6C85.5 353.9 142.1 406.4 210.7 414.7C203.4 429.3 199.3 445.8 199.3 463.1L200 480H128C110.3 480 96 494.3 96 512H416C416 494.3 401.7 480 384 480H312L312.7 463.1C312.7 445.8 308.6 429.3 301.3 414.7C369.9 406.4 426.5 353.9 432 286.6C477.5 279 512 239.5 512 192C512 139 469 96 416 96zM96 240C69.5 240 48 218.5 48 192C48 165.5 69.5 144 96 144H160V240H96zM352 240H288V64H224V240H160V288C160 323.3 188.7 352 224 352H288C323.3 352 352 323.3 352 288V240zM416 240H352V144H416C442.5 144 464 165.5 464 192C464 218.5 442.5 240 416 240z"/>
                </svg>
                <div style="margin-top:20px; font-weight:bold; color:#B49B58; letter-spacing: 2px;">BEST PERFORMANCE</div>
            </div>

            <!-- å³å´ -->
            <div class="right-panel">
                <!-- é ‚éƒ¨è³‡è¨Š -->
                <div>
                    <div class="date-tag">{{ rocDate }}</div>
                    
                    <div class="name-section">
                        <span class="rep-name serif">{{ currentRep.name }}</span>
                        <span class="rep-title">{{ currentRep.title }}</span>
                    </div>

                    <div class="flex items-baseline mt-4">
                        <div class="product-badge">{{ productDisplay }}</div>
                        <div style="font-size:0.9rem; color:#999; margin-left:auto;">å…±è¨ˆ1ç­†</div>
                    </div>
                </div>

                <!-- é‡‘é¡ -->
                <div class="my-2">
                    <div style="font-size: 0.9rem; color:#666; font-weight:bold;">éŠ·å”®é‡‘é¡ Amount</div>
                    <div class="amount-display">
                        {{ formatNumber(form.amount) }}<span class="currency-label">{{ currencyLabel }}</span>
                    </div>
                </div>

                <!-- åº•éƒ¨æ•¸æ“š -->
                <div class="stats-box">
                    <div class="stat-item">
                        <span class="stat-label">æ‰‹çºŒè²»æ”¶å…¥ Revenue</span>
                        <span class="stat-value">NT$ {{ formatNumber(calculatedRevenue) }}</span>
                    </div>
                    <!-- è™›ç·šåˆ†éš” -->
                    <div style="width:1px; height:40px; background:#ccc;"></div>
                    <div class="stat-item">
                        <span class="stat-label">çé‡‘ Bonus</span>
                        <span class="stat-value bonus">NT$ {{ formatNumber(calculatedBonus) }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, computed, reactive, onMounted } = Vue;

    createApp({
        setup() {
            // äººå“¡åå–®
            const repList = [
                { name: 'å³å¤é”', title: 'æ¥­å‹™å”ç†' },
                { name: 'è³´å©‰ç”„', title: 'æ¥­å‹™å”ç†' },
                { name: 'é™³é›…éˆ´', title: 'æ¥­å‹™ç¶“ç†' },
                { name: 'è•­ç‰æ˜¥', title: 'æ¥­å‹™å”ç†' },
                { name: 'é»ƒæ€å©·', title: 'æ¥­å‹™å”ç†' },
                { name: 'è³´ç§‹è', title: 'æ¥­å‹™å”ç†' },
                { name: 'ç‹æ·‘æ¿±', title: 'æ¥­å‹™ç¶“ç†' },
                { name: 'è³´ç¾è¯', title: 'æ¥­å‹™å“¡' },
                { name: 'ç‹æ·‘å¿', title: 'æ¥­å‹™å‰¯ç†' },
                { name: 'ä¸å¿ƒæ¢…', title: 'æ¥­å‹™é«˜å°ˆ' },
                { name: 'ç‹éµ¬é£›', title: 'æ¥­å‹™ç¶“ç†' },
                { name: 'ç¾…é‡‘è˜­', title: 'æ¥­å‹™å‰¯ç†' },
                { name: 'é™³ç¿°æ³°', title: 'æ¥­å‹™å“¡' },
                { name: 'æ›¾è©©æ¶µ', title: 'æ¥­å‹™é«˜å°ˆ' }
            ];

            // é è¨­åŒ¯ç‡
            const exRates = {
                'USD': 32.5,
                'JPY': 0.22,
                'TWD': 1.0,
                'AUD': 21.5
            };

            const form = reactive({
                date: new Date().toISOString().split('T')[0],
                repIndex: 0,
                productType: 'FCN', // FCN, U6, U5, BOND
                currency: 'USD',
                exRate: 32.5,
                amount: 20000,
                bp: 50
            });

            // æ›´æ–°åŒ¯ç‡
            const updateExRate = () => {
                form.exRate = exRates[form.currency] || 1;
            };

            // è™•ç†å•†å“è®Šæ›´é‚è¼¯
            const handleProductChange = () => {
                const type = form.productType;
                if (type === 'U6' || type === 'U5') {
                    form.bp = 600; // å›ºå®š 600 BP
                } else if (type === 'FCN') {
                    form.bp = 50; // é è¨­å€¼ï¼Œå¯æ”¹
                } else if (type === 'BOND') {
                    form.bp = 100; // é è¨­å€¼ï¼Œå¯æ”¹
                }
            };

            // åˆ¤æ–·æ˜¯å¦é–å®š BP è¼¸å…¥
            const isFixedBP = computed(() => {
                return form.productType === 'U6' || form.productType === 'U5';
            });

            // çé‡‘ç‡è¨ˆç®—
            const bonusRate = computed(() => {
                const type = form.productType;
                if (type === 'FCN') return 30;
                if (type === 'U6' || type === 'U5') return 38;
                if (type === 'BOND') return 25;
                return 0;
            });

            // æ‰‹æ”¶è¨ˆç®—: é‡‘é¡ * åŒ¯ç‡ * (BP / 10000)
            const calculatedRevenue = computed(() => {
                return Math.round(form.amount * form.exRate * (form.bp / 10000));
            });

            // çé‡‘è¨ˆç®—: æ‰‹æ”¶ * (çé‡‘ç‡ / 100)
            const calculatedBonus = computed(() => {
                return Math.round(calculatedRevenue.value * (bonusRate.value / 100));
            });

            // é¡¯ç¤ºé‚è¼¯
            const currentRep = computed(() => repList[form.repIndex]);
            
            const rocDate = computed(() => {
                const d = new Date(form.date);
                return `${d.getFullYear() - 1911}/${d.getMonth() + 1}/${d.getDate()}`;
            });

            const productDisplay = computed(() => {
                const map = {
                    'FCN': 'FCN',
                    'U6': 'å…ƒå…ƒè‡´å¯Œ U6',
                    'U5': 'å…ƒå…ƒè‡´å¯Œ U5',
                    'BOND': 'æµ·å¤–å‚µ'
                };
                return map[form.productType];
            });

            const currencyLabel = computed(() => {
                const map = { 'USD': 'ç¾å…ƒ', 'JPY': 'æ—¥åœ“', 'TWD': 'å°å¹£', 'AUD': 'æ¾³å¹£' };
                return map[form.currency];
            });

            const formatNumber = (num) => {
                return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            };

            const downloadImage = () => {
                const element = document.getElementById("certificate-node");
                // ç‚ºäº†é«˜è§£æåº¦ï¼Œè¨­å®š scale
                html2canvas(element, { scale: 2 }).then(canvas => {
                    const link = document.createElement("a");
                    link.download = `${rocDate.value}_${currentRep.value.name}_æ¦®è­½æ¦œ.png`;
                    link.href = canvas.toDataURL("image/png");
                    link.click();
                });
            };

            return {
                repList,
                form,
                updateExRate,
                handleProductChange,
                isFixedBP,
                bonusRateDisplay: bonusRate,
                calculatedRevenue,
                calculatedBonus,
                currentRep,
                rocDate,
                productDisplay,
                currencyLabel,
                formatNumber,
                downloadImage
            };
        }
    }).mount('#app');
</script>

</body>
</html>