<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¦®è­½æ¦œç”Ÿæˆå™¨ (ç¶“å…¸å¾©åˆ»ç‰ˆ)</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=Noto+Serif+TC:wght@900&display=swap');
        
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #e5e7eb; padding-bottom: 50px;}
        
        /* === çç‹€è¨­è¨ˆå€ (éš±è—åŸå§‹DOMï¼Œåªç”¨ä¾†ç”Ÿæˆåœ–ç‰‡) === */
        .canvas-wrapper {
            position: fixed;
            left: -9999px; /* éš±è—åœ¨è¢å¹•å¤–ï¼Œé¿å…å¹²æ“¾ */
            top: 0;
        }

        .certificate {
            width: 800px; /* å›ºå®šå¯¬åº¦ç¢ºä¿æ’ç‰ˆ */
            height: 533px; /* æ¥è¿‘ 3:2 æ¯”ä¾‹ */
            background-color: #fff;
            position: relative;
            border: 4px solid #D93025; /* ç´…è‰²å¤–æ¡† */
            box-sizing: border-box;
            display: flex;
            overflow: hidden;
            font-family: 'Microsoft JhengHei', 'Noto Sans TC', sans-serif;
        }

        /* å››å€‹è§’è½çš„è£é£¾ */
        .corner {
            position: absolute;
            width: 40px;
            height: 40px;
            border: 6px solid #D93025;
            z-index: 10;
        }
        .c-tl { top: 10px; left: 10px; border-right: none; border-bottom: none; }
        .c-tr { top: 10px; right: 10px; border-left: none; border-bottom: none; }
        .c-bl { bottom: 10px; left: 10px; border-right: none; border-top: none; }
        .c-br { bottom: 10px; right: 10px; border-left: none; border-top: none; }

        /* å·¦å´æ—¥æœŸ */
        .date-text {
            position: absolute;
            top: 20px;
            left: 25px;
            font-size: 32px;
            font-weight: bold;
            color: #D93025; /* åƒè€ƒåœ–æ˜¯ç´…è‰²æˆ–æ©˜è‰²ç³» */
            z-index: 20;
        }

        /* å·¦å´åœ–æ¡ˆå€ */
        .left-art {
            width: 45%;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            padding-bottom: 40px;
        }

        /* è³€å­— */
        .he-character {
            position: absolute;
            top: 10px;
            right: -20px; /* ç¨å¾®å¾€å³è“‹ä¸€é» */
            font-family: 'Noto Serif TC', serif;
            font-size: 140px;
            color: #D93025;
            font-weight: 900;
            text-shadow: 3px 3px 0 #fff, 5px 5px 0 rgba(0,0,0,0.1);
            transform: rotate(-10deg);
            z-index: 15;
            /* ç­†åˆ·æ„Ÿ */
            background-image: linear-gradient(45deg, #D93025 30%, #ff5252 90%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* çç›ƒ SVG å®¹å™¨ */
        .trophy-container {
            width: 320px;
            height: 320px;
            position: relative;
            z-index: 5;
            margin-top: 60px;
            margin-left: 20px;
        }
        
        /* çç›ƒåº•åº§ä¸Šçš„ BEST æ–‡å­— */
        .best-text {
            position: absolute;
            bottom: 45px;
            left: 50%;
            transform: translateX(-50%) rotate(-5deg);
            color: #8B4513;
            font-weight: 900;
            font-size: 28px;
            text-shadow: 1px 1px 0 rgba(255,255,255,0.5);
        }

        /* å³å´æ–‡å­—å€ */
        .right-info {
            width: 55%;
            padding: 40px 30px 20px 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .name-row {
            display: flex;
            align-items: baseline;
            margin-bottom: 20px;
        }

        .agent-name {
            font-size: 85px;
            font-weight: 900;
            color: #000;
            line-height: 1;
            margin-right: 15px;
        }

        .agent-title {
            font-size: 32px;
            font-weight: bold;
            color: #333;
        }

        /* å•†å“æ¡†æ¡† */
        .product-box {
            border: 3px solid #1e3a8a; /* æ·±è—æ¡† */
            display: inline-block;
            padding: 5px 20px;
            margin-bottom: 10px;
            width: fit-content;
        }
        
        .product-name {
            color: #1e3a8a; /* æ·±è—å­— */
            font-size: 50px;
            font-weight: bold;
            line-height: 1.1;
        }

        .count-text {
            font-size: 18px;
            color: #1e3a8a;
            margin-left: 10px;
            display: inline-block;
        }

        /* é‡‘é¡ */
        .amount-row {
            margin-bottom: 10px;
        }
        
        .amount-val {
            font-size: 85px;
            font-weight: 900;
            color: #D93025; /* ç´…å­— */
            line-height: 1;
            font-family: Arial, sans-serif;
        }

        .currency-text {
            font-size: 28px;
            font-weight: bold;
            color: #D93025;
            margin-left: 5px;
        }

        /* åº•éƒ¨è©³ç´°æ•¸æ“š (æ‰‹æ”¶/çé‡‘) */
        .detail-stats {
            margin-top: 15px;
            font-size: 24px;
            font-weight: bold;
            color: #d63384; /* ç¨å¾®å¸¶é»ç´«ç´…ï¼Œå€éš”è¦–è¦º */
            line-height: 1.4;
            background: #fff0f0;
            padding: 10px;
            border-radius: 10px;
            display: inline-block;
            width: fit-content;
        }
        
        .stat-line span {
            color: #333;
            font-size: 20px;
        }

        /* åº•éƒ¨å°çç›ƒåœ–ç¤º */
        .mini-podium {
            position: absolute;
            bottom: 15px;
            right: 15px;
            width: 80px;
            opacity: 0.8;
        }

        /* === çµæœåœ–ç‰‡é¡¯ç¤ºå€ === */
        #result-area {
            display: none; /* é è¨­éš±è—ï¼Œç”Ÿæˆå¾Œé¡¯ç¤º */
            margin-top: 20px;
            text-align: center;
        }
        #result-img {
            max-width: 100%;
            height: auto;
            border: 2px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .save-hint {
            color: #D93025;
            font-weight: bold;
            margin-top: 10px;
            font-size: 1.2rem;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }

    </style>
</head>
<body>

<div id="app" class="max-w-md mx-auto p-4">

    <!-- è¼¸å…¥å€å¡Š -->
    <div class="bg-white rounded-lg shadow-lg p-5 mb-6 border-t-4 border-red-600">
        <h2 class="text-xl font-bold text-center mb-4 text-gray-800">ğŸ§¨ æ¥­ç¸¾æˆ°å ±ç”Ÿæˆå™¨</h2>
        
        <div class="space-y-3">
            <!-- æ—¥æœŸ -->
            <div>
                <label class="text-xs font-bold text-gray-500">æ—¥æœŸ</label>
                <input type="date" v-model="form.date" class="w-full border p-2 rounded bg-gray-50">
            </div>

            <!-- æ¥­ä»£ -->
            <div>
                <label class="text-xs font-bold text-gray-500">æ¥­ä»£</label>
                <select v-model="form.repIndex" class="w-full border p-2 rounded bg-gray-50">
                    <option v-for="(rep, index) in repList" :value="index">
                        {{ rep.name }} {{ rep.title }}
                    </option>
                </select>
            </div>

            <!-- å•†å“ -->
            <div class="flex gap-2">
                <div class="w-2/3">
                    <label class="text-xs font-bold text-gray-500">å•†å“</label>
                    <select v-model="form.productType" @change="handleProductChange" class="w-full border p-2 rounded bg-gray-50">
                        <option value="FCN">FCN</option>
                        <option value="U6">å…ƒå…ƒè‡´å¯Œ U6</option>
                        <option value="U5">å…ƒå…ƒè‡´å¯Œ U5</option>
                        <option value="BOND">æµ·å¤–å‚µ</option>
                    </select>
                </div>
                <div class="w-1/3">
                    <label class="text-xs font-bold text-gray-500">æ‰‹æ”¶ç‡(BP)</label>
                    <input type="number" v-model="form.bp" :disabled="isFixedBP" class="w-full border p-2 rounded bg-gray-50 text-center disabled:text-gray-400">
                </div>
            </div>

            <!-- é‡‘é¡èˆ‡åŒ¯ç‡ -->
            <div class="flex gap-2">
                <div class="w-1/3">
                    <label class="text-xs font-bold text-gray-500">å¹£åˆ¥</label>
                    <select v-model="form.currency" @change="updateExRate" class="w-full border p-2 rounded bg-gray-50">
                        <option value="USD">USD</option>
                        <option value="JPY">JPY</option>
                        <option value="TWD">TWD</option>
                    </select>
                </div>
                <div class="w-1/3">
                    <label class="text-xs font-bold text-gray-500">åŒ¯ç‡</label>
                    <input type="number" v-model="form.exRate" step="0.1" class="w-full border p-2 rounded bg-gray-50 text-center">
                </div>
                <div class="w-1/3">
                    <label class="text-xs font-bold text-gray-500">é‡‘é¡</label>
                    <input type="number" v-model="form.amount" class="w-full border p-2 rounded bg-gray-50 text-center">
                </div>
            </div>

            <!-- é è¦½è¨ˆç®— -->
            <div class="bg-red-50 p-2 rounded text-sm text-gray-700 flex justify-between px-4 mt-2">
                <span>æ‰‹æ”¶: <b>{{ formatNumber(calculatedRevenue) }}</b></span>
                <span>çé‡‘: <b class="text-red-600">{{ formatNumber(calculatedBonus) }}</b></span>
            </div>

            <button @click="generateImage" class="w-full bg-red-600 text-white font-bold py-3 rounded-lg shadow mt-4 hover:bg-red-700 active:scale-95 transition">
                ç”Ÿæˆçç‹€ (å¯é•·æŒ‰å„²å­˜)
            </button>
        </div>
    </div>

    <!-- çµæœé¡¯ç¤ºå€ (ç”Ÿæˆå¾Œæ‰æœƒå‡ºç¾) -->
    <div id="result-area">
        <p class="save-hint">ğŸ‘‡ é•·æŒ‰ä¸‹æ–¹åœ–ç‰‡å³å¯å„²å­˜ ğŸ‘‡</p>
        <img id="result-img" src="" alt="ç”Ÿæˆçš„çç‹€">
    </div>

</div>

<!-- éš±è—çš„ Canvas æ¸²æŸ“æº (é€™æ˜¯æˆ‘å€‘è¦ç•«çš„ html) -->
<div class="canvas-wrapper">
    <div id="certificate-node" class="certificate">
        
        <!-- ç´…è‰²è§’è½æ¡† -->
        <div class="corner c-tl"></div>
        <div class="corner c-tr"></div>
        <div class="corner c-bl"></div>
        <div class="corner c-br"></div>

        <!-- æ—¥æœŸ -->
        <div class="date-text">{{ rocDate }}</div>

        <!-- å·¦å´åœ–æ¡ˆ -->
        <div class="left-art">
            <div class="he-character">è³€</div>
            
            <div class="trophy-container">
                <!-- å¾©åˆ»å¡é€šé¢¨æ ¼çç›ƒ (SVG) -->
                <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                    <!-- å½©å¸¶èƒŒæ™¯ -->
                    <path d="M20 100 Q50 150 180 80" stroke="#FFD700" stroke-width="20" fill="none" opacity="0.3"/>
                    <path d="M10 120 Q60 180 190 100" stroke="#FFD700" stroke-width="20" fill="none" opacity="0.3"/>
                    
                    <!-- çç›ƒæœ¬é«” -->
                    <defs>
                        <linearGradient id="gold" x1="0" y1="0" x2="1" y2="1">
                            <stop offset="0%" stop-color="#FFEC8B"/>
                            <stop offset="50%" stop-color="#DAA520"/>
                            <stop offset="100%" stop-color="#B8860B"/>
                        </linearGradient>
                    </defs>
                    <!-- æ¯èº« -->
                    <path d="M50 40 L150 40 L130 110 C130 140 70 140 70 110 Z" fill="url(#gold)" stroke="#8B4513" stroke-width="2"/>
                    <!-- æ¯è€³ -->
                    <path d="M50 50 C20 50 20 90 50 90" fill="none" stroke="#DAA520" stroke-width="6"/>
                    <path d="M150 50 C180 50 180 90 150 90" fill="none" stroke="#DAA520" stroke-width="6"/>
                    <!-- åº•åº§ -->
                    <path d="M85 140 L115 140 L115 160 L85 160 Z" fill="#8B4513"/>
                    <path d="M60 160 L140 160 L150 180 L50 180 Z" fill="#654321" stroke="#333" stroke-width="1"/>
                </svg>
                <div class="best-text">BEST</div>
            </div>
        </div>

        <!-- å³å´è³‡è¨Š -->
        <div class="right-info">
            <!-- åå­—èˆ‡è·ç¨± -->
            <div class="name-row">
                <div class="agent-name">{{ currentRep.name }}</div>
            </div>
            <div style="text-align: right; margin-top:-25px; margin-bottom: 20px;">
                <div class="agent-title">{{ currentRep.title }}</div>
            </div>

            <!-- å•†å“ -->
            <div>
                <div class="product-box">
                    <span class="product-name">{{ productDisplay }}</span>
                </div>
                <span style="color:#666; font-weight:bold;">å…±è¨ˆ1ç­†</span>
            </div>

            <!-- é‡‘é¡ -->
            <div class="amount-row">
                <span class="amount-val">{{ formatNumber(form.amount) }}</span>
                <span class="currency-text">{{ currencyLabel }}</span>
            </div>

            <!-- æ‰‹æ”¶èˆ‡çé‡‘ -->
            <div class="detail-stats">
                <div class="stat-line"><span>æ‰‹æ”¶ï¼š</span>{{ formatNumber(calculatedRevenue) }}å…ƒ</div>
                <div class="stat-line" style="color:#D93025;"><span>çé‡‘ï¼š</span>{{ formatNumber(calculatedBonus) }}å…ƒ</div>
            </div>

            <!-- å³ä¸‹è§’å°åœ–ç¤º -->
            <svg class="mini-podium" viewBox="0 0 100 60" xmlns="http://www.w3.org/2000/svg">
                <rect x="30" y="20" width="40" height="40" fill="#bbb"/>
                <rect x="0" y="35" width="30" height="25" fill="#999"/>
                <rect x="70" y="45" width="30" height="15" fill="#ddd"/>
                <text x="50" y="50" text-anchor="middle" fill="#fff" font-size="20">1</text>
            </svg>
        </div>
    </div>
</div>

<script>
    const { createApp, reactive, computed } = Vue;

    createApp({
        setup() {
            const repList = [
                { name: 'å³å¤é”', title: 'æ¥­å‹™å”ç†' },
                { name: 'è³´å©‰ç”„', title: 'æ¥­å‹™å”ç†' },
                { name: 'é™³é›…éˆ´', title: 'æ¥­å‹™ç¶“ç†' },
                { name: 'è•­ç‰æ˜¥', title: 'æ¥­å‹™å”ç†' },
                { name: 'é»ƒæ€å©·', title: 'æ¥­å‹™å”ç†' },
                { name: 'è³´ç§‹è', title: 'æ¥­å‹™å”ç†' },
                { name: 'ç‹æ·‘æ¿±', title: 'æ¥­å‹™ç¶“ç†' },
                { name: 'è³´ç¾è¯', title: 'æ¥­å‹™ç¶“ç†' },
                { name: 'ç‹æ·‘å¿', title: 'æ¥­å‹™å”ç†' },
                { name: 'ä¸å¿ƒæ¢…', title: 'æ¥­å‹™é«˜å°ˆ' },
                { name: 'ç‹éµ¬é£›', title: 'æ¥­å‹™ç¶“ç†' },
                { name: 'ç¾…é‡‘è˜­', title: 'æ¥­å‹™ç¶“ç†' },
                { name: 'é™³ç¿°æ³°', title: 'æ¥­å‹™å“¡' },
                { name: 'æ›¾è©©æ¶µ', title: 'æ¥­å‹™é«˜å°ˆ' }
            ];

            const form = reactive({
                date: new Date().toISOString().split('T')[0],
                repIndex: 4, // é è¨­é»ƒæ€å©·
                productType: 'FCN',
                currency: 'USD',
                exRate: 32.5,
                amount: 20000,
                bp: 50
            });

            const currentRep = computed(() => repList[form.repIndex]);
            const rocDate = computed(() => {
                const d = new Date(form.date);
                return `${d.getFullYear() - 1911}/${d.getMonth() + 1}/${d.getDate()}`;
            });

            // åŒ¯ç‡
            const updateExRate = () => {
                const rates = { 'USD': 32.5, 'JPY': 0.22, 'TWD': 1 };
                form.exRate = rates[form.currency] || 1;
            };

            // å•†å“é‚è¼¯
            const isFixedBP = computed(() => ['U6', 'U5'].includes(form.productType));
            const handleProductChange = () => {
                if(form.productType === 'U6' || form.productType === 'U5') form.bp = 600;
                else if(form.productType === 'FCN') form.bp = 50; // é è¨­
            };

            const productDisplay = computed(() => {
                const map = { 'FCN': 'FCN', 'U6': 'å…ƒå…ƒè‡´å¯ŒU6', 'U5': 'å…ƒå…ƒè‡´å¯ŒU5', 'BOND': 'æµ·å¤–å‚µ' };
                return map[form.productType];
            });

            const currencyLabel = computed(() => {
                const map = { 'USD': 'ç¾å…ƒ', 'JPY': 'æ—¥åœ“', 'TWD': 'å…ƒ' };
                return map[form.currency];
            });

            // è¨ˆç®—
            const calculatedRevenue = computed(() => Math.round(form.amount * form.exRate * (form.bp / 10000)));
            const calculatedBonus = computed(() => {
                let rate = 0;
                if(form.productType === 'FCN') rate = 30;
                else if(['U6', 'U5'].includes(form.productType)) rate = 38;
                else if(form.productType === 'BOND') rate = 25;
                return Math.round(calculatedRevenue.value * (rate / 100));
            });

            const formatNumber = (num) => num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");

            // ç”Ÿæˆåœ–ç‰‡æ ¸å¿ƒé‚è¼¯
            const generateImage = () => {
                const element = document.getElementById("certificate-node");
                // é¡¯ç¤º Loading æˆ–æç¤ºå¯çœç•¥ï¼Œç›´æ¥ç”Ÿæˆ
                html2canvas(element, { 
                    scale: 2, // æé«˜è§£æåº¦
                    backgroundColor: "#ffffff"
                }).then(canvas => {
                    const imgData = canvas.toDataURL("image/png");
                    const resultImg = document.getElementById("result-img");
                    resultImg.src = imgData;
                    
                    // é¡¯ç¤ºçµæœå€
                    document.getElementById("result-area").style.display = "block";
                    
                    // è‡ªå‹•æ²å‹•åˆ°åœ–ç‰‡ä½ç½®
                    setTimeout(() => {
                        resultImg.scrollIntoView({ behavior: "smooth" });
                    }, 100);
                });
            };

            return {
                repList, form, currentRep, rocDate, isFixedBP,
                updateExRate, handleProductChange, productDisplay, currencyLabel,
                calculatedRevenue, calculatedBonus, formatNumber, generateImage
            };
        }
    }).mount('#app');
</script>

</body>
</html>