<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¥µè‡´å¥¢è¯æ¦®è­½æ¦œ</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@700;900&family=Montserrat:wght@700;800&family=Noto+Sans+TC:wght@400;700&display=swap');
        
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #0b1120; padding-bottom: 80px; color: #fff; }

        /* é è¦½å€åŸŸ */
        #preview-container { width: 100%; display: flex; justify-content: center; padding: 30px 0; overflow: hidden; }

        /* æ¦®è­½æ¦œæœ¬é«” */
        .certificate {
            width: 800px; 
            height: 535px;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            position: relative; 
            box-sizing: border-box;
            box-shadow: 0 40px 100px rgba(0,0,0,0.8);
            flex-shrink: 0; 
            transform-origin: top center;
            border: 15px solid transparent;
            border-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cpath d='M0 0 L100 0 L100 100 L0 100 Z' fill='none' stroke='%23C5A059' stroke-width='10'/%3E%3C/svg%3E") 30 stretch;
        }

        /* å…§é‘²é‡‘å±¬é‚Šç·š */
        .inner-line {
            position: absolute; top: 10px; left: 10px; right: 10px; bottom: 10px;
            border: 1px solid rgba(197, 160, 89, 0.5); pointer-events: none; z-index: 5;
        }

        /* èƒŒæ™¯æµå‹•å½©å¸¶ SVG */
        .ribbon-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1; opacity: 0.15; pointer-events: none;
        }

        /* é‡‘å±¬äº®ç‰‡è£é£¾ */
        .confetti-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: radial-gradient(circle, #C5A059 1px, transparent 1px);
            background-size: 40px 40px;
            opacity: 0.1; z-index: 1;
        }

        /* å·¦ä¸Šæ—¥æœŸ - å¥¢è¯å­—é«” */
        .field-date {
            position: absolute; top: 35px; left: 45px;
            font-size: 32px; font-weight: 800;
            color: #C5A059; font-family: 'Montserrat';
            text-shadow: 0 2px 4px rgba(0,0,0,0.5); z-index: 10;
        }

        /* å³ä¸Šå§“åå€ */
        .field-name { position: absolute; top: 60px; right: 50px; text-align: right; z-index: 10; }
        .name-text { 
            font-family: 'Noto Serif TC', serif; font-size: 80px; font-weight: 900; 
            color: #fff; line-height: 1; text-shadow: 2px 2px 0px #8b6e37;
        }
        .title-text { 
            font-size: 26px; font-weight: 700; color: #C5A059; 
            letter-spacing: 5px; margin-top: 5px; text-transform: uppercase;
        }

        /* å•†å“æ¨™ç±¤ - æ›´åŠ ç«‹é«” */
        .field-product { position: absolute; top: 220px; right: 50px; display: flex; align-items: center; gap: 15px; z-index: 10; }
        .product-badge {
            background: linear-gradient(to bottom, #1e40af, #1e3a8a);
            color: white; font-size: 42px; font-weight: 900;
            padding: 2px 30px; border-radius: 4px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.4), inset 0 1px 1px rgba(255,255,255,0.3);
            border: 1px solid #3b82f6;
        }

        /* é‡‘é¡å€ */
        .field-amount { position: absolute; top: 300px; right: 50px; text-align: right; z-index: 10; }
        .amount-val {
            font-family: 'Montserrat'; font-size: 115px; font-weight: 800;
            color: #ef4444; line-height: 0.9; text-shadow: 0 5px 15px rgba(239, 68, 68, 0.3);
        }
        .amount-unit { font-size: 32px; font-weight: 900; color: #ef4444; margin-left: 10px; }

        /* å·¦ä¸‹è§’è¯éº—å¾½ç«  (æ–°å¢) */
        .laurel-award {
            position: absolute; bottom: 40px; left: 60px;
            width: 220px; height: 220px; z-index: 10;
            opacity: 0.9;
        }

        /* åº•éƒ¨çµ±è¨ˆè³‡è¨Š */
        .field-stats {
            position: absolute; bottom: 45px; right: 50px;
            display: flex; gap: 40px; z-index: 10;
        }
        .stat-box { text-align: right; }
        .stat-label { font-size: 18px; color: #94a3b8; margin-bottom: 2px; font-weight: bold; }
        .stat-value { font-size: 34px; font-weight: 800; color: #fff; font-family: 'Montserrat'; }
        .bonus-color { color: #facc15; }

        /* UIæ¨£å¼ä¸è®Š */
        .control-panel { background: #1a2233; padding: 25px; border-bottom: 4px solid #C5A059; }
        input, select { background: #2d3748; color: white; border: 1px solid #4a5568; padding: 12px; border-radius: 8px; width: 100%; margin-top: 5px;}
        .btn-gen { background: linear-gradient(to right, #C5A059, #8b6e37); color: #fff; font-weight: 800; padding: 16px; border-radius: 12px; width: 100%; margin-top: 20px; }
    </style>
</head>
<body>

<div id="app">
    <!-- UI æ§åˆ¶å€ (ç¯€éŒ„) -->
    <div class="control-panel">
        <h2 class="text-2xl font-black text-center mb-6 text-white tracking-widest">ğŸ† å“è¶Šç¸¾å„ªæ¦®è­½æ¦œ</h2>
        <div class="grid grid-cols-2 gap-4">
            <div><label>çµç®—æ—¥æœŸ</label><input type="date" v-model="globalDate"></div>
            <div>
                <label>ç¸¾å„ªäººå“¡</label>
                <select v-model="repIndex">
                    <option v-for="(rep, index) in repList" :value="index">{{ rep.name }}</option>
                </select>
            </div>
        </div>
        <div class="grid grid-cols-2 gap-4 mt-4">
            <div><label>å•†å“</label><select v-model="form.productType"><option>æµ·å¤–å‚µ</option><option>FCN</option><option>å…ƒå…ƒè‡´å¯Œ</option></select></div>
            <div><label>é‡‘é¡</label><input type="number" v-model="form.amount"></div>
        </div>
        <button @click="addToCart" class="w-full bg-blue-600 mt-4 py-2 rounded-lg font-bold">â• åŠ å…¥æ•¸æ“š</button>
        <button @click="generateImage" class="btn-gen shadow-xl" v-if="cart.length > 0">ç”Ÿæˆå¥¢è¯ç‰ˆæ¦®è­½æ¦œ</button>
    </div>

    <div id="preview-container">
        <div id="certificate-node" class="certificate" :style="scaleStyle">
            <div class="inner-line"></div>
            <div class="confetti-overlay"></div>
            
            <!-- æ»¿ç‰ˆå½©å¸¶ SVG -->
            <svg class="ribbon-overlay" viewBox="0 0 800 535">
                <path d="M-50,100 C150,50 350,250 550,150 S850,300 850,300" stroke="#C5A059" stroke-width="60" fill="none" opacity="0.3"/>
                <path d="M-50,400 C150,450 450,200 650,400 S850,350 850,350" stroke="#8b6e37" stroke-width="40" fill="none" opacity="0.2"/>
            </svg>

            <!-- å·¦ä¸Šæ—¥æœŸ -->
            <div class="field-date">{{ rocDate }}</div>

            <!-- å³ä¸Šå§“å -->
            <div class="field-name">
                <div class="name-text">{{ currentRep.name }}</div>
                <div class="title-text">{{ currentRep.title }}</div>
            </div>

            <!-- å·¦ä¸‹è§’æ¡‚å† å¾½ç«  -->
            <div class="laurel-award">
                <svg viewBox="0 0 200 200">
                    <defs>
                        <linearGradient id="goldGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:%23FDE68A;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:%23B45309;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <!-- æ¡‚å† è‘‰ -->
                    <path d="M50,150 Q20,100 50,50" fill="none" stroke="#C5A059" stroke-width="5" stroke-linecap="round"/>
                    <path d="M150,150 Q180,100 150,50" fill="none" stroke="#C5A059" stroke-width="5" stroke-linecap="round"/>
                    <!-- ä¸­å¤®äº”è§’æ˜Ÿ -->
                    <polygon points="100,60 115,100 155,100 125,125 135,165 100,140 65,165 75,125 45,100 85,100" fill="#C5A059" />
                    <circle cx="100" cy="110" r="70" stroke="#C5A059" stroke-width="2" fill="none" stroke-dasharray="5,5"/>
                    <text x="100" y="190" text-anchor="middle" fill="#C5A059" font-size="16" font-weight="900" letter-spacing="2">EXCELLENCE</text>
                </svg>
            </div>

            <!-- ä¸­é–“å•†å“ -->
            <div class="field-product">
                <div class="product-badge">{{ displayProduct }}</div>
                <div class="text-slate-400 font-bold">å…±è¨ˆ {{ cart.length }} ç­†æˆäº¤</div>
            </div>

            <!-- é‡‘é¡ -->
            <div class="field-amount">
                <span class="amount-val">{{ totalAmountDisplay }}</span>
                <span class="amount-unit">{{ displayCurrency }}</span>
            </div>

            <!-- åº•éƒ¨çµ±è¨ˆ -->
            <div class="field-stats">
                <div class="stat-box">
                    <div class="stat-label">PREMIUM INCOME</div>
                    <div class="stat-value">NT$ {{ formatNumber(totalRevenue) }}</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label bonus-color">ACHIEVEMENT BONUS</div>
                    <div class="stat-value bonus-color">NT$ {{ formatNumber(totalBonus) }}</div>
                </div>
            </div>
        </div>
    </div>

    <div id="result-area" class="text-center pb-20 hidden">
        <p class="text-yellow-500 font-bold mb-4">âœ¨ æ¦®è­½æ¦œç”ŸæˆæˆåŠŸï¼Œé•·æŒ‰å„²å­˜ âœ¨</p>
        <img id="final-img" class="mx-auto border-4 border-white shadow-2xl rounded-lg max-w-[95%]">
    </div>
</div>

<script>
    const { createApp, reactive, computed, ref, onMounted } = Vue;
    createApp({
        setup() {
            const windowWidth = ref(window.innerWidth);
            const globalDate = ref(new Date().toISOString().split('T')[0]);
            const repIndex = ref(3); 
            const cart = ref([]);
            const form = reactive({ productType: 'æµ·å¤–å‚µ', currency: 'USD', exRate: 32.5, amount: 27000, bp: 50 });

            const repList = [
                { name: 'å³å¤é”', title: 'æ¥­å‹™å”ç†' }, { name: 'é™³é›…éˆ´', title: 'æ¥­å‹™ç¶“ç†' },
                { name: 'è•­ç‰æ˜¥', title: 'æ¥­å‹™å”ç†' }, { name: 'é»ƒæ€å©·', title: 'æ¥­å‹™å”ç†' }
            ];

            const scaleStyle = computed(() => {
                const scale = Math.min((windowWidth.value - 40) / 800, 1);
                return { transform: `scale(${scale})`, marginBottom: `-${535 * (1 - scale)}px` };
            });

            onMounted(() => { window.addEventListener('resize', () => { windowWidth.value = window.innerWidth; }); });

            const rocDate = computed(() => {
                const d = new Date(globalDate.value);
                return `${d.getFullYear() - 1911} / ${d.getMonth() + 1} / ${d.getDate()}`;
            });

            const addToCart = () => {
                const rev = Math.round(form.amount * form.exRate * (form.bp / 10000));
                const bon = Math.round(rev * 0.25);
                cart.value.push({ ...form, revenue: rev, bonus: bon });
            };

            const totalRevenue = computed(() => cart.value.reduce((s, i) => s + i.revenue, 0));
            const totalBonus = computed(() => cart.value.reduce((s, i) => s + i.bonus, 0));
            const totalAmountDisplay = computed(() => cart.value.reduce((s, i) => s + i.amount, 0).toLocaleString());
            const displayProduct = computed(() => cart.value.length > 0 ? cart.value[0].productType : 'æµ·å¤–å‚µ');
            const displayCurrency = computed(() => cart.value.length > 0 ? (cart.value[0].currency === 'USD' ? 'ç¾å…ƒ' : cart.value[0].currency) : 'ç¾å…ƒ');

            const formatNumber = (num) => num.toLocaleString();

            const generateImage = () => {
                const node = document.getElementById("certificate-node");
                const oldTransform = node.style.transform;
                node.style.transform = "scale(1)";
                html2canvas(node, { scale: 3, useCORS: true }).then(canvas => {
                    document.getElementById("final-img").src = canvas.toDataURL("image/png");
                    document.getElementById("result-area").classList.remove('hidden');
                    node.style.transform = oldTransform;
                    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
                });
            };

            return { repList, repIndex, globalDate, form, cart, rocDate, scaleStyle, currentRep: computed(()=>repList[repIndex.value]), addToCart, totalRevenue, totalBonus, displayProduct, totalAmountDisplay, displayCurrency, formatNumber, generateImage };
        }
    }).mount('#app');
</script>
</body>
</html>