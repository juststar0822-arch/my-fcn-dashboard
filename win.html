<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¦®è­½æ¦œç”Ÿæˆå™¨</title>
    <!-- å¼•å…¥ html2canvas ç”¨æ–¼æˆªåœ– -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --gold: #D4AF37;
            --gold-light: #F9F1D8;
            --red: #C0392B;
            --dark: #2C3E50;
        }

        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        /* è¼¸å…¥å€å¡Šæ¨£å¼ */
        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 800px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .controls h2 {
            grid-column: 1 / -1;
            margin-top: 0;
            color: var(--dark);
            border-bottom: 2px solid var(--gold);
            padding-bottom: 10px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
        }

        input, select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        button {
            grid-column: 1 / -1;
            background-color: var(--gold);
            color: white;
            border: none;
            padding: 12px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 10px;
        }

        button:hover {
            background-color: #b39020;
        }

        /* çç‹€é è¦½å€å¡Š */
        #canvas-container {
            margin-top: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        /* çç‹€è¨­è¨ˆ CSS */
        .certificate {
            width: 800px;
            height: 500px;
            background: white;
            position: relative;
            overflow: hidden;
            border: 15px solid var(--gold);
            box-sizing: border-box;
            display: flex;
            background: radial-gradient(circle, #fff 60%, #fdfbf0 100%);
        }

        /* è£é£¾æ€§è§’è½èŠ±ç´‹ */
        .corner {
            position: absolute;
            width: 60px;
            height: 60px;
            border: 2px solid var(--gold);
        }
        .top-left { top: 10px; left: 10px; border-right: none; border-bottom: none; }
        .top-right { top: 10px; right: 10px; border-left: none; border-bottom: none; }
        .bottom-left { bottom: 10px; left: 10px; border-right: none; border-top: none; }
        .bottom-right { bottom: 10px; right: 10px; border-left: none; border-top: none; }

        /* å·¦å´åœ–ç‰‡å€ */
        .left-section {
            width: 40%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        /* çç›ƒ SVG */
        .trophy-svg {
            width: 220px;
            height: 220px;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.2));
        }

        /* è³€å­—å°ç«  */
        .stamp {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 80px;
            font-family: "KaiTi", "BiauKai", serif;
            color: rgba(192, 57, 43, 0.8);
            border: 5px solid rgba(192, 57, 43, 0.8);
            border-radius: 50%;
            width: 120px;
            height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
            transform: rotate(-15deg);
            z-index: 10;
            background: rgba(255, 255, 255, 0.8);
        }

        /* æ—¥æœŸ */
        .date-tag {
            position: absolute;
            top: 15px;
            left: 15px;
            background: var(--gold);
            color: white;
            padding: 5px 15px;
            font-weight: bold;
            font-size: 20px;
            border-radius: 0 0 10px 0;
            z-index: 20;
        }

        /* å³å´æ–‡å­—å€ */
        .right-section {
            width: 60%;
            padding: 30px 40px 30px 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .name-title-row {
            display: flex;
            align-items: baseline;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--gold-light);
            padding-bottom: 10px;
        }

        .agent-name {
            font-size: 64px;
            font-weight: 900;
            color: var(--dark);
            margin-right: 15px;
            letter-spacing: 2px;
        }

        .agent-title {
            font-size: 24px;
            color: #666;
            font-weight: normal;
        }

        .product-tag {
            display: inline-block;
            border: 2px solid var(--dark);
            color: var(--dark);
            font-size: 40px;
            font-weight: bold;
            padding: 5px 20px;
            margin-bottom: 15px;
            width: fit-content;
        }

        .amount-row {
            margin-bottom: 15px;
        }

        .amount-value {
            font-size: 60px;
            color: var(--red);
            font-weight: 900;
            font-family: Arial, sans-serif;
        }

        .currency {
            font-size: 24px;
            color: var(--red);
            font-weight: bold;
        }

        .details-box {
            background: var(--gold-light);
            padding: 15px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .detail-item {
            font-size: 20px;
            color: #555;
            display: flex;
            justify-content: space-between;
        }
        
        .detail-item strong {
            color: var(--dark);
        }

    </style>
</head>
<body>

    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="controls">
        <h2>ğŸ† æ¥­ç¸¾æ¦®è­½æ¦œç”Ÿæˆå™¨</h2>
        
        <div class="form-group">
            <label>éŠ·å”®æ—¥æœŸ (è‡ªå‹•è½‰æ›æ°‘åœ‹å¹´)</label>
            <input type="date" id="inputDate" value="">
        </div>

        <div class="form-group">
            <label>ç†å°ˆ/æ¥­ä»£å§“å</label>
            <select id="inputName">
                <option value="é»ƒæ€å©·">é»ƒæ€å©·</option>
                <option value="è•­ç‰æ˜¥">è•­ç‰æ˜¥</option>
                <option value="æ—å°æ˜">æ—å°æ˜</option>
                <option value="é™³å¤§æ–‡">é™³å¤§æ–‡</option>
            </select>
        </div>

        <div class="form-group">
            <label>è·ç¨±</label>
            <input type="text" id="inputTitle" value="æ¥­å‹™å”ç†">
        </div>

        <div class="form-group">
            <label>éŠ·å”®å•†å“</label>
            <select id="inputProduct">
                <option value="FCN">FCN (è‚¡æ¬Šé€£çµ)</option>
                <option value="æµ·å¤–å‚µ">æµ·å¤–å‚µåˆ¸</option>
                <option value="åŸºé‡‘">åŸºé‡‘</option>
                <option value="ä¿éšª">ä¿éšª</option>
            </select>
        </div>

        <div class="form-group">
            <label>éŠ·å”®é‡‘é¡ (ç¾å…ƒ/åŸå¹£)</label>
            <input type="number" id="inputAmount" placeholder="ä¾‹å¦‚: 20000">
        </div>

        <div class="form-group">
            <label>æ‰‹çºŒè²»æ”¶å…¥ (æ‰‹æ”¶)</label>
            <input type="number" id="inputRevenue" placeholder="ä¾‹å¦‚: 15169">
        </div>

        <div class="form-group">
            <label>çé‡‘è¨ˆç®—æ¯”ç‡ (%)</label>
            <input type="number" id="inputRate" value="25" placeholder="25">
        </div>

        <div class="form-group">
            <label>è¨ˆç®—çµæœ (é è¦½)</label>
            <div style="padding: 8px; background: #eee; border-radius: 4px;">
                çé‡‘: <span id="previewBonus" style="color:red; font-weight:bold;">0</span> å…ƒ
            </div>
        </div>

        <button onclick="generateImage()">ä¸‹è¼‰çç‹€åœ–ç‰‡ (PNG)</button>
    </div>

    <!-- çç‹€é¡¯ç¤ºå€åŸŸ (éš±è—çš„DOMï¼Œç”¨æ–¼ç”Ÿæˆåœ–ç‰‡) -->
    <div id="canvas-container">
        <div class="certificate" id="certificate">
            <!-- è£é£¾è§’ -->
            <div class="corner top-left"></div>
            <div class="corner top-right"></div>
            <div class="corner bottom-left"></div>
            <div class="corner bottom-right"></div>

            <!-- æ—¥æœŸæ¨™ç±¤ -->
            <div class="date-tag" id="dispDate">115/1/12</div>

            <!-- å·¦å´ -->
            <div class="left-section">
                <!-- è³€ å°ç«  -->
                <div class="stamp">è³€</div>
                
                <!-- çç›ƒ SVG (å…§åµŒä»£ç¢¼ä»¥ç¢ºä¿æˆªåœ–æ­£å¸¸) -->
                <svg class="trophy-svg" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="goldGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#F2C94C;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#F2994A;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <path fill="url(#goldGrad)" d="M416 96H352V64C352 28.7 323.3 0 288 0H224C188.7 0 160 28.7 160 64V96H96C43 96 0 139 0 192C0 239.5 34.5 279 80 286.6C85.5 353.9 142.1 406.4 210.7 414.7C203.4 429.3 199.3 445.8 199.3 463.1L200 480H128C110.3 480 96 494.3 96 512H416C416 494.3 401.7 480 384 480H312L312.7 463.1C312.7 445.8 308.6 429.3 301.3 414.7C369.9 406.4 426.5 353.9 432 286.6C477.5 279 512 239.5 512 192C512 139 469 96 416 96zM96 240C69.5 240 48 218.5 48 192C48 165.5 69.5 144 96 144H160V240H96zM368 464H144V448C144 421.5 165.5 400 192 400H320C346.5 400 368 421.5 368 448V464zM352 240H288V64H224V240H160V288C160 323.3 188.7 352 224 352H288C323.3 352 352 323.3 352 288V240zM416 240H352V144H416C442.5 144 464 165.5 464 192C464 218.5 442.5 240 416 240z"/>
                </svg>
            </div>

            <!-- å³å´ -->
            <div class="right-section">
                <div class="name-title-row">
                    <div class="agent-name" id="dispName">é»ƒæ€å©·</div>
                    <div class="agent-title" id="dispTitle">æ¥­å‹™å”ç†</div>
                </div>

                <div class="product-tag" id="dispProduct">FCN</div>

                <div class="amount-row">
                    <span class="amount-value" id="dispAmount">20,000</span>
                    <span class="currency">ç¾å…ƒ</span>
                </div>

                <div class="details-box">
                    <div class="detail-item">
                        <span>æ‰‹æ”¶ Contribution</span>
                        <strong>$<span id="dispRevenue">0</span></strong>
                    </div>
                    <div class="detail-item" style="border-top: 1px dashed #ccc; padding-top:5px; margin-top:5px;">
                        <span style="color: var(--red);">çé‡‘ Bonus</span>
                        <strong style="color: var(--red); font-size: 24px;">$<span id="dispBonus">0</span></strong>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–æ—¥æœŸç‚ºä»Šå¤©
        document.getElementById('inputDate').valueAsDate = new Date();

        // ç›£è½æ‰€æœ‰è¼¸å…¥æ¡†çš„è®ŠåŒ–
        const inputs = document.querySelectorAll('input, select');
        inputs.forEach(input => {
            input.addEventListener('input', updateCard);
        });

        function formatMoney(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function updateCard() {
            // å–å¾—è¼¸å…¥å€¼
            const dateVal = new Date(document.getElementById('inputDate').value);
            const name = document.getElementById('inputName').value;
            const title = document.getElementById('inputTitle').value;
            const product = document.getElementById('inputProduct').value;
            const amount = parseFloat(document.getElementById('inputAmount').value) || 0;
            const revenue = parseFloat(document.getElementById('inputRevenue').value) || 0;
            const rate = parseFloat(document.getElementById('inputRate').value) || 0;

            // è¨ˆç®—çé‡‘ (æ‰‹æ”¶ * ç™¾åˆ†æ¯”)
            const bonus = Math.round(revenue * (rate / 100));

            // æ›´æ–°é è¦½æ–‡å­—
            document.getElementById('previewBonus').textContent = formatMoney(bonus);

            // æ›´æ–°çç‹€å…§å®¹
            
            // è™•ç†æ°‘åœ‹å¹´
            const rocYear = dateVal.getFullYear() - 1911;
            const rocDateStr = `${rocYear}/${dateVal.getMonth() + 1}/${dateVal.getDate()}`;
            document.getElementById('dispDate').textContent = rocDateStr;

            document.getElementById('dispName').textContent = name;
            document.getElementById('dispTitle').textContent = title;
            document.getElementById('dispProduct').textContent = product;
            document.getElementById('dispAmount').textContent = formatMoney(amount);
            document.getElementById('dispRevenue').textContent = formatMoney(revenue);
            document.getElementById('dispBonus').textContent = formatMoney(bonus);
        }

        // æˆªåœ–ä¸‹è¼‰åŠŸèƒ½
        function generateImage() {
            const element = document.getElementById("certificate");
            
            // ä½¿ç”¨ html2canvas
            html2canvas(element, {
                scale: 2, // æé«˜è§£æåº¦
                backgroundColor: null
            }).then(canvas => {
                // å»ºç«‹ä¸‹è¼‰é€£çµ
                const link = document.createElement("a");
                const rocDate = document.getElementById('dispDate').textContent.replace(/\//g, "");
                const name = document.getElementById('dispName').textContent;
                
                link.download = `${rocDate}_${name}_æ¦®è­½æ¦œ.png`;
                link.href = canvas.toDataURL("image/png");
                link.click();
            });
        }

        // åˆå§‹åŒ–åŸ·è¡Œä¸€æ¬¡
        updateCard();
    </script>
</body>
</html>