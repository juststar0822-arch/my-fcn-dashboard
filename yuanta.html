<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>元元致富 - 專業試算系統</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { background: #f1f5f9; font-family: 'Inter', "Microsoft JhengHei", sans-serif; color: #1e293b; }
        .card-shadow { box-shadow: 0 10px 30px -5px rgba(0,0,0,0.05); }
        .input-box { background: #f8fafc; border: 1.5px solid #e2e8f0; border-radius: 12px; padding: 12px; width: 100%; font-weight: bold; }
        .input-box:focus { border-color: #2563eb; outline: none; background: white; }
        .res-card { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); color: white; border-radius: 2rem; }
        .toggle-btn { flex: 1; padding: 10px; border-radius: 10px; font-weight: bold; font-size: 13px; transition: 0.3s; }
        .active-blue { background: #2563eb; color: white; box-shadow: 0 4px 10px rgba(37,99,235,0.2); }
        .active-dark { background: #334155; color: white; }
        [v-cloak] { display: none; }
    </style>
</head>
<body class="p-4 md:p-10">
    <div id="app" v-cloak class="max-w-md mx-auto">
        
        <div class="text-center mb-6">
            <h1 class="text-2xl font-black text-slate-800 tracking-tighter uppercase italic">元元致富 <span class="text-blue-600">Pro</span></h1>
            <p class="text-[10px] font-bold text-slate-400 mt-1 tracking-[0.2em]">YUANTA LIFE ILP SIMULATOR</p>
        </div>

        <!-- 1. 核心輸入區 -->
        <div class="bg-white rounded-3xl p-6 card-shadow mb-4 space-y-5">
            <!-- 險種切換 -->
            <div>
                <label class="block text-[10px] font-black text-slate-400 mb-2 uppercase">商品類型</label>
                <div class="flex bg-slate-100 p-1 rounded-xl gap-1">
                    <button @click="form.type = 'annuity'" :class="['toggle-btn', form.type==='annuity'?'active-blue':'text-slate-400']">變額年金險</button>
                    <button @click="form.type = 'life'" :class="['toggle-btn', form.type==='life'?'active-blue':'text-slate-400']">變額萬能壽險</button>
                </div>
            </div>

            <!-- 標的選擇 -->
            <div>
                <label class="block text-[10px] font-black text-slate-400 mb-2 uppercase">連結投資標的</label>
                <select v-model="form.target" class="input-box text-sm">
                    <option v-for="t in targets" :value="t">{{ t.name }} (預估 {{ t.rate }}%)</option>
                </select>
            </div>

            <!-- 金額與保額 -->
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-[10px] font-black text-slate-500 mb-1">投資金額 (萬)</label>
                    <div class="relative">
                        <input type="number" v-model="form.amount" class="input-box pr-10">
                        <span class="absolute right-3 top-3 text-xs font-bold text-slate-400">{{ form.currency }}</span>
                    </div>
                </div>
                <div v-if="form.type === 'life'">
                    <label class="block text-[10px] font-black text-slate-500 mb-1">基本保額 (萬)</label>
                    <input type="number" v-model="form.lifeAmount" class="input-box">
                </div>
                <div v-else class="flex flex-col justify-end">
                    <div class="bg-slate-50 p-3 rounded-xl text-[10px] font-bold text-slate-400 text-center border border-dashed border-slate-200">年化撥回率: {{ form.yield }}%</div>
                </div>
            </div>

            <!-- 性別年齡 (僅壽險) -->
            <div v-if="form.type === 'life'" class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-[10px] font-black text-slate-500 mb-1">被保險人年齡</label>
                    <input type="number" v-model="form.age" class="input-box">
                </div>
                <div>
                    <label class="block text-[10px] font-black text-slate-500 mb-1">性別</label>
                    <div class="flex bg-slate-100 p-1 rounded-xl">
                        <button @click="form.gender = 'male'" :class="['flex-1 py-1.5 rounded-lg text-[11px] font-bold transition', form.gender==='male'?'bg-white text-blue-600 shadow-sm':'text-slate-400']">男</button>
                        <button @click="form.gender = 'female'" :class="['flex-1 py-1.5 rounded-lg text-[11px] font-bold transition', form.gender==='female'?'bg-white text-pink-600 shadow-sm':'text-slate-400']">女</button>
                    </div>
                </div>
            </div>

            <!-- 保單年度選擇 (影響行政費) -->
            <div>
                <label class="block text-[10px] font-black text-slate-400 mb-2 uppercase">保單年度 (影響行政費率)</label>
                <div class="flex bg-slate-100 p-1 rounded-xl gap-1">
                    <button @click="form.year = 1" :class="['toggle-btn', form.year <= 3 ? 'active-dark':'text-slate-400']">1-3年</button>
                    <button @click="form.year = 4" :class="['toggle-btn', form.year === 4 ? 'active-dark':'text-slate-400']">第4年</button>
                    <button @click="form.year = 5" :class="['toggle-btn', form.year >= 5 ? 'active-dark':'text-slate-400']">5年起(免)</button>
                </div>
            </div>
        </div>

        <!-- 2. 計算結果卡片 -->
        <div class="res-card p-8 shadow-2xl relative overflow-hidden mb-6">
            <div class="absolute -right-10 -bottom-10 w-40 h-40 bg-white/5 rounded-full"></div>
            <div class="relative z-10">
                <div class="flex justify-between items-start">
                    <p class="text-xs font-bold text-white/50 uppercase tracking-widest">預估每月淨領現金流</p>
                    <button @click="fetchRates" class="text-[9px] bg-white/10 px-2 py-1 rounded font-bold"><i class="fa-solid fa-rotate mr-1" :class="{'animate-spin': isSyncing}"></i>匯率 {{ rates.USD.toFixed(2) }}</button>
                </div>
                
                <div class="mt-6">
                    <p class="text-5xl font-black italic tracking-tighter">
                        {{ form.currency == 'USD' ? '$' : 'NT$' }} {{ formatNum(netPayout) }}
                    </p>
                    <p class="text-[10px] font-bold text-white/40 mt-1 uppercase">Net Monthly Cashflow (Post-Fees)</p>
                </div>

                <div class="mt-8 pt-6 border-t border-white/10 space-y-2">
                    <div class="flex justify-between text-[11px] font-bold">
                        <span class="text-white/40">每月費用總計</span>
                        <span class="text-red-400">-{{ form.currency==='USD'?'$':'NT$' }} {{ formatNum(totalMonthlyFees) }}</span>
                    </div>
                    <div class="flex justify-between text-[11px] font-bold">
                        <span class="text-white/40">約當新台幣</span>
                        <span class="text-yellow-400 font-black">NT$ {{ formatNum(netPayoutTWD) }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. 費用明細說明 -->
        <div class="bg-white rounded-3xl p-6 card-shadow text-[11px] font-bold text-slate-500 mb-10">
            <h3 class="text-slate-800 mb-3 border-b pb-2">預估費用扣除明細 (每月)</h3>
            <div class="space-y-2">
                <div class="flex justify-between"><span>保單維護費</span><span :class="form.amountTWD >= 300 ? 'text-emerald-500':'text-slate-800'">{{ maintenanceFeeDisplay }}</span></div>
                <div class="flex justify-between"><span>保單行政費 ({{ adminRateDisplay }}%)</span><span>{{ form.currency==='USD'?'$':'NT$' }} {{ formatNum(adminFee) }}</span></div>
                <div v-if="form.type === 'life'" class="flex justify-between"><span>壽險成本 (COI)</span><span class="text-red-500">{{ form.currency==='USD'?'$':'NT$' }} {{ formatNum(coiFee) }}</span></div>
                <div v-else class="flex justify-between"><span>壽險成本 (COI)</span><span class="text-emerald-500">免收</span></div>
            </div>
        </div>

        <p class="text-[10px] font-bold text-slate-400 text-center italic px-4 pb-20">
            ※ 以上試算已扣除每月保單管理費及壽險成本。實際費用依保單約定及元大人壽最新公告為主。<br>
            ※ 投保金額達 300 萬台幣以上免收每月 100 元維護費。
        </p>

    </div>

    <script>
        const { createApp } = Vue;

        // 簡化版 COI 費率表 (每萬元保額/月)
        const COI_TABLE = {
            male: { 20:0.36, 25:0.41, 30:0.55, 35:0.81, 40:1.27, 45:2.01, 50:2.89, 55:4.22, 60:6.22, 65:9.39, 70:15.42, 75:23.90, 80:37.65 },
            female: { 20:0.15, 25:0.20, 30:0.26, 35:0.37, 40:0.55, 45:0.85, 50:1.19, 55:1.80, 60:2.77, 65:4.67, 70:8.10, 75:13.61, 80:23.99 }
        };

        createApp({
            data() {
                return {
                    isSyncing: false,
                    rates: { USD: 32.5 },
                    targets: [
                        { name: '安聯收益成長基金 (後收)', rate: 8.0 },
                        { name: '財富雙享類全委帳戶', rate: 5.0 }
                    ],
                    form: {
                        type: 'life',
                        target: { name: '安聯收益成長基金 (後收)', rate: 8.0 },
                        currency: 'USD',
                        amount: 10,
                        lifeAmount: 500,
                        yield: 8.0,
                        age: 40,
                        gender: 'male',
                        year: 1
                    }
                }
            },
            watch: {
                'form.target'(newVal) { this.form.yield = newVal.rate; }
            },
            computed: {
                formAmountTWD() {
                    return this.form.currency === 'USD' ? this.form.amount * this.rates.USD : this.form.amount;
                },
                // 1. 維護費: 300萬免
                maintenanceFeeTWD() {
                    return this.formAmountTWD >= 300 ? 0 : 100;
                },
                maintenanceFeeDisplay() {
                    return this.formAmountTWD >= 300 ? '高保費優惠 (免收)' : 'NT$ 100';
                },
                // 2. 行政費: 分階層
                adminRateDisplay() {
                    if (this.form.year >= 5) return 0;
                    if (this.form.year === 4) return this.formAmountTWD >= 1000 ? 0.1 : 0.12;
                    return this.formAmountTWD >= 1000 ? 0.155 : 0.16;
                },
                adminFee() {
                    const monthlyRate = (this.adminRateDisplay / 100);
                    return this.form.amount * 10000 * monthlyRate;
                },
                // 3. 壽險費 (COI)
                coiFee() {
                    if (this.form.type === 'annuity') return 0;
                    // 計算淨危險保額 = 保額 - 投資額 (萬)
                    const netAmountAtRisk = Math.max(0, this.form.lifeAmount - (this.form.currency==='USD' ? this.form.amount*this.rates.USD : this.form.amount));
                    if (netAmountAtRisk <= 0) return 0;

                    // 找出費率 (找最接近的年齡)
                    const ages = Object.keys(COI_TABLE[this.form.gender]);
                    const closestAge = ages.reduce((prev, curr) => Math.abs(curr - this.form.age) < Math.abs(prev - this.form.age) ? curr : prev);
                    const rate = COI_TABLE[this.form.gender][closestAge];
                    
                    const feeTWD = (netAmountAtRisk) * rate;
                    return this.form.currency === 'USD' ? feeTWD / this.rates.USD : feeTWD;
                },
                totalMonthlyFees() {
                    const maint = this.form.currency === 'USD' ? (this.maintenanceFeeTWD / this.rates.USD) : this.maintenanceFeeTWD;
                    return maint + this.adminFee + this.coiFee;
                },
                netPayout() {
                    const gross = (this.form.amount * 10000 * (this.form.yield / 100)) / 12;
                    const res = gross - this.totalMonthlyFees;
                    return res > 0 ? res : 0;
                },
                netPayoutTWD() {
                    return this.form.currency === 'USD' ? this.netPayout * this.rates.USD : this.netPayout;
                }
            },
            methods: {
                formatNum(n) { return Math.floor(n).toLocaleString(); },
                async fetchRates() {
                    this.isSyncing = true;
                    try {
                        const res = await fetch(`https://corsproxy.io/?${encodeURIComponent('https://query1.finance.yahoo.com/v8/finance/chart/USDTWD=X?range=1d&interval=1d')}`);
                        const json = await res.json();
                        const rate = json.chart.result[0].meta.regularMarketPrice;
                        if(rate) this.rates.USD = rate;
                    } catch (e) { console.error('匯率同步失敗'); }
                    this.isSyncing = false;
                }
            },
            mounted() { this.fetchRates(); }
        }).mount('#app');
    </script>
</body>
</html>
