<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…ƒå…ƒè‡´å¯Œ - è²¡å¯Œé›™äº«å°ˆæ¥­ç²¾ç®—ç³»çµ±</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { background: #f8fafc; font-family: 'Inter', "Microsoft JhengHei", sans-serif; color: #1e293b; }
        .bank-card { background: white; border-radius: 2rem; border: 1px solid #e2e8f0; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .res-card { background: linear-gradient(135deg, #1e293b 0%, #334155 100%); color: white; border-radius: 2rem; }
        .input-box { background: #f1f5f9; border: 1.5px solid #e2e8f0; border-radius: 12px; padding: 12px; width: 100%; font-weight: bold; text-align: center; }
        .bonus-tag { background: #fef3c7; color: #92400e; border: 1px solid #fde68a; font-size: 10px; padding: 2px 8px; border-radius: 20px; font-weight: 800; }
        .active-bonus { background: #dcfce7 !important; color: #166534 !important; border-color: #bbf7d0 !important; }
        [v-cloak] { display: none; }
        .slider { -webkit-appearance: none; width: 100%; height: 6px; background: #e2e8f0; border-radius: 5px; outline: none; }
        .slider::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; background: #2563eb; border-radius: 50%; cursor: pointer; }
    </style>
</head>
<body class="p-4 md:p-10">
    <div id="app" v-cloak class="max-w-md mx-auto pb-20">
        
        <div class="text-center mb-6">
            <h1 class="text-2xl font-black text-slate-800 tracking-tighter italic">å…ƒå…ƒè‡´å¯Œ <span class="text-blue-600 font-bold">è²¡å¯Œé›™äº«ç‰ˆ</span></h1>
            <p class="text-[10px] font-bold text-slate-400 mt-1 tracking-widest uppercase">Professional Multi-Tier Payout Terminal</p>
        </div>

        <!-- 1. æ ¸å¿ƒè¼¸å…¥é¢æ¿ -->
        <div class="bank-card p-6 mb-4 space-y-5">
            <!-- éšªç¨®é¸æ“‡ -->
            <div class="flex bg-slate-100 p-1 rounded-xl">
                <button @click="form.type = 'annuity'" :class="['flex-1 py-2 rounded-lg font-bold text-xs transition', form.type==='annuity'?'bg-white shadow-sm text-blue-600':'text-slate-400']">è®Šé¡å¹´é‡‘éšª</button>
                <button @click="form.type = 'life'" :class="['flex-1 py-2 rounded-lg font-bold text-xs transition', form.type==='life'?'bg-white shadow-sm text-blue-600':'text-slate-400']">è®Šé¡è¬èƒ½å£½éšª</button>
            </div>

            <!-- æ¨™çš„é¸æ“‡èˆ‡åŠ ç¢¼é‚è¼¯ -->
            <div>
                <label class="block text-[10px] font-black text-slate-500 mb-2 uppercase">é€£çµæ¨™çš„ (è‡ªå‹•åˆ¤å®šåŠ ç¢¼æ©Ÿåˆ¶)</label>
                <div class="space-y-2">
                    <button v-for="t in targets" @click="selectTarget(t)" :class="['w-full text-left p-4 rounded-2xl border transition', form.target.name === t.name ? 'border-blue-600 bg-blue-50' : 'border-slate-100 bg-slate-50']">
                        <div class="flex justify-between items-center">
                            <span class="text-sm font-black text-slate-800">{{ t.name }}</span>
                            <span v-if="t.hasBonus" :class="['bonus-tag', currentPayoutRate > 5 ? 'active-bonus' : '']">
                                {{ currentPayoutRate > 5 ? 'ğŸ”¥ åŠ ç¢¼ä¸­' : 'é” 10.3 åŠ ç¢¼' }}
                            </span>
                        </div>
                    </button>
                </div>
            </div>

            <!-- æ·¨å€¼æ¨¡æ“¬å™¨ (é€™å°æ¥­ä»£è§£èªªè¶…æœ‰ç”¨) -->
            <div class="bg-slate-50 p-4 rounded-2xl border border-slate-100">
                <div class="flex justify-between items-end mb-2">
                    <label class="text-[10px] font-black text-slate-400">æ¨¡æ“¬å¸³æˆ¶æ·¨å€¼ (NAV)</label>
                    <span class="text-lg font-black text-blue-600 font-mono">{{ simNAV.toFixed(2) }}</span>
                </div>
                <input type="range" min="7.5" max="11.5" step="0.01" v-model="simNAV" class="slider">
                <div class="flex justify-between text-[9px] font-bold text-slate-300 mt-1">
                    <span>7.50 (ä½æ–¼8ä¸æ’¥å›)</span>
                    <span class="text-orange-400">10.30 åŠ ç¢¼é–€æª»</span>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-[10px] font-black text-slate-500 mb-1">æŠ•å…¥é‡‘é¡ (USD è¬)</label>
                    <input type="number" v-model="form.amount" class="input-box">
                </div>
                <div>
                    <label class="block text-[10px] font-black text-slate-500 mb-1">åŒ¯ç‡ (USD/TWD)</label>
                    <div class="relative">
                        <input type="number" v-model="rates.USD" step="0.01" class="input-box text-emerald-600">
                        <i @click="fetchRates" class="fa-solid fa-rotate absolute right-2 top-3 text-slate-300 cursor-pointer"></i>
                    </div>
                </div>
            </div>

            <div v-if="form.type === 'life'" class="grid grid-cols-2 gap-4 fade-in">
                <div><label class="block text-[10px] font-black text-slate-500 mb-1">å£½éšªä¿é¡ (è¬TWD)</label><input type="number" v-model="form.lifeAmount" class="input-box"></div>
                <div><label class="block text-[10px] font-black text-slate-500 mb-1">è¢«ä¿äººå¹´é½¡</label><input type="number" v-model="form.age" class="input-box"></div>
            </div>
        </div>

        <!-- 2. ç²¾ç®—çµæœå¡ç‰‡ -->
        <div class="res-card p-8 shadow-2xl relative overflow-hidden mb-4">
            <div class="absolute -right-10 -top-10 w-40 h-40 bg-white/5 rounded-full"></div>
            <div class="relative z-10">
                <p class="text-xs font-bold text-white/50 uppercase tracking-widest mb-4">é ä¼°æ¯æœˆæ·¨é ˜ç¾é‡‘æµ</p>
                
                <div class="flex items-baseline gap-2">
                    <span class="text-5xl font-black italic tracking-tighter">$ {{ formatNum(netPayout, 2) }}</span>
                    <span class="text-xs bg-white/20 px-2 py-0.5 rounded font-bold">å·²æ‰£é™¤æ‰€æœ‰è²»ç”¨</span>
                </div>
                <p class="text-[10px] font-bold text-white/30 mt-1 uppercase">Post-Fee Monthly Net Payout (USD)</p>

                <div class="mt-8 pt-6 border-t border-white/10 flex justify-between items-end">
                    <div>
                        <p class="text-xs font-bold text-yellow-400 uppercase tracking-widest">ç´„ç•¶æ–°å°å¹£</p>
                        <p class="text-3xl font-black text-yellow-400 italic">NT$ {{ formatNum(netPayoutTWD) }}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-[10px] font-bold text-white/40 uppercase">é ä¼°å¹´åŒ–æ’¥å›ç‡</p>
                        <p class="text-xl font-black text-white italic">{{ currentPayoutRate }}%</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. å–®ä½æ•¸èˆ‡æ˜ç´° -->
        <div class="grid grid-cols-2 gap-3 mb-4">
            <div class="bg-white p-4 rounded-3xl border border-slate-100 card-shadow">
                <p class="text-[9px] font-bold text-slate-400 uppercase">é ä¼°è²·å…¥å–®ä½æ•¸</p>
                <p class="text-lg font-black text-slate-800">{{ formatNum(totalUnits, 2) }} <span class="text-[10px] font-normal">Units</span></p>
            </div>
            <div class="bg-white p-4 rounded-3xl border border-slate-100 card-shadow text-right">
                <p class="text-[9px] font-bold text-slate-400 uppercase">æ¯å–®ä½æ’¥å›é‡‘é¡</p>
                <p class="text-lg font-black text-blue-600">$ {{ formatNum(payoutPerUnit, 4) }}</p>
            </div>
        </div>

        <!-- 4. è²»ç”¨æ˜ç´° (å…ƒå…ƒè‡´å¯Œå°ˆå±¬) -->
        <div class="bank-card p-6 text-[11px] font-bold text-slate-500">
            <h3 class="text-slate-800 mb-3 border-b pb-2 flex justify-between uppercase">
                <span>Monthly Fee Breakdown</span>
                <span class="text-blue-500 font-black italic">å…ƒå…ƒè‡´å¯Œå°ˆå±¬è²»ç‡</span>
            </h3>
            <div class="space-y-2">
                <div class="flex justify-between">
                    <span>ä¿å–®ç¶­è­·è²» (300è¬å…æ”¶)</span>
                    <span :class="formAmountTWD >= 300 ? 'text-emerald-500':'text-slate-800'">
                        {{ formAmountTWD >= 300 ? 'é«˜ä¿è²»å„ªæƒ  $0' : 'NT$ 100' }}
                    </span>
                </div>
                <div class="flex justify-between">
                    <span>ä¿å–®è¡Œæ”¿è²» (0.16% / 1-3å¹´)</span>
                    <span>$ {{ formatNum(adminFee, 2) }}</span>
                </div>
                <div v-if="form.type === 'life'" class="flex justify-between">
                    <span>å£½éšªä¿éšªæˆæœ¬ (COI)</span>
                    <span class="text-red-500">$ {{ formatNum(coiFee, 2) }}</span>
                </div>
                <div class="flex justify-between border-t pt-2 mt-2 font-black text-slate-800">
                    <span>æ¯æœˆè²»ç”¨ç¸½è¨ˆ</span>
                    <span>$ {{ formatNum(totalMonthlyFees, 2) }}</span>
                </div>
            </div>
        </div>

        <p class="mt-8 text-[10px] font-bold text-slate-400 text-center leading-relaxed">
            â€» è©¦ç®—é‚è¼¯ï¼šæ·¨å€¼ &ge; 10.3 æ’¥å› 6%ï¼›8.0 &le; æ·¨å€¼ < 10.3 æ’¥å› 5%ã€‚<br>
            â€» ä»¥ä¸Šé‡‘é¡ä¿‚ä¾æ“šæ¨¡æ“¬æ·¨å€¼è¨ˆç®—ï¼Œå¯¦éš›æ‡‰ä»¥æ¯æœˆçµç®—æ—¥ä¹‹æ·¨å€¼ç‚ºæº–ã€‚<br>
            <span class="text-blue-500 italic">ä»¥ä¸Šè³‡æ–™åƒ…ä¾›è©¦ç®—åƒè€ƒï¼Œå¯¦éš›æ•¸æ“šä¾å…ƒå¤§äººå£½ä¿å–®è¦ç¯„ã€‚</span>
        </p>

    </div>

    <script>
        const { createApp } = Vue;

        // ç°¡åŒ–ç‰ˆ COI å£½éšªè²»ç‡è¡¨ (æ¯è¬å…ƒä¿é¡/æœˆ)
        const COI_TABLE = { 20:0.36, 30:0.55, 40:1.27, 50:2.89, 60:6.22, 70:15.42 };

        createApp({
            data() {
                return {
                    isSyncing: false,
                    isGenerated: true,
                    simNAV: 10.00, // é è¨­æ¨¡æ“¬æ·¨å€¼
                    rates: { USD: 32.55 },
                    targets: [
                        { name: 'è²¡å¯Œé›™äº«æŠ•è³‡å¸³æˆ¶ (ç¾é‡‘)', hasBonus: true },
                        { name: 'å®‰è¯æ”¶ç›Šæˆé•·åŸºé‡‘ (å¾Œæ”¶å‹)', hasBonus: false }
                    ],
                    form: {
                        type: 'life',
                        target: { name: 'è²¡å¯Œé›™äº«æŠ•è³‡å¸³æˆ¶ (ç¾é‡‘)', hasBonus: true },
                        amount: 10, // 10è¬ç¾é‡‘
                        lifeAmount: 500, // 500è¬å°å¹£ä¿é¡
                        age: 40,
                        currency: 'USD'
                    }
                }
            },
            computed: {
                formAmountTWD() { return this.form.amount * this.rates.USD; },
                // æ ¸å¿ƒï¼šåˆ¤å®šæ’¥å›ç‡ (æ ¹æ“šè²¡å¯Œé›™äº«æ©Ÿåˆ¶)
                currentPayoutRate() {
                    if (!this.form.target.hasBonus) return 8.0; // å®‰è¯å›ºå®š 8%
                    if (this.simNAV >= 10.3) return 6.0;
                    if (this.simNAV >= 8.0) return 5.0;
                    return 0;
                },
                // æ¯å–®ä½æ’¥å›é‡‘é¡ (ç¾é‡‘)
                payoutPerUnit() {
                    if (this.currentPayoutRate === 0) return 0;
                    // ä»¥å¸³æˆ¶æ·¨å€¼è¨ˆç®—
                    return (this.simNAV * (this.currentPayoutRate / 100)) / 12;
                },
                totalUnits() {
                    return (this.form.amount * 10000) / this.simNAV;
                },
                // è²»ç”¨è¨ˆç®—
                adminFee() {
                    return this.form.amount * 10000 * (0.16 / 100);
                },
                coiFee() {
                    if (this.form.type === 'annuity') return 0;
                    const nar = Math.max(0, this.form.lifeAmount - (this.form.amount * this.rates.USD));
                    const rate = COI_TABLE[this.form.age] || 1.27;
                    return (nar * rate) / this.rates.USD;
                },
                maintFee() {
                    return this.formAmountTWD >= 300 ? 0 : (100 / this.rates.USD);
                },
                totalMonthlyFees() {
                    return this.adminFee + this.coiFee + this.maintFee;
                },
                netPayout() {
                    const gross = this.totalUnits * this.payoutPerUnit;
                    const net = gross - this.totalMonthlyFees;
                    return net > 0 ? net : 0;
                },
                netPayoutTWD() {
                    return this.netPayout * this.rates.USD;
                }
            },
            methods: {
                selectTarget(t) {
                    this.form.target = t;
                    if(t.hasBonus) this.simNAV = 10.00; else this.simNAV = 9.35;
                },
                formatNum(n, d = 0) {
                    return parseFloat(n).toLocaleString(undefined, { minimumFractionDigits: d, maximumFractionDigits: d });
                },
                async fetchRates() {
                    this.isSyncing = true;
                    try {
                        const res = await fetch(`https://corsproxy.io/?${encodeURIComponent('https://query1.finance.yahoo.com/v8/finance/chart/USDTWD=X?range=1d&interval=1d')}`);
                        const json = await res.json();
                        this.rates.USD = json.chart.result[0].meta.regularMarketPrice;
                    } catch (e) {}
                    this.isSyncing = false;
                }
            },
            mounted() {
                this.fetchRates();
            }
        }).mount('#app');
    </script>
</body>
</html>
