<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>元大證券 - 精確手續費試算</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --yuanta-dark: #0a0e14;
            --card-bg: #1c222d;
            --input-bg: #252d3a;
            --yuanta-blue: #0056b3;
        }
        body { background-color: var(--yuanta-dark); color: white; font-family: -apple-system, sans-serif; }
        .input-box { background: var(--input-bg); border: 1px solid #363c4e; border-radius: 8px; color: white; width: 100%; padding: 12px; text-align: right; font-size: 18px; font-family: monospace; }
        .result-row { display: flex; justify-between; margin-bottom: 8px; font-size: 14px; color: #848e9c; }
        .result-val { color: white; font-weight: bold; }
        .tab-btn { padding: 12px 0; width: 50%; text-align: center; border-bottom: 2px solid transparent; color: #848e9c; }
        .active-tab { border-bottom: 2px solid var(--yuanta-blue); color: white; font-weight: bold; }
    </style>
</head>
<body class="p-4 flex justify-center">

    <div class="w-full max-w-md bg-[#161b22] rounded-2xl shadow-xl overflow-hidden border border-gray-800">
        <!-- Header -->
        <div class="p-4 border-b border-gray-800 text-center font-bold text-lg">
            元大證券費率試算
        </div>

        <!-- Tabs -->
        <div class="flex">
            <button onclick="switchTab('tw')" id="btn-tw" class="tab-btn active-tab">台股 (TWD)</button>
            <button onclick="switchTab('us')" id="btn-us" class="tab-btn">美股 (USD)</button>
        </div>

        <div class="p-6 space-y-6">
            
            <!-- 台股部分 -->
            <div id="panel-tw" class="space-y-4">
                <div>
                    <label class="text-xs text-gray-500 block mb-1">成交價格 x 股數</label>
                    <div class="flex gap-2">
                        <input type="number" id="tw-price" class="input-box" placeholder="單價" oninput="calcTW()">
                        <input type="number" id="tw-qty" class="input-box" value="1000" oninput="calcTW()">
                    </div>
                </div>

                <div>
                    <label class="text-xs text-gray-500 block mb-1">手續費折讓 (請輸入折數，如 2.8 折填 2.8)</label>
                    <div class="relative">
                        <input type="number" id="tw-discount" class="input-box" value="6" oninput="calcTW()">
                        <span class="absolute left-3 top-3.5 text-blue-400 text-sm">折</span>
                    </div>
                </div>

                <div class="bg-[#1c222d] p-4 rounded-xl space-y-3">
                    <div class="result-row">
                        <span>成交金額</span>
                        <span id="tw-total" class="result-val">$0</span>
                    </div>
                    <div class="result-row">
                        <span>手續費 (1.425‰ x 折讓)</span>
                        <span id="tw-fee" class="result-val text-blue-400">$0</span>
                    </div>
                    <div class="result-row">
                        <span>證券交易稅 (3‰)</span>
                        <span id="tw-tax" class="result-val text-orange-400">$0</span>
                    </div>
                    <div class="border-t border-gray-700 pt-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm">買入總成本 (含手續費)</span>
                            <span id="tw-buy" class="text-xl text-red-500 font-bold">$0</span>
                        </div>
                        <div class="flex justify-between items-center mt-2">
                            <span class="text-sm">賣出實收 (扣除手續費+稅)</span>
                            <span id="tw-sell" class="text-xl text-green-500 font-bold">$0</span>
                        </div>
                    </div>
                </div>
                <p class="text-[10px] text-gray-500 text-center">※ 台股手續費基本低消為 20 元</p>
            </div>

            <!-- 美股部分 -->
            <div id="panel-us" class="hidden space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs text-gray-500 block mb-1">美股單價</label>
                        <input type="number" id="us-price" class="input-box" placeholder="0.00" oninput="calcUS()">
                    </div>
                    <div>
                        <label class="text-xs text-gray-500 block mb-1">股數</label>
                        <input type="number" id="us-qty" class="input-box" value="1" oninput="calcUS()">
                    </div>
                </div>

                <div class="bg-blue-900/10 border border-blue-500/20 p-4 rounded-xl text-sm">
                    元大美股複委託優惠費率：<span class="text-blue-400 font-bold">0.1%</span><br>
                    (目前設定：無最低手續費低消限制)
                </div>

                <div class="bg-[#1c222d] p-4 rounded-xl space-y-3">
                    <div class="result-row">
                        <span>成交總額</span>
                        <span id="us-total" class="result-val">$0.00</span>
                    </div>
                    <div class="result-row">
                        <span>手續費 (0.1%)</span>
                        <span id="us-fee" class="result-val text-blue-400">$0.00</span>
                    </div>
                    <div class="border-t border-gray-700 pt-3">
                        <div class="flex justify-between items-center">
                            <span>買入預計總支出</span>
                            <span id="us-net" class="text-xl text-red-500 font-bold">$0.00</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        function switchTab(type) {
            document.getElementById('panel-tw').classList.toggle('hidden', type === 'us');
            document.getElementById('panel-us').classList.toggle('hidden', type === 'tw');
            document.getElementById('btn-tw').classList.toggle('active-tab', type === 'tw');
            document.getElementById('btn-us').classList.toggle('active-tab', type === 'us');
        }

        function calcTW() {
            const p = parseFloat(document.getElementById('tw-price').value) || 0;
            const q = parseFloat(document.getElementById('tw-qty').value) || 0;
            const d = parseFloat(document.getElementById('tw-discount').value) || 10;
            
            const total = Math.round(p * q);
            
            // 1. 手續費計算：成交金額 * 0.001425 * 折數/10 (低消20元)
            let fee = Math.floor(total * 0.001425 * (d / 10));
            if (total > 0 && fee < 20) fee = 20;

            // 2. 證交稅計算：成交金額 * 0.003
            const tax = Math.floor(total * 0.003);

            document.getElementById('tw-total').innerText = '$' + total.toLocaleString();
            document.getElementById('tw-fee').innerText = '$' + fee.toLocaleString();
            document.getElementById('tw-tax').innerText = '$' + tax.toLocaleString();
            
            // 買入總成本 = 成交價 + 手續費
            document.getElementById('tw-buy').innerText = '$' + (total + fee).toLocaleString();
            // 賣出實收 = 成交價 - (手續費 + 證交稅)
            document.getElementById('tw-sell').innerText = '$' + (total - fee - tax).toLocaleString();
        }

        function calcUS() {
            const p = parseFloat(document.getElementById('us-price').value) || 0;
            const q = parseFloat(document.getElementById('us-qty').value) || 0;
            
            const total = p * q;
            // 元大美股 0.1% 成交金額
            const fee = total * 0.001;

            document.getElementById('us-total').innerText = '$' + total.toLocaleString(undefined, {minimumFractionDigits: 2});
            document.getElementById('us-fee').innerText = '$' + fee.toLocaleString(undefined, {minimumFractionDigits: 2});
            document.getElementById('us-net').innerText = '$' + (total + fee).toLocaleString(undefined, {minimumFractionDigits: 2});
        }
    </script>
</body>
</html>
