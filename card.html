<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 ä¿¡ç”¨å¡ç®¡å®¶ - è¨˜å¸³å®Œå…¨é«”</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8fafc; padding-bottom: 120px; }
        .mode-btn-active { border-color: #4f46e5 !important; background-color: #eef2ff !important; color: #4f46e5 !important; font-weight: bold; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .card-shadow { box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.04), 0 8px 10px -6px rgba(0, 0, 0, 0.04); }
        .tag-pill.active { background-color: #4f46e5; color: white; border-color: #4f46e5; }
        .summary-gradient { background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); }
    </style>
</head>
<body>

    <!-- Header & çµ±è¨ˆçœ‹æ¿ -->
    <header class="bg-slate-900 text-white sticky top-0 z-50 shadow-lg">
        <div class="max-w-md mx-auto p-5">
            <div class="flex justify-between items-center mb-4">
                <h1 class="text-xl font-black italic tracking-tighter">CARD NAVI <span class="text-indigo-400">2026</span></h1>
                <div class="flex gap-4">
                    <button onclick="toggleModal('historyModal')"><i class="fa-solid fa-clock-rotate-left text-lg"></i></button>
                    <button onclick="resetAllData()"><i class="fa-solid fa-trash-can text-lg text-rose-400"></i></button>
                </div>
            </div>
            
            <!-- æœ¬æœˆå›é¥‹çµ±è¨ˆçœ‹æ¿ -->
            <div class="summary-gradient rounded-3xl p-5 shadow-inner flex justify-between items-center">
                <div>
                    <p class="text-[10px] opacity-70 font-bold uppercase tracking-widest">æœ¬æœˆé è¨ˆç¸½å›é¥‹</p>
                    <p id="totalMonthlyReward" class="text-3xl font-black">$ 0</p>
                </div>
                <div class="text-right border-l border-white/20 pl-5">
                    <p class="text-[10px] opacity-70 font-bold uppercase tracking-widest">æœ¬æœˆç¸½æ¶ˆè²»</p>
                    <p id="totalMonthlySpent" class="text-xl font-bold text-indigo-200">$ 0</p>
                </div>
            </div>

            <!-- æ™ºæ…§æœå°‹ -->
            <div class="relative mt-4">
                <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-slate-500"></i>
                <input type="text" id="searchInput" oninput="renderCards()" placeholder="æœå°‹ï¼šæ·˜å¯¶ã€ä¸­æ²¹ã€æ—¥æœ¬..." 
                    class="w-full bg-slate-800 border-none rounded-2xl py-3 pl-11 pr-4 text-white placeholder-slate-500 focus:ring-2 focus:ring-indigo-500 outline-none transition-all text-sm">
            </div>
        </div>
    </header>

    <main class="max-w-md mx-auto p-4 space-y-4">
        
        <!-- åˆ†é¡æ¨™ç±¤ -->
        <div class="flex gap-2 overflow-x-auto no-scrollbar py-2">
            <button onclick="setFilter('all')" id="tag-all" class="tag-pill active border px-4 py-1.5 rounded-full text-xs whitespace-nowrap bg-white text-slate-600">å…¨éƒ¨</button>
            <button onclick="setFilter('æ”¯ä»˜')" id="tag-æ”¯ä»˜" class="tag-pill border px-4 py-1.5 rounded-full text-xs whitespace-nowrap bg-white text-slate-600">ğŸ“± æ”¯ä»˜</button>
            <button onclick="setFilter('ç¾é£Ÿ')" id="tag-ç¾é£Ÿ" class="tag-pill border px-4 py-1.5 rounded-full text-xs whitespace-nowrap bg-white text-slate-600">ğŸ›µ ç¾é£Ÿ</button>
            <button onclick="setFilter('ç¶²è³¼')" id="tag-ç¶²è³¼" class="tag-pill border px-4 py-1.5 rounded-full text-xs whitespace-nowrap bg-white text-slate-600">ğŸ›’ ç¶²è³¼</button>
            <button onclick="setFilter('æ—…éŠ')" id="tag-æ—…éŠ" class="tag-pill border px-4 py-1.5 rounded-full text-xs whitespace-nowrap bg-white text-slate-600">âœˆï¸ æ—…éŠ</button>
        </div>

        <!-- æ¨¡å¼åˆ‡æ›å™¨ -->
        <div class="bg-white rounded-[32px] shadow-sm border border-gray-100 p-5 card-shadow space-y-4">
            <div>
                <p class="text-[10px] font-black text-slate-400 uppercase mb-2">åœ‹æ³° CUBE æ¨¡å¼</p>
                <div class="flex gap-2 overflow-x-auto no-scrollbar" id="cubeModes">
                    <button onclick="setMode('cube', 'ç©æ•¸ä½')" id="btn-cube-ç©æ•¸ä½" class="cube-btn mode-btn-active border px-3 py-1 rounded-full text-[10px] whitespace-nowrap">ç©æ•¸ä½</button>
                    <button onclick="setMode('cube', 'æ¨‚é¥—è³¼')" id="btn-cube-æ¨‚é¥—è³¼" class="cube-btn border px-3 py-1 rounded-full text-[10px] whitespace-nowrap">æ¨‚é¥—è³¼</button>
                    <button onclick="setMode('cube', 'è¶£æ—…è¡Œ')" id="btn-cube-è¶£æ—…è¡Œ" class="cube-btn border px-3 py-1 rounded-full text-[10px] whitespace-nowrap">è¶£æ—…è¡Œ</button>
                    <button onclick="setMode('cube', 'é›†ç²¾é¸')" id="btn-cube-é›†ç²¾é¸" class="cube-btn border px-3 py-1 rounded-full text-[10px] whitespace-nowrap">é›†ç²¾é¸</button>
                </div>
            </div>
            <div>
                <p class="text-[10px] font-black text-slate-400 uppercase mb-2">ç‰å±± Unicard æ¨¡å¼</p>
                <div class="flex gap-2 overflow-x-auto no-scrollbar" id="uniModes">
                    <button onclick="setMode('unicard', 'ç°¡å–®é¸')" id="btn-unicard-ç°¡å–®é¸" class="uni-btn mode-btn-active border px-3 py-1 rounded-full text-[10px] whitespace-nowrap">ç°¡å–®é¸</button>
                    <button onclick="setMode('unicard', 'ä»»æ„é¸')" id="btn-unicard-ä»»æ„é¸" class="uni-btn border px-3 py-1 rounded-full text-[10px] whitespace-nowrap">ä»»æ„é¸</button>
                    <button onclick="setMode('unicard', 'è¨‚è£½é¸')" id="btn-unicard-è¨‚è£½é¸" class="uni-btn border px-3 py-1 rounded-full text-[10px] whitespace-nowrap">è¨‚è£½é¸</button>
                </div>
            </div>
        </div>

        <!-- å¡ç‰‡æ¸…å–® -->
        <div id="cardList" class="space-y-4"></div>
    </main>

    <!-- æ­·å²ç´€éŒ„ Modal -->
    <div id="historyModal" class="fixed inset-0 z-[60] hidden">
        <div class="fixed inset-0 bg-black/50 backdrop-blur-sm" onclick="toggleModal('historyModal')"></div>
        <div class="absolute bottom-0 w-full max-w-md left-1/2 -translate-x-1/2 bg-white rounded-t-[40px] p-8 shadow-2xl h-[70vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-black text-slate-800 tracking-tight italic">æ¶ˆè²»æ­·å²æ¸…å–®</h3>
                <button onclick="toggleModal('historyModal')" class="text-slate-300 text-2xl"><i class="fa-solid fa-circle-xmark"></i></button>
            </div>
            <div id="historyItems" class="space-y-3">
                <!-- æ­·å²é …ç›® -->
            </div>
        </div>
    </div>

    <!-- è©¦ç®— Modal -->
    <div id="expenseModal" class="fixed inset-0 z-[60] hidden">
        <div class="fixed inset-0 bg-black/40 backdrop-blur-sm" onclick="closeModal()"></div>
        <div class="absolute bottom-0 w-full max-w-md left-1/2 -translate-x-1/2 bg-white rounded-t-[40px] p-8 shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h3 id="modalCardName" class="text-xl font-black text-slate-800"></h3>
                <button onclick="closeModal()"><i class="fa-solid fa-circle-xmark text-slate-300 text-2xl"></i></button>
            </div>
            <div class="space-y-6">
                <input type="number" id="inputAmount" oninput="calculateReward()" placeholder="è¼¸å…¥é‡‘é¡" class="w-full bg-gray-50 border-none rounded-3xl py-6 px-6 text-4xl font-black outline-none focus:ring-4 focus:ring-indigo-100">
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-indigo-600 rounded-3xl p-5 text-white shadow-lg">
                        <p class="text-[10px] opacity-60 font-bold uppercase mb-1">é ä¼°æœ¬æ¬¡å›é¥‹</p>
                        <p id="calcResult" class="text-2xl font-black">$ 0</p>
                    </div>
                    <div class="bg-slate-900 rounded-3xl p-5 text-white shadow-lg">
                        <p class="text-[10px] opacity-60 font-bold uppercase mb-1">æœ¬æœˆå‰©é¤˜é¡åº¦</p>
                        <p id="modalRemaining" class="text-xl font-bold text-indigo-400">0</p>
                    </div>
                </div>
                <button onclick="saveExpense()" class="w-full bg-slate-800 text-white py-5 rounded-[24px] font-black text-lg active:scale-95 transition-all">ç¢ºèªè¨˜å¸³</button>
            </div>
        </div>
    </div>

    <script>
        let logs = JSON.parse(localStorage.getItem('my_card_logs_2026')) || [];
        let currentTargetCard = null;
        let recommendedMode = null;
        let activeFilter = 'all';

        const cardData = {
            legend: {
                name: "æ˜Ÿå±•å‚³èªªå°æ±ºå¡", bank: "æ˜Ÿå±•", color: "slate-700", cap: 11363, note: "LINE Pay/å¤–é€ 10% (åŠ ç¢¼ä¸Šé™1000)",
                activeMode: "ç²¾é¸åŠ ç¢¼",
                modes: { "ç²¾é¸åŠ ç¢¼": { rate: 10, cat: "æ”¯ä»˜,ç¾é£Ÿ", details: "LINE Payã€è¡—å£ã€UberEatsã€Foodpandaã€Netflixã€Disney+ã€éŠæˆ²å„²å€¼" } }
            },
            richart: {
                name: "å°æ–° Richart æ•´åˆå¡", bank: "å°æ–°", color: "rose-500", cap: 30303, note: "æ•¸ä½ 3.8% (GoGo) | æµ·å¤– 3% (FlyGo)",
                activeMode: "æ•¸ä½åŠ ç¢¼",
                modes: {
                    "æ•¸ä½åŠ ç¢¼": { rate: 3.8, cat: "æ”¯ä»˜,ç¶²è³¼", details: "LINE Payã€å…¨æ”¯ä»˜ã€å…¨å®¶(FamiPay)ã€è¦çš®ã€momoã€é…·æ¾ã€æ·˜å¯¶" },
                    "æµ·å¤–/äº¤é€š": { rate: 3, cat: "æ—…éŠ,ç”Ÿæ´»", details: "æµ·å¤–å¯¦é«”å•†åº—ã€èˆªç©ºå…¬å¸ã€æ©Ÿç¥¨ã€é«˜éµã€ä¸­æ²¹" }
                }
            },
            unicard: {
                name: "ç‰å±± Unicard", bank: "ç‰å±±", color: "emerald-600", cap: 28571, note: "åŸºæœ¬ 1% + åŠ ç¢¼ (ä¸Šé™ $1000)",
                activeMode: "ç°¡å–®é¸",
                modes: {
                    "ç°¡å–®é¸": { rate: 3, cat: "ç”Ÿæ´»", details: "å…¨å°ä¸€èˆ¬æ¶ˆè²» (+2%åŠ ç¢¼)" },
                    "ä»»æ„é¸": { rate: 3.5, cat: "ç”Ÿæ´»", details: "ç‰¹åº— 8 å®¶ (+2.5%åŠ ç¢¼)" },
                    "è¨‚è£½é¸": { rate: 4.5, cat: "æ”¯ä»˜,ç¶²è³¼", details: "LINE Payã€å…¨å®¶ã€momoã€é…·æ¾ (+3.5%åŠ ç¢¼)" }
                }
            },
            cube: {
                name: "åœ‹æ³° CUBE å¡", bank: "åœ‹æ³°", color: "orange-500", cap: Infinity, note: "3% ç„¡ä¸Šé™ï¼Œæ¯æ—¥éœ€æ‰‹å‹•åˆ‡æ›",
                activeMode: "ç©æ•¸ä½",
                modes: {
                    "ç©æ•¸ä½": { rate: 3, cat: "ç¶²è³¼", details: "è¦çš®ã€momoã€é…·æ¾ã€AppStoreã€GooglePlay" },
                    "æ¨‚é¥—è³¼": { rate: 3, cat: "ç¾é£Ÿ", details: "ç™¾è²¨ã€å…¨å°é¤å»³ã€æ–°å…‰ä¸‰è¶Šã€SOGOã€UberEats" },
                    "è¶£æ—…è¡Œ": { rate: 3, cat: "æ—…éŠ", details: "æµ·å¤–å¯¦é«”ã€å…¨çƒé£¯åº—ã€æ©Ÿç¥¨ã€Uberã€é«˜éµ" },
                    "é›†ç²¾é¸": { rate: 3, cat: "ç”Ÿæ´»", details: "7-11ã€å…¨è¯ã€ä¸­æ²¹ã€åœè»Šå¤§è²å…¬" }
                }
            },
            jcb: {
                name: "å¯Œé‚¦ JCB (Jå¡)", bank: "å¯Œé‚¦", color: "sky-500", cap: 20000, note: "æ—¥éŸ“å¯¦é«” 3% (åŠ ç¢¼éœ€ç™»éŒ„)",
                activeMode: "æ—¥éŸ“æ—…éŠ",
                modes: { "æ—¥éŸ“æ—…éŠ": { rate: 3, cat: "æ—…éŠ,æ”¯ä»˜", details: "æ—¥æœ¬/éŸ“åœ‹å¯¦é«”å•†åº—ã€LINE Pay æŒ‡å®šç‰¹åº—" } }
            },
            eco: {
                name: "æ˜Ÿå±•æ°¸çºŒå¡", bank: "æ˜Ÿå±•", color: "green-600", cap: Infinity, note: "1.5% ä¿åº•å›é¥‹",
                activeMode: "ä¸€èˆ¬",
                modes: { "ä¸€èˆ¬": { rate: 1.5, cat: "ç”Ÿæ´»", details: "åœ‹å…§å¤–ä¸€èˆ¬æ¶ˆè²»ã€ä¿éšªè²»" } }
            }
        };

        function setMode(cardKey, modeName) {
            cardData[cardKey].activeMode = modeName;
            const groupClass = cardKey === 'cube' ? 'cube-btn' : 'uni-btn';
            document.querySelectorAll('.' + groupClass).forEach(btn => btn.classList.remove('mode-btn-active'));
            document.getElementById(`btn-${cardKey}-${modeName}`).classList.add('mode-btn-active');
            
            if (cardKey === 'unicard') {
                const bonusRates = { "ç°¡å–®é¸": 0.02, "ä»»æ„é¸": 0.025, "è¨‚è£½é¸": 0.035 };
                cardData.unicard.cap = Math.floor(1000 / bonusRates[modeName]);
            }
            renderCards();
        }

        function setFilter(cat) {
            activeFilter = cat;
            document.querySelectorAll('.tag-pill').forEach(btn => btn.classList.remove('active'));
            document.getElementById('tag-' + cat).classList.add('active');
            renderCards();
        }

        function renderCards() {
            const list = document.getElementById('cardList');
            const searchTxt = document.getElementById('searchInput').value.toLowerCase();
            list.innerHTML = '';

            let sortedKeys = Object.keys(cardData).sort((a,b) => getBestRate(b, searchTxt, activeFilter) - getBestRate(a, searchTxt, activeFilter));

            sortedKeys.forEach((key, index) => {
                const card = cardData[key];
                let bestMode = findBestMode(key, searchTxt, activeFilter);
                if (!bestMode) return;

                const activeData = card.modes[bestMode];
                const used = getMonthlyUsed(key);
                const remaining = card.cap === Infinity ? 'ç„¡ä¸Šé™' : Math.max(0, card.cap - used);

                const cardDiv = document.createElement('div');
                cardDiv.className = `bg-white rounded-[32px] p-6 relative transition-all card-shadow border border-gray-50 ${index === 0 && (searchTxt || activeFilter !== 'all') ? 'ring-4 ring-indigo-500/10 scale-[1.02]' : ''}`;
                cardDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h2 class="text-lg font-black text-slate-800">${card.name}</h2>
                            <p class="text-[9px] text-slate-400 font-bold uppercase tracking-widest">${card.bank}</p>
                        </div>
                        <div class="text-right">
                            <span class="text-3xl font-black text-${card.color}">${activeData.rate}%</span>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-2xl p-4 border border-gray-100/50">
                        <p class="text-[11px] text-slate-600 font-bold leading-relaxed italic"><i class="fa-solid fa-location-crosshairs text-indigo-500 mr-2"></i>${activeData.details}</p>
                    </div>
                    <div class="flex justify-between items-center mt-4">
                        <span class="text-[10px] text-slate-400 font-bold">REMAIN: <span class="text-slate-800 font-black">$ ${remaining.toLocaleString()}</span></span>
                        <button onclick="openModal('${key}', '${bestMode}')" class="bg-slate-900 text-white px-5 py-2 rounded-xl font-bold text-xs">è¨˜å¸³è©¦ç®—</button>
                    </div>
                `;
                list.appendChild(cardDiv);
            });
            updateSummaryçœ‹æ¿();
        }

        function getMonthlyUsed(key) {
            const now = new Date();
            return logs.filter(l => l.cardKey === key && new Date(l.date).getMonth() === now.getMonth() && new Date(l.date).getFullYear() === now.getFullYear())
                       .reduce((s, l) => s + parseFloat(l.amount), 0);
        }

        function updateSummaryçœ‹æ¿() {
            const now = new Date();
            const monthlyLogs = logs.filter(l => new Date(l.date).getMonth() === now.getMonth() && new Date(l.date).getFullYear() === now.getFullYear());
            const totalSpent = monthlyLogs.reduce((s, l) => s + parseFloat(l.amount), 0);
            const totalReward = monthlyLogs.reduce((s, l) => s + parseFloat(l.reward), 0);
            document.getElementById('totalMonthlyReward').innerText = '$ ' + totalReward.toLocaleString();
            document.getElementById('totalMonthlySpent').innerText = '$ ' + totalSpent.toLocaleString();
        }

        function findBestMode(key, txt, filter) {
            const card = cardData[key];
            let best = card.activeMode;
            let max = -1;
            for (let m in card.modes) {
                const mode = card.modes[m];
                const matchTxt = !txt || mode.details.toLowerCase().includes(txt);
                const matchFilter = filter === 'all' || mode.cat.includes(filter);
                if (matchTxt && matchFilter) {
                    if (mode.rate > max) { max = mode.rate; best = m; }
                }
            }
            return max === -1 && filter !== 'all' ? null : best;
        }

        function getBestRate(key, txt, filter) {
            const modeName = findBestMode(key, txt, filter);
            return modeName ? cardData[key].modes[modeName].rate : -1;
        }

        function openModal(key, mode) {
            currentTargetCard = key; recommendedMode = mode;
            document.getElementById('modalCardName').innerText = cardData[key].name;
            document.getElementById('inputAmount').value = '';
            document.getElementById('calcResult').innerText = '$ 0';
            const used = getMonthlyUsed(key);
            document.getElementById('modalRemaining').innerText = cardData[key].cap === Infinity ? 'ç„¡ä¸Šé™' : '$ ' + (cardData[key].cap - used).toLocaleString();
            document.getElementById('expenseModal').classList.remove('hidden');
        }

        function calculateReward() {
            const amt = document.getElementById('inputAmount').value || 0;
            const rate = cardData[currentTargetCard].modes[recommendedMode].rate;
            document.getElementById('calcResult').innerText = '$ ' + Math.floor(amt * rate / 100).toLocaleString();
        }

        function saveExpense() {
            const amt = document.getElementById('inputAmount').value;
            if(!amt || amt <= 0) return;
            const rate = cardData[currentTargetCard].modes[recommendedMode].rate;
            const reward = Math.floor(amt * rate / 100);
            
            logs.unshift({
                id: Date.now(),
                cardKey: currentTargetCard,
                cardName: cardData[currentTargetCard].name,
                amount: amt,
                reward: reward,
                date: new Date().toISOString()
            });
            localStorage.setItem('my_card_logs_2026', JSON.stringify(logs));
            closeModal(); renderCards();
        }

        function toggleModal(id) {
            const modal = document.getElementById(id);
            modal.classList.toggle('hidden');
            if (id === 'historyModal') renderHistory();
        }

        function renderHistory() {
            const container = document.getElementById('historyItems');
            container.innerHTML = '';
            if (logs.length === 0) container.innerHTML = '<p class="text-center text-slate-400 py-10">å°šç„¡è¨˜å¸³ç´€éŒ„</p>';
            
            logs.forEach(log => {
                const item = document.createElement('div');
                item.className = "flex justify-between items-center bg-slate-50 p-4 rounded-2xl border border-gray-100";
                item.innerHTML = `
                    <div>
                        <p class="font-black text-slate-800 text-sm">${log.cardName}</p>
                        <p class="text-[10px] text-slate-400">${new Date(log.date).toLocaleString()} | $${log.amount}</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="text-indigo-600 font-black">+$${log.reward}</span>
                        <button onclick="deleteLog(${log.id})" class="text-rose-400 p-2"><i class="fa-solid fa-trash-can"></i></button>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function deleteLog(id) {
            logs = logs.filter(l => l.id !== id);
            localStorage.setItem('my_card_logs_2026', JSON.stringify(logs));
            renderHistory();
            renderCards();
        }

        function resetAllData() {
            if(confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è¨˜å¸³ç´€éŒ„å—ï¼Ÿæ­¤å‹•ä½œç„¡æ³•å¾©åŸã€‚')) {
                logs = [];
                localStorage.removeItem('my_card_logs_2026');
                renderCards();
                alert('å·²æˆåŠŸé‡ç½®');
            }
        }

        function closeModal() { document.getElementById('expenseModal').classList.add('hidden'); }
        window.onload = renderCards;
    </script>
</body>
</html>