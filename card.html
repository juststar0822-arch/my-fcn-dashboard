<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„ç²¾æº–ä¿¡ç”¨å¡æŒ‡å— - ä¸Šé™ä¿®æ­£ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f1f5f9; }
        .mode-btn-active { border-color: #4f46e5; background-color: #eef2ff; color: #4f46e5; font-weight: bold; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .modal-overlay { background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(4px); }
    </style>
</head>
<body class="pb-20">

    <header class="bg-white border-b sticky top-0 z-50 p-4 shadow-sm">
        <div class="max-w-md mx-auto">
            <h1 class="text-xl font-black text-gray-800 tracking-tighter italic">CREDIT MASTER</h1>
            <p class="text-[10px] text-gray-400 font-bold uppercase">å€‹äººåŒ–å›é¥‹ä¸Šé™è¿½è¹¤</p>
        </div>
    </header>

    <main class="max-w-md mx-auto p-4 space-y-6">
        
        <!-- æ¨¡å¼åˆ‡æ›å€ -->
        <div class="bg-white rounded-2xl shadow-sm border p-4 space-y-4">
            <div>
                <p class="text-xs font-bold text-gray-400 mb-2 underline decoration-indigo-300">åœ‹æ³° CUBE æ¨¡å¼</p>
                <div class="flex gap-2 overflow-x-auto no-scrollbar pb-1">
                    <button onclick="setMode('cube', 'ç©æ•¸ä½')" id="btn-cube-ç©æ•¸ä½" class="cube-btn mode-btn-active border px-3 py-1 rounded-lg text-xs whitespace-nowrap">ç©æ•¸ä½</button>
                    <button onclick="setMode('cube', 'æ¨‚é¥—è³¼')" id="btn-cube-æ¨‚é¥—è³¼" class="cube-btn border px-3 py-1 rounded-lg text-xs whitespace-nowrap">æ¨‚é¥—è³¼</button>
                    <button onclick="setMode('cube', 'è¶£æ—…è¡Œ')" id="btn-cube-è¶£æ—…è¡Œ" class="cube-btn border px-3 py-1 rounded-lg text-xs whitespace-nowrap">è¶£æ—…è¡Œ</button>
                    <button onclick="setMode('cube', 'é›†ç²¾é¸')" id="btn-cube-é›†ç²¾é¸" class="cube-btn border px-3 py-1 rounded-lg text-xs whitespace-nowrap">é›†ç²¾é¸</button>
                </div>
            </div>
            <div>
                <p class="text-xs font-bold text-gray-400 mb-2 underline decoration-emerald-300">ç‰å±± Unicard æ¨¡å¼</p>
                <div class="flex gap-2">
                    <button onclick="setMode('unicard', 'ç°¡å–®é¸')" id="btn-unicard-ç°¡å–®é¸" class="uni-btn mode-btn-active border px-3 py-1 rounded-lg text-xs">ç°¡å–®é¸</button>
                    <button onclick="setMode('unicard', 'ä»»æ„é¸')" id="btn-unicard-ä»»æ„é¸" class="uni-btn border px-3 py-1 rounded-lg text-xs">ä»»æ„é¸</button>
                    <button onclick="setMode('unicard', 'è¨‚è£½é¸')" id="btn-unicard-è¨‚è£½é¸" class="uni-btn border px-3 py-1 rounded-lg text-xs">è¨‚è£½é¸(5%)</button>
                </div>
            </div>
        </div>

        <div id="cardList" class="space-y-4"></div>
    </main>

    <!-- è¨˜å¸³èˆ‡è©¦ç®— Modal -->
    <div id="expenseModal" class="fixed inset-0 z-[60] hidden">
        <div class="modal-overlay absolute inset-0" onclick="closeModal()"></div>
        <div class="absolute bottom-0 w-full max-w-md left-1/2 -translate-x-1/2 bg-white rounded-t-3xl p-6 shadow-2xl">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalCardName" class="text-xl font-black text-gray-800"></h3>
                <button onclick="closeModal()" class="text-gray-400 text-xl"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="space-y-4">
                <div class="flex justify-between items-center bg-gray-50 p-3 rounded-xl border">
                    <span id="modalModeName" class="text-xs font-bold text-gray-500">ç•¶å‰åˆ©ç‡</span>
                    <span id="modalRate" class="text-lg font-black text-red-500">0%</span>
                </div>
                <div class="relative">
                    <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 text-xl font-bold">$</span>
                    <input type="number" id="inputAmount" oninput="calculateReward()" placeholder="è¼¸å…¥æ¶ˆè²»é‡‘é¡" 
                        class="w-full bg-gray-100 border-none rounded-2xl py-4 pl-10 pr-4 text-3xl font-black focus:ring-2 focus:ring-indigo-500 outline-none">
                </div>
                <div class="bg-indigo-600 rounded-2xl p-5 text-white flex justify-between items-center shadow-lg">
                    <div>
                        <p class="text-[10px] opacity-70 font-bold uppercase">é ä¼°å›é¥‹</p>
                        <p id="calcResult" class="text-3xl font-black">$ 0</p>
                    </div>
                    <div class="text-right">
                        <p class="text-[10px] opacity-70 font-bold uppercase">æœ¬æœˆå‰©é¤˜é¡åº¦</p>
                        <p id="modalRemaining" class="text-sm font-black">$ 0</p>
                    </div>
                </div>
                <button onclick="saveExpense()" class="w-full bg-slate-800 text-white py-4 rounded-2xl font-black text-lg active:scale-95 transition-transform">
                    ç¢ºèªè¨˜éŒ„
                </button>
            </div>
        </div>
    </div>

    <script>
        let logs = JSON.parse(localStorage.getItem('my_card_logs')) || [];
        let currentTargetCard = null;

        // ã€è³‡æ–™åº«æ ¸å¿ƒï¼šä½ å¯ä»¥åœ¨é€™è£¡éš¨æ™‚èª¿æ•´ä¸Šé™ã€‘
        const cardData = {
            legend: {
                name: "æ˜Ÿå±•å‚³èªªå°æ±ºå¡",
                bank: "æ˜Ÿå±•éŠ€è¡Œ",
                activeMode: "ç²¾é¸åŠ ç¢¼",
                note: "LINE Pay å›é¥‹ 10%ï¼(éœ€ç¶å®šè‡ªæ‰£)",
                cap: 11363, // å¦‚æœä¸Šé™æ˜¯ 1000 é»å›é¥‹ï¼Œä»¥ 8.8% åŠ ç¢¼è¨ˆç®—ï¼Œé¡åº¦ç´„ $11,363
                modes: { "ç²¾é¸åŠ ç¢¼": { rate: 10, details: "LINE Payã€è¦çš®ã€å¤–é€ã€å½±éŸ³ã€éŠæˆ²å„²å€¼" } }
            },
            gogo: {
                name: "å°æ–° Richart GoGo",
                bank: "å°æ–°éŠ€è¡Œ",
                activeMode: "ç²¾é¸",
                note: "åŠ ç¢¼ 3.3% æ¯æœˆä¸Šé™ 1000 å…ƒ",
                cap: 30303, // åŠ ç¢¼ä¸Šé™ 1000 å…ƒï¼Œé¡åº¦ç´„ $30,303
                modes: { "ç²¾é¸": { rate: 3.8, details: "LINE Payã€å…¨æ”¯ä»˜ã€è¦çš®ã€momo" } }
            },
            cube: {
                name: "åœ‹æ³° CUBE å¡",
                bank: "åœ‹æ³°ä¸–è¯",
                activeMode: "ç©æ•¸ä½",
                note: "åˆ‡æ›å¾Œ 3% å›é¥‹ç„¡ä¸Šé™",
                cap: Infinity,
                modes: {
                    "ç©æ•¸ä½": { rate: 3, details: "è¦çš®ã€momoã€é…·æ¾ã€App Store" },
                    "æ¨‚é¥—è³¼": { rate: 3, details: "ç™¾è²¨ã€é¤é£²ã€UberEats" },
                    "è¶£æ—…è¡Œ": { rate: 3, details: "æµ·å¤–ã€æ©Ÿç¥¨ã€é£¯åº—ã€Uber" },
                    "é›†ç²¾é¸": { rate: 3, details: "å…¨å®¶ã€å…¨è¯ã€ä¸­æ²¹ã€UberEats" }
                }
            },
            unicard: {
                name: "ç‰å±± Unicard",
                bank: "ç‰å±±éŠ€è¡Œ",
                activeMode: "ç°¡å–®é¸",
                note: "å›é¥‹ç‰å±± e point",
                cap: 20000, 
                modes: {
                    "ç°¡å–®é¸": { rate: 1, details: "å…¨å°ä¸€èˆ¬æ¶ˆè²»" },
                    "ä»»æ„é¸": { rate: 3.5, details: "ç‰¹åº—é¸ 8 å®¶ï¼šä¸­æ²¹ã€momo" },
                    "è¨‚è£½é¸": { rate: 5, details: "LINE Payã€å…¨å®¶ã€momoã€é…·æ¾" }
                }
            },
            eco: {
                name: "æ˜Ÿå±•æ°¸çºŒå¡",
                bank: "æ˜Ÿå±•éŠ€è¡Œ",
                activeMode: "ä¸€èˆ¬",
                note: "1.5% ä¿åº•ç„¡ä¸Šé™",
                cap: Infinity,
                modes: { "ä¸€èˆ¬": { rate: 1.5, details: "ä¸€èˆ¬æ¶ˆè²»ã€ä¿éšªè²»" } }
            },
            jcb: {
                name: "å¯Œé‚¦ JCB (Jå¡)",
                bank: "å¯Œé‚¦éŠ€è¡Œ",
                activeMode: "ä¸€èˆ¬/æ—¥éŸ“",
                note: "æ—¥éŸ“åŠ ç¢¼ 2% éœ€ç™»éŒ„ï¼Œä¸Šé™ 600~1000 é»",
                cap: 20000, 
                modes: { "ä¸€èˆ¬/æ—¥éŸ“": { rate: 3, details: "æ—¥éŸ“å¯¦é«”ã€LINE Pay ç‰¹åº—" } }
            }
        };

        function setMode(cardKey, modeName) {
            cardData[cardKey].activeMode = modeName;
            const groupClass = cardKey === 'cube' ? 'cube-btn' : 'uni-btn';
            document.querySelectorAll('.' + groupClass).forEach(btn => btn.classList.remove('mode-btn-active'));
            document.getElementById(`btn-${cardKey}-${modeName}`).classList.add('mode-btn-active');
            renderCards();
        }

        function getUsedAmount(cardKey) {
            const currentMonth = new Date().getMonth();
            return logs
                .filter(log => log.cardKey === cardKey && new Date(log.date).getMonth() === currentMonth)
                .reduce((sum, log) => sum + parseFloat(log.amount), 0);
        }

        function renderCards() {
            const list = document.getElementById('cardList');
            list.innerHTML = '';
            const sortedKeys = Object.keys(cardData).sort((a,b) => cardData[b].modes[cardData[b].activeMode].rate - cardData[a].modes[cardData[a].activeMode].rate);
            
            sortedKeys.forEach(key => {
                const card = cardData[key];
                const activeData = card.modes[card.activeMode];
                const used = getUsedAmount(key);
                const remaining = card.cap === Infinity ? 'ç„¡ä¸Šé™' : Math.max(0, card.cap - used);

                const cardDiv = document.createElement('div');
                cardDiv.className = "bg-white rounded-2xl shadow-sm border p-5 space-y-3";
                cardDiv.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <h2 class="text-lg font-black text-gray-800">${card.name}</h2>
                            <p class="text-[10px] text-gray-400 font-bold uppercase tracking-widest">${card.bank}</p>
                        </div>
                        <div class="text-right">
                            <span class="text-3xl font-black text-red-500">${activeData.rate}%</span>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-xl p-3">
                        <p class="text-[11px] text-gray-600 font-medium leading-relaxed">${activeData.details}</p>
                    </div>
                    <div class="flex justify-between items-center pt-2">
                        <div class="text-[10px] text-gray-400 font-bold">
                            æœ¬æœˆå‰©é¤˜é¡åº¦: <span class="${remaining < 1000 ? 'text-red-500' : 'text-indigo-600'} font-black">$ ${remaining === 'ç„¡ä¸Šé™' ? remaining : remaining.toLocaleString()}</span>
                        </div>
                        <button onclick="openModal('${key}')" class="bg-slate-800 text-white px-5 py-2 rounded-xl font-bold text-xs">è¨˜å¸³è©¦ç®—</button>
                    </div>
                    <p class="text-[10px] text-gray-400 border-t pt-2 mt-2 leading-tight italic">ğŸ’¡ ${card.note}</p>
                `;
                list.appendChild(cardDiv);
            });
        }

        function openModal(cardKey) {
            currentTargetCard = cardKey;
            const card = cardData[cardKey];
            const activeData = card.modes[card.activeMode];
            const used = getUsedAmount(cardKey);
            
            document.getElementById('modalCardName').innerText = card.name;
            document.getElementById('modalRate').innerText = activeData.rate + '%';
            document.getElementById('modalRemaining').innerText = card.cap === Infinity ? 'ç„¡ä¸Šé™' : '$ ' + (card.cap - used).toLocaleString();
            document.getElementById('inputAmount').value = '';
            document.getElementById('calcResult').innerText = '$ 0';
            document.getElementById('expenseModal').classList.remove('hidden');
        }

        function calculateReward() {
            const amount = document.getElementById('inputAmount').value || 0;
            const rate = cardData[currentTargetCard].modes[cardData[currentTargetCard].activeMode].rate;
            const reward = Math.floor(amount * (rate / 100));
            document.getElementById('calcResult').innerText = '$ ' + reward.toLocaleString();
        }

        function saveExpense() {
            const amount = document.getElementById('inputAmount').value;
            if (!amount || amount <= 0) return alert('è«‹è¼¸å…¥é‡‘é¡');
            logs.push({ cardKey: currentTargetCard, amount: amount, date: new Date().toISOString() });
            localStorage.setItem('my_card_logs', JSON.stringify(logs));
            closeModal();
            renderCards();
        }

        function closeModal() { document.getElementById('expenseModal').classList.add('hidden'); }

        window.onload = renderCards;
    </script>
</body>
</html>