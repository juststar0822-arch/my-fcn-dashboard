<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>台股模擬交易系統 - 元大風格條件單</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #121212; color: #e0e0e0; font-family: "Microsoft JhengHei", sans-serif; }
        .yuanta-blue { background-color: #005599; }
        .card { background-color: #1e1e1e; border-radius: 12px; }
        .input-dark { background-color: #2c2c2c; border: 1px solid #444; color: white; padding: 8px; border-radius: 6px; }
        .btn-buy { background-color: #eb4d4b; }
        .btn-sell { background-color: #2ecc71; }
        .tab-active { border-bottom: 2px solid #005599; color: #005599; }
    </style>
</head>
<body class="p-4">

    <!-- 頂部帳戶資訊 -->
    <div class="card p-4 mb-4 flex justify-between items-center shadow-lg">
        <div>
            <h1 class="text-gray-400 text-sm">虛擬購買力 (TWD)</h1>
            <p id="balance" class="text-2xl font-bold text-yellow-500">100,000</p>
        </div>
        <div class="text-right">
            <span class="text-xs bg-gray-700 px-2 py-1 rounded">模擬環境</span>
        </div>
    </div>

    <!-- 模擬行情 (隨機跳動) -->
    <div class="card p-4 mb-4 border-l-4 border-red-500">
        <div class="flex justify-between">
            <span class="text-lg font-bold">2330 台積電</span>
            <span id="current-price" class="text-xl font-mono text-red-500 font-bold">---</span>
        </div>
        <p class="text-xs text-gray-500">即時行情模擬中...</p>
    </div>

    <!-- 條件單設定區 -->
    <div class="card p-4 mb-4">
        <div class="flex space-x-4 mb-4 border-b border-gray-700 pb-2">
            <button onclick="switchTab('trigger')" id="tab-trigger" class="tab-active pb-1">觸價單</button>
            <button onclick="switchTab('oco')" id="tab-oco" class="pb-1">二擇一 (OCO)</button>
            <button onclick="switchTab('trailing')" id="tab-trailing" class="pb-1">移動鎖利</button>
        </div>

        <!-- 觸價單內容 -->
        <div id="panel-trigger" class="space-y-3">
            <div class="flex flex-col">
                <label class="text-xs text-gray-400 mb-1">觸發價格</label>
                <input type="number" id="trigger-price" class="input-dark w-full" placeholder="例如: 1050">
            </div>
        </div>

        <!-- OCO 內容 (隱藏) -->
        <div id="panel-oco" class="space-y-3 hidden">
            <div class="grid grid-cols-2 gap-2">
                <div>
                    <label class="text-xs text-gray-400 mb-1">停利觸發</label>
                    <input type="number" id="oco-profit" class="input-dark w-full" placeholder="高價">
                </div>
                <div>
                    <label class="text-xs text-gray-400 mb-1">停損觸發</label>
                    <input type="number" id="oco-loss" class="input-dark w-full" placeholder="低價">
                </div>
            </div>
        </div>

        <!-- 移動鎖利 內容 (隱藏) -->
        <div id="panel-trailing" class="space-y-3 hidden">
            <div class="flex flex-col">
                <label class="text-xs text-gray-400 mb-1">回檔價差 (元)</label>
                <input type="number" id="trailing-drop" class="input-dark w-full" placeholder="例如: 10">
            </div>
        </div>

        <button onclick="addOrder()" class="yuanta-blue w-full mt-6 py-3 rounded-lg font-bold text-white shadow-md">送出條件單設定</button>
    </div>

    <!-- 監控中列表 -->
    <h2 class="text-sm font-bold mb-2 text-gray-400">正在監控中的條件單</h2>
    <div id="order-list" class="space-y-2 text-sm">
        <!-- 訂單會顯示在這裡 -->
    </div>

    <script>
        let balance = 100000;
        let currentPrice = 1000;
        let orders = [];
        let activeTab = 'trigger';

        // 1. 模擬即時股價跳動
        setInterval(() => {
            const change = (Math.random() - 0.5) * 4; // 隨機跳動 -2 ~ +2
            currentPrice = parseFloat((currentPrice + change).toFixed(1));
            document.getElementById('current-price').innerText = currentPrice.toLocaleString();
            checkOrders();
        }, 2000);

        // 2. 切換頁籤
        function switchTab(type) {
            activeTab = type;
            document.getElementById('panel-trigger').classList.add('hidden');
            document.getElementById('panel-oco').classList.add('hidden');
            document.getElementById('panel-trailing').classList.add('hidden');
            document.getElementById(`panel-${type}`).classList.remove('hidden');
            
            document.getElementById('tab-trigger').className = 'pb-1';
            document.getElementById('tab-oco').className = 'pb-1';
            document.getElementById('tab-trailing').className = 'pb-1';
            document.getElementById(`tab-${type}`).className = 'tab-active pb-1';
        }

        // 3. 新增條件單
        function addOrder() {
            let newOrder = {
                id: Date.now(),
                type: activeTab,
                status: '監控中',
                timestamp: new Date().toLocaleTimeString()
            };

            if (activeTab === 'trigger') {
                newOrder.triggerPrice = parseFloat(document.getElementById('trigger-price').value);
                newOrder.desc = `觸價買入: ${newOrder.triggerPrice}`;
            } else if (activeTab === 'oco') {
                newOrder.profit = parseFloat(document.getElementById('oco-profit').value);
                newOrder.loss = parseFloat(document.getElementById('oco-loss').value);
                newOrder.desc = `OCO: 停利${newOrder.profit} / 停損${newOrder.loss}`;
            } else if (activeTab === 'trailing') {
                newOrder.drop = parseFloat(document.getElementById('trailing-drop').value);
                newOrder.highPrice = currentPrice;
                newOrder.desc = `移動鎖利: 最高點回落 ${newOrder.drop}元`;
            }

            orders.push(newOrder);
            renderOrders();
        }

        // 4. 監控邏輯 (核心模擬)
        function checkOrders() {
            orders.forEach((order, index) => {
                if (order.status !== '監控中') return;

                let triggered = false;
                let reason = '';

                if (order.type === 'trigger') {
                    if (currentPrice >= order.triggerPrice) { triggered = true; reason = '觸價成交'; }
                } else if (order.type === 'oco') {
                    if (currentPrice >= order.profit) { triggered = true; reason = '停利成交'; }
                    else if (currentPrice <= order.loss) { triggered = true; reason = '停損成交'; }
                } else if (order.type === 'trailing') {
                    if (currentPrice > order.highPrice) { order.highPrice = currentPrice; } // 更新最高點
                    if (currentPrice <= (order.highPrice - order.drop)) { triggered = true; reason = '回檔觸發賣出'; }
                }

                if (triggered) {
                    order.status = reason;
                    balance -= 1000; // 模擬隨便扣個款
                    updateBalance();
                    renderOrders();
                }
            });
        }

        function updateBalance() {
            document.getElementById('balance').innerText = balance.toLocaleString();
        }

        function renderOrders() {
            const list = document.getElementById('order-list');
            list.innerHTML = '';
            orders.slice().reverse().forEach(order => {
                const statusColor = order.status === '監控中' ? 'text-blue-400' : 'text-yellow-500';
                list.innerHTML += `
                    <div class="card p-3 border border-gray-800">
                        <div class="flex justify-between">
                            <span class="text-white">${order.desc}</span>
                            <span class="${statusColor}">${order.status}</span>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">${order.timestamp}</div>
                    </div>
                `;
            });
        }

        updateBalance();
    </script>
</body>
</html>
