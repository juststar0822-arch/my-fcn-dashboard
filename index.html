<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FCN 專業資產管理系統 - 內部分析版</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-[#f4f7f9] text-slate-900 font-sans">
    <div id="app" class="min-h-screen flex flex-col md:flex-row">
        
        <!-- 左側導航欄 -->
        <div class="w-full md:w-80 bg-[#1a222d] text-white shadow-xl flex flex-col">
            <div class="p-8 border-b border-slate-700">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center shadow-lg shadow-blue-500/20">
                        <i class="fa-solid fa-chart-line text-xl"></i>
                    </div>
                    <h1 class="text-xl font-black tracking-tight">FCN 庫存管理</h1>
                </div>
                <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700">
                    <p class="text-slate-400 text-[10px] uppercase font-bold tracking-widest mb-1">當前選取客戶</p>
                    <select v-model="selectedClient" class="bg-transparent w-full font-bold text-lg focus:outline-none">
                        <option v-for="c in clients" :value="c" class="bg-slate-800 text-white">{{ c }}</option>
                    </select>
                </div>
            </div>
            
            <nav class="p-4 space-y-2 flex-1">
                <div @click="currentView = 'all'" :class="navClass(currentView === 'all')">
                    <i class="fa-solid fa-briefcase w-6"></i> 所有持倉明細
                </div>
                <div @click="currentView = 'ko'" :class="navClass(currentView === 'ko', 'text-emerald-400')">
                    <i class="fa-solid fa-bolt w-6"></i> 即將 KO 贖回 ({{ koCount }})
                </div>
                <div @click="currentView = 'ki'" :class="navClass(currentView === 'ki', 'text-rose-400')">
                    <i class="fa-solid fa-shield-virus w-6"></i> KI 風險監控 ({{ kiCount }})
                </div>
            </nav>
            <div class="p-6 text-[10px] text-slate-500 border-t border-slate-800">
                <p>最後更新：{{ lastUpdateTime }}</p>
                <p>數據源：Excel 匯入資料</p>
            </div>
        </div>

        <!-- 右側主區域 -->
        <div class="flex-1 p-4 md:p-8 overflow-y-auto">
            <!-- 數據總覽卡片 -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 border-b-4 border-b-blue-500">
                    <p class="text-slate-400 text-[10px] font-bold uppercase">持有總額 (JPY)</p>
                    <h3 class="text-2xl font-black italic">{{ formatNum(totalAmount) }} 萬</h3>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 border-b-4 border-b-emerald-500">
                    <p class="text-slate-400 text-[10px] font-bold uppercase">預估票息年率</p>
                    <h3 class="text-2xl font-black text-emerald-600">{{ avgCoupon }}%</h3>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 border-b-4 border-b-amber-500">
                    <p class="text-slate-400 text-[10px] font-bold uppercase">距離觀察日</p>
                    <h3 class="text-2xl font-black">38 天</h3>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 border-b-4 border-b-slate-800">
                    <p class="text-slate-400 text-[10px] font-bold uppercase">到期日</p>
                    <h3 class="text-xl font-black">2026/07/17</h3>
                </div>
            </div>

            <h2 class="text-2xl font-black mb-6 text-slate-800 flex items-center gap-2">
                <span class="w-1.5 h-6 bg-blue-500 rounded-full"></span>
                {{ selectedClient }} 的庫存資產
            </h2>

            <!-- FCN 卡片列表 -->
            <div v-for="item in filteredList" :key="item.sn" class="bg-white rounded-[2rem] shadow-sm border border-slate-100 p-6 md:p-8 mb-6 hover:shadow-xl transition-all duration-500">
                <div class="flex flex-col lg:flex-row justify-between gap-8">
                    <!-- 商品基本資訊 -->
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="bg-blue-600 text-white text-[10px] font-bold px-3 py-1 rounded-full uppercase tracking-tighter">{{ item.sn }}</span>
                            <span class="text-slate-400 text-xs font-bold">下單日: {{ item.orderDate }}</span>
                        </div>
                        <h3 class="text-2xl font-black text-slate-800 mb-6 italic">Worst-of Fixed Coupon Note</h3>
                        
                        <!-- 三檔標的橫向顯示 -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div v-for="stock in item.stocks" :key="stock.code" 
                                class="p-4 rounded-2xl border transition-all duration-500"
                                :class="getStockClass(stock)">
                                <div class="flex justify-between items-start mb-2">
                                    <p class="font-black text-lg">{{ stock.code }}</p>
                                    <span class="text-[10px] font-bold px-2 py-0.5 rounded" :class="stock.status === 'OK' ? 'bg-emerald-100 text-emerald-700' : 'bg-rose-100 text-rose-700'">
                                        {{ getPerf(stock) }}%
                                    </span>
                                </div>
                                <div class="space-y-1">
                                    <div class="flex justify-between text-[10px] font-bold uppercase text-slate-400">
                                        <span>現價參考</span>
                                        <span>KO 價</span>
                                    </div>
                                    <div class="flex justify-between font-mono font-bold">
                                        <span class="text-xl" :class="stock.priceColor">${{ formatNum(stock.current) }}</span>
                                        <span class="text-slate-400">${{ formatNum(stock.ko) }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 右側數據摘要 -->
                    <div class="lg:w-72 bg-slate-50 rounded-3xl p-6 flex flex-col justify-between border border-slate-100">
                        <div class="space-y-4">
                            <div>
                                <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">配息年率</p>
                                <p class="text-3xl font-black text-blue-600">{{ item.coupon }}%</p>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <p class="text-[10px] text-slate-400 font-bold uppercase">履約價</p>
                                    <p class="font-black">{{ item.strikeP }}%</p>
                                </div>
                                <div>
                                    <p class="text-[10px] text-slate-400 font-bold uppercase">KI 價</p>
                                    <p class="font-black text-rose-500">{{ item.kiP }}%</p>
                                </div>
                            </div>
                        </div>
                        <button class="w-full mt-6 py-3 bg-slate-900 text-white rounded-2xl font-black text-sm hover:bg-blue-600 transition shadow-lg">查看觀察日詳情</button>
                    </div>
                </div>

                <!-- 底部進度條：以表現最差的標的為基準 -->
                <div class="mt-8 pt-6 border-t border-slate-50">
                    <div class="flex justify-between items-end mb-2">
                        <p class="text-xs font-black uppercase text-slate-500">
                            WPU (最差標的) 表現：<span class="text-blue-600">{{ getWpu(item).code }}</span>
                        </p>
                        <p class="text-xs font-black text-bl
