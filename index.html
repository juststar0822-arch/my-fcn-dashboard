<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸Šæ–°èŠåˆ†è¡Œ - FCN æ——è‰¦ç›£æ§ç³»çµ±</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        [v-cloak] { display: none; }
        .exit-glow { animation: exit-pulse 2s infinite; border: 3px solid #10b981; }
        @keyframes exit-pulse { 0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(16, 185, 129, 0); } 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); } }
        .ki-glow { border: 2px solid #ef4444; box-shadow: inset 0 0 15px rgba(239, 68, 68, 0.2); }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body class="bg-[#0f172a] text-slate-100 font-sans tracking-tight">
    <div id="app" v-cloak class="min-h-screen flex flex-col md:flex-row">
        
        <!-- å·¦å´å°èˆªå°è¦½ -->
        <div class="w-full md:w-80 bg-[#1e293b] p-6 border-b md:border-r border-slate-700 flex flex-col shadow-2xl overflow-y-auto">
            <div class="flex items-center gap-4 mb-10">
                <div class="w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center shadow-xl"><i class="fa-solid fa-gem text-white text-xl"></i></div>
                <div><h1 class="text-2xl font-black text-white italic">ä¸Šæ–°èŠåˆ†è¡Œ</h1><p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">FCN Intelligent Monitor</p></div>
            </div>

            <nav class="space-y-3 flex-1">
                <div @click="view = 'branch'" :class="navClass(view === 'branch')"><i class="fa-solid fa-house-chimney w-6"></i> åˆ†è¡Œç¸½è¦½</div>
                <div @click="view = 'alerts'" :class="navClass(view === 'alerts')" class="relative">
                    <i class="fa-solid fa-bell w-6 text-rose-500"></i> é¢¨éšªèˆ‡å‡ºå ´ä¸­å¿ƒ
                    <span v-if="alertCount > 0" class="absolute right-4 top-4 bg-rose-600 text-[10px] px-2 py-0.5 rounded-full font-black">{{ alertCount }}</span>
                </div>
                <div @click="view = 'sales'" :class="navClass(view === 'sales')"><i class="fa-solid fa-users-viewfinder w-6 text-indigo-400"></i> ç‡Ÿæ¥­å“¡ç®¡ç†</div>
                <div @click="view = 'client'" :class="navClass(view === 'client')"><i class="fa-solid fa-user-tie w-6 text-blue-400"></i> å®¢æˆ¶æ˜ç´°ç›£æ§</div>
            </nav>

            <div class="mt-8 p-5 bg-slate-900/80 rounded-[1.5rem] border border-slate-800">
                <div class="flex items-center gap-2 text-emerald-400 mb-2 font-black italic text-xs">
                    <div class="w-2 h-2 bg-emerald-500 rounded-full animate-ping"></div> MARKET LIVE SYNC
                </div>
                <p class="text-[10px] text-slate-500 font-bold">è³‡æ–™æ¯ 60 ç§’é€é Yahoo è‡ªå‹•æ ¡æº–</p>
                <p class="text-[10px] text-blue-500 mt-1 font-mono">Last Update: {{ lastTime }}</p>
            </div>
        </div>

        <!-- å³å´ä¸»å€åŸŸ -->
        <div class="flex-1 p-4 md:p-10 overflow-y-auto bg-[#0f172a]">
            
            <!-- è¦–åœ– 1: åˆ†è¡Œç¸½è¦½ (JPY/USD åˆ†é–‹è¨ˆç®—) -->
            <div v-if="view === 'branch'" class="space-y-10 animate-fadeIn">
                <div class="flex justify-between items-end">
                    <h2 class="text-4xl font-black italic">Branch <span class="text-blue-500 italic">Snapshot</span></h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-gradient-to-br from-blue-600 via-blue-700 to-indigo-900 p-10 rounded-[2.5rem] shadow-2xl relative overflow-hidden border border-blue-400/20">
                        <i class="fa-solid fa-yen-sign absolute right-[-5%] bottom-[-10%] text-[10rem] text-white/5 rotate-12"></i>
                        <p class="text-blue-200 font-bold text-sm uppercase tracking-widest mb-2 opacity-80 italic underline underline-offset-8">JPY æ—¥å¹£è³‡ç”¢ç¸½åº«å­˜</p>
                        <h3 class="text-7xl font-black text-white italic tracking-tighter">{{ formatNum(totalJPY) }} <span class="text-2xl font-normal opacity-50 ml-2">è¬</span></h3>
                        <div class="mt-8 flex gap-4 text-xs font-bold"><span class="bg-black/20 px-4 py-2 rounded-xl backdrop-blur-md italic">æ¡ˆä»¶æ•¸: {{ jpyCount }} ç­†</span></div>
                    </div>
                    <div class="bg-gradient-to-br from-emerald-600 via-emerald-700 to-teal-900 p-10 rounded-[2.5rem] shadow-2xl relative overflow-hidden border border-emerald-400/20">
                        <i class="fa-solid fa-dollar-sign absolute right-[-5%] bottom-[-10%] text-[10rem] text-white/5 rotate-12"></i>
                        <p class="text-emerald-200 font-bold text-sm uppercase tracking-widest mb-2 opacity-80 italic underline underline-offset-8">USD ç¾é‡‘è³‡ç”¢ç¸½åº«å­˜</p>
                        <h3 class="text-7xl font-black text-white italic tracking-tighter">{{ formatNum(totalUSD) }} <span class="text-2xl font-normal opacity-50 ml-2">è¬</span></h3>
                        <div class="mt-8 flex gap-4 text-xs font-bold"><span class="bg-black/20 px-4 py-2 rounded-xl backdrop-blur-md italic">æ¡ˆä»¶æ•¸: {{ usdCount }} ç­†</span></div>
                    </div>
                </div>
            </div>

            <!-- è¦–åœ– 2: é è­¦èˆ‡å‡ºå ´ä¸­å¿ƒ -->
            <div v-if="view === 'alerts'" class="space-y-10 animate-fadeIn">
                <h2 class="text-3xl font-black italic text-white tracking-tighter">Status & <span class="text-emerald-500 italic">Exit Center</span></h2>
                <div class="grid grid-cols-1 gap-8">
                    <!-- å³å°‡å‡ºå ´ (All Stocks > KO) -->
                    <div class="bg-emerald-600/10 p-8 rounded-[2.5rem] border-2 border-emerald-500/50 shadow-2xl shadow-emerald-500/10">
                        <h4 class="text-2xl font-black text-emerald-400 mb-6 flex items-center gap-3 italic"><i class="fa-solid fa-flag-checkered"></i> ğŸ† å³å°‡è´–å›å‡ºå ´ (æ‰€æœ‰æ¨™çš„é” KO)</h4>
                        <div v-if="exitList.length === 0" class="text-slate-600 py-10 text-center italic text-xl">ç›®å‰ç„¡ç¬¦åˆå‡ºå ´æ¢ä»¶ä¹‹æ¡ˆä»¶</div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div v-for="c in exitList" @click="goClient(c.client)" class="p-6 bg-emerald-500/20 rounded-3xl border-2 border-emerald-400/50 cursor-pointer hover:bg-emerald-500/30 transition-all exit-glow">
                                <div class="flex justify-between items-center"><span class="text-2xl font-black text-white">{{c.client}}</span><span class="bg-white text-emerald-700 text-xs px-3 py-1 rounded-full font-black italic">READY TO EXIT</span></div>
                                <p class="text-xs text-emerald-300 mt-2 font-bold">{{c.sn}} | åº«å­˜: {{formatNum(c.amount)}} {{c.currency}} è¬</p>
                            </div>
                        </div>
                    </div>
                    <!-- KO é è­¦ (At least one stock > KO) -->
                    <div class="bg-blue-600/10 p-8 rounded-[2.5rem] border-2 border-blue-500/30 shadow-xl">
                        <h4 class="text-2xl font-black text-blue-400 mb-6 flex items-center gap-3 italic"><i class="fa-solid fa-bullhorn"></i> ğŸ”” KO ç²åˆ©é è­¦ (éƒ¨åˆ†æ¨™çš„å·²é”æ¨™)</h4>
                        <div v-if="koAlertList.length === 0" class="text-slate-600 py-10 text-center italic">ç›®å‰ç„¡éƒ¨åˆ†æ¨™çš„é” KO ä¹‹æ¡ˆä»¶</div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div v-for="c in koAlertList" @click="goClient(c.client)" class="p-5 bg-blue-500/10 rounded-3xl border border-blue-500/20 cursor-pointer">
                                <p class="font-black text-lg text-white">{{c.client}}</p>
                                <p class="text-[10px] text-blue-400 font-bold mt-1 italic">{{c.sn}}</p>
                            </div>
                        </div>
                    </div>
                    <!-- KI é è­¦ -->
                    <div class="bg-rose-600/10 p-8 rounded-[2.5rem] border-2 border-rose-500/30 shadow-xl">
                        <h4 class="text-2xl font-black text-rose-500 mb-6 flex items-center gap-3 italic"><i class="fa-solid fa-triangle-exclamation"></i> âš ï¸ KI é¢¨éšªè­¦ç¤º (æ¨™çš„è·Œç ´ä¸‹é™)</h4>
                        <div v-if="kiList.length === 0" class="text-slate-600 py-10 text-center italic">ç›®å‰ç„¡è§¸åŠ KI æ¡ˆä»¶</div>
                        <div v-for="c in kiList" @click="goClient(c.client)" class="p-5 bg-rose-500/10 rounded-3xl border border-rose-500/20 cursor-pointer flex justify-between items-center">
                            <div><p class="font-black text-lg text-white">{{c.client}}</p><p class="text-[10px] text-rose-400 font-bold italic">{{c.sn}}</p></div>
                            <span class="bg-rose-600 text-white text-[10px] font-black px-2 py-1 rounded italic animate-pulse">KI BREACHED</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è¦–åœ– 3: å€‹åˆ¥å®¢æˆ¶æ˜ç´°ç›£æ§ -->
            <div v-if="view === 'client'" class="space-y-10 animate-fadeIn">
                <div class="flex flex-col lg:flex-row justify-between items-center gap-6">
                    <h2 class="text-3xl font-black italic tracking-tighter">Client <span class="text-blue-500 italic">Portfolio</span></h2>
                    <select v-model="selectedClient" class="bg-slate-800 p-4 rounded-2xl border border-slate-700 font-black text-white w-full lg:w-80 outline-none text-lg">
                        <option v-for="n in clientNames" :value="n">{{ n }}</option>
                    </select>
                </div>

                <div v-for="item in filteredClientList" :key="item.id" class="bg-[#1e293b] rounded-[3rem] p-8 md:p-12 border border-slate-700 shadow-2xl relative overflow-hidden transition-all duration-500" :class="itemStatusClass(item)">
                    <div class="absolute right-[-2%] top-[-5%] text-[15rem] font-black text-white/[0.02] uppercase italic select-none">{{item.currency}}</div>
                    
                    <!-- å¡ç‰‡é ‚éƒ¨è³‡è¨Š -->
                    <div class="flex flex-col lg:flex-row justify-between gap-8 mb-12 relative z-10">
                        <div class="flex items-center gap-6">
                            <div class="w-24 h-24 bg-gradient-to-tr from-blue-600 to-indigo-700 rounded-3xl flex items-center justify-center font-black text-5xl text-white shadow-2xl shadow-blue-900/40 italic">{{ item.client[0] }}</div>
                            <div>
                                <h4 class="text-4xl font-black text-white tracking-tighter">{{ item.client }}</h4>
                                <div class="flex flex-wrap gap-3 mt-4">
                                    <span class="text-xs bg-slate-800 text-slate-400 px-3 py-1.5 rounded-xl font-black uppercase tracking-widest border border-slate-700">{{ item.sn }}</span>
                                    <span class="text-xs bg-indigo-900/50 text-indigo-300 px-3 py-1.5 rounded-xl font-black italic border border-indigo-500/30 underline decoration-indigo-400 underline-offset-4">é…æ¯: {{ item.coupon }}%</span>
                                    <span class="text-xs bg-slate-800/80 text-slate-500 px-3 py-1.5 rounded-xl font-black italic border border-slate-700">æ¥­å‹™: {{ item.sales }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 lg:grid-cols-1 gap-6 text-right">
                            <div class="bg-black/40 px-8 py-6 rounded-[2rem] border border-slate-700 min-w-[250px] shadow-inner">
                                <p class="text-xs text-slate-500 font-black uppercase tracking-widest mb-2">åº«å­˜é‡‘é¡ ({{ item.currency }})</p>
                                <p class="text-5xl font-black text-white font-mono italic tracking-tighter">{{ formatNum(item.amount) }} <span class="text-xl font-normal opacity-40 ml-1">è¬</span></p>
                            </div>
                            <div class="grid grid-cols-2 gap-4 text-center">
                                <div class="bg-slate-800 p-3 rounded-2xl border border-slate-700"><p class="text-[9px] text-slate-500 font-bold uppercase mb-1">ä¸‹å–®æ—¥</p><p class="text-xs font-black text-slate-300 italic tracking-widest">{{item.date}}</p></div>
                                <div class="bg-slate-800 p-3 rounded-2xl border border-slate-700"><p class="text-[9px] text-slate-500 font-bold uppercase mb-1">åˆ°æœŸæ—¥</p><p class="text-xs font-black text-slate-300 italic tracking-widest">{{item.expiry}}</p></div>
                            </div>
                        </div>
                    </div>

                    <!-- æ¨™çš„æ¸…å–® -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6 relative z-10">
                        <div v-for="s in item.stocks" :key="s.code" class="bg-slate-900/80 p-6 rounded-[2.5rem] border border-slate-800 transition-all duration-500 hover:scale-105" :class="stockStatusClass(item, s)">
                            <div class="flex justify-between items-center mb-6">
                                <span class="font-black text-blue-400 text-xl tracking-tighter font-mono italic underline decoration-blue-500/50 decoration-4">{{ s.code }}</span>
                                <span :class="perfBadgeClass(item, s)" class="text-[10px] font-black px-3 py-1.5 rounded-xl shadow-lg italic shadow-black/20">{{ getPerf(item, s) }}%</span>
                            </div>
                            <div class="space-y-6">
                                <div>
                                    <p class="text-[9px] text-slate-500 font-black uppercase tracking-[0.2em] mb-2 italic">YAHOO å³æ™‚å ±åƒ¹</p>
                                    <p class="text-4xl font-mono font-black italic tracking-tighter" :class="s.color || (getPerf(item, s) >= item.koP ? 'text-emerald-400' : 'text-white')">{{ formatNum(s.current) }}</p>
                                </div>
                                <div class="grid grid-cols-2 gap-4 pt-4 border-t border-slate-800/50">
                                    <div><p class="text-[9px] text-emerald-500/60 font-black uppercase mb-1 tracking-widest">KO åƒ¹æ ¼</p><p class="text-sm font-mono font-bold text-slate-400">{{ formatNum(s.ko) }}</p></div>
                                    <div class="text-right" v-if="item.kiP > 0">
                                        <p class="text-[9px] text-rose-500/60 font-black uppercase mb-1 tracking-widest">KI ä¸‹é™</p>
                                        <p class="text-sm font-mono font-bold text-rose-600/80">{{ formatNum(s.ko * (item.kiP / item.koP)) }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Worst-of æŒ‡é‡ (å¤§å­—ç‰ˆ) -->
                    <div class="mt-12 pt-10 border-t border-slate-700 relative z-10 flex flex-col md:flex-row justify-between items-end gap-6">
                        <div class="w-full flex-1">
                            <div class="flex justify-between items-end mb-4">
                                <div class="flex items-center gap-3"><div class="w-3 h-3 rounded-full bg-blue-500 animate-pulse"></div><p class="text-sm font-black italic text-slate-400 tracking-widest">åŸºæº–æ¨™çš„ (WPU): <span class="text-blue-500 underline decoration-2">{{ getWpu(item).code }}</span></p></div>
                                <p class="text-2xl font-black font-mono italic text-blue-500 tracking-tighter">Performance: {{ getPerf(item, getWpu(item)) }}%</p>
                            </div>
                            <div class="h-2 w-full bg-slate-900 rounded-full relative overflow-hidden flex border border-slate-800 shadow-inner">
                                <div v-if="item.kiP > 0" class="h-full bg-rose-500/20 border-r-2 border-rose-600/50" :style="{width: item.kiP + '%'}"></div>
                                <div class="absolute h-full w-1 bg-emerald-500 shadow-[0_0_15px_#10b981] z-10" :style="{left: item.koP + '%'}"></div>
                                <div class="absolute top-0 h-full w-2 bg-white shadow-[0_0_20px_#fff] transition-all duration-1000 z-20" :style="{left: getPerf(item, getWpu(item)) + '%'}"></div>
                            </div>
                            <div class="flex justify-between mt-3 text-[10px] font-black uppercase tracking-[0.25em] text-slate-600">
                                <span class="text-rose-600">KI ä¸‹é™åƒ¹ ({{item.kiP || 'NA'}}%)</span>
                                <span>Strike Price ({{item.strikeP}}%)</span>
                                <span class="text-emerald-500">KO è´–å›åƒ¹ ({{item.koP}}%)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è¦–åœ– 4: ç‡Ÿæ¥­å“¡åˆ†é¡ -->
            <div v-if="view === 'sales'" class="space-y-10 animate-fadeIn">
                <h2 class="text-3xl font-black italic text-white tracking-tighter underline underline-offset-[12px] decoration-indigo-500/50">Sales Performance <span class="text-indigo-500">Classification</span></h2>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div v-for="(list, sales) in groupedBySales" :key="sales" class="bg-[#1e293b] p-8 rounded-[2.5rem] border border-slate-700 shadow-xl">
                        <div class="flex justify-between items-center mb-8"><h4 class="text-2xl font-black text-indigo-400 italic">{{ sales }}</h4><span class="text-[10px] font-black bg-slate-800 px-3 py-1.5 rounded-xl border border-slate-700 text-slate-500 italic">{{ list.length }} ACTIVE DEALS</span></div>
                        <div class="space-y-4">
                            <div v-for="c in list" @click="goClient(c.client)" class="p-6 bg-[#0f172a]/50 rounded-3xl hover:bg-indigo-600/10 cursor-pointer border-2 border-transparent hover:border-indigo-500/30 transition-all flex justify-between items-center shadow-inner group">
                                <div><p class="font-black text-lg text-slate-100 group-hover:text-indigo-300 transition-colors tracking-tight">{{c.client}}</p><p class="text-[9px] text-slate-500 font-black mt-1 tracking-widest">{{c.sn}}</p></div>
                                <div class="text-right"><p class="text-lg font-mono font-black italic tracking-tighter" :class="c.currency==='USD'?'text-emerald-400':'text-blue-400'">{{formatNum(c.amount)}}</p><p class="text-[10px] text-slate-600 font-bold uppercase italic">{{c.currency}} è¬</p></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue
        createApp({
            data() {
                return {
                    view: 'branch', selectedClient: 'å³æŸè¼', lastTime: '-',
                    inventory: [
                        {id:1, client:'å³æŸè¼', sn:'SNUBSELN01051', currency:'JPY', amount:5300, date:'2026/01/06', expiry:'2026/07/17', stocks:[{code:'6146.T', ko:51490, current:56880}, {code:'6501.T', ko:5173, current:5124}, {code:'7011.T', ko:4047, current:4233}], sales:'å³å¤é”', coupon:12.76, koP:95, strikeP:70, kiP:55 },
                        {id:2, client:'æ±Ÿé›ªå¬Œ', sn:'SNUBSELN01051', currency:'JPY', amount:200, date:'2026/01/06', expiry:'2026/07/17', stocks:[{code:'6146.T', ko:51490, current:56880}, {code:'6501.T', ko:5173, current:5124}, {code:'7011.T', ko:4047, current:4233}], sales:'é™³é›…éˆ´', coupon:12.76, koP:95, strikeP:70, kiP:55 },
                        {id:4, client:'é™³æ½¤çº“', sn:'SNJPMELN01153', currency:'USD', amount:33, date:'2026/01/02', expiry:'2026/07/15', stocks:[{code:'NVDA', ko:189, current:189}, {code:'TSLA', ko:438, current:431}, {code:'TSM', ko:320, current:319}], sales:'è³´å©‰ç”„', coupon:18.00, koP:100, strikeP:80.76, kiP:0 },
                        {id:5, client:'åŠ‰ä»‹æ­£', sn:'SNJPMELN01155', currency:'USD', amount:2, date:'2026/01/02', expiry:'2026/10/14', stocks:[{code:'AMD', ko:223, current:210}, {code:'NVDA', ko:189, current:189}, {code:'TSM', ko:320, current:319}], sales:'é»ƒæ€å©·', coupon:11.53, koP:100, strikeP:75, kiP:65 },
                        {id:6, client:'æ±Ÿé›ªå¬Œ', sn:'SNNOELN01419', currency:'USD', amount:11, date:'2025/12/31', expiry:'2026/07/10', stocks:[{code:'MU', ko:285, current:340}, {code:'NVDA', ko:187, current:189}, {code:'TSLA', ko:450, current:431}], sales:'é™³é›…éˆ´', coupon:13.91, koP:100, strikeP:75, kiP:55 },
                        {id:9, client:'æ±Ÿé›ªå¬Œ', sn:'SNUBSELN01039', currency:'USD', amount:10, date:'2025/12/29', expiry:'2026/09/11', stocks:[{code:'ARM', ko:111, current:116}, {code:'MU', ko:294, current:340}, {code:'NVDA', ko:188, current:189}, {code:'TSLA', ko:460, current:431}], sales:'é™³é›…éˆ´', coupon:19.17, koP:100, strikeP:75, kiP:65 },
                        {id:10, client:'å³é©ç²', sn:'SNUBSELN00988', currency:'JPY', amount:5300, date:'2025/12/04', expiry:'2026/06/16', stocks:[{code:'6857.T', ko:19665, current:20555}, {code:'7011.T', ko:3846, current:4233}, {code:'7012.T', ko:10146, current:11955}], sales:'å³å¤é”', coupon:13.76, koP:95, strikeP:70, kiP:60 },
                        {id:11, client:'è”¡ç‰æ¢…', sn:'SNUBSELN00988', currency:'JPY', amount:500, date:'2025/12/04', expiry:'2026/06/16', stocks:[{code:'6857.T', ko:19665, current:20555}, {code:'7011.T', ko:3846, current:4233}, {code:'7012.T', ko:10146, current:11955}], sales:'è³´ç§‹è', coupon:13.76, koP:95, strikeP:70, kiP:60 },
                        {id:14, client:'ä½‘æ˜ŒæŠ•è³‡', sn:'SNGSELN01264', currency:'JPY', amount:7000, date:'2025/12/01', expiry:'2026/06/10', stocks:[{code:'7013.T', ko:2648, current:3144}, {code:'7974.T', ko:12673, current:10215}, {code:'8035.T', ko:30681, current:37120}], sales:'å³å¤é”', coupon:12.78, koP:97, strikeP:75, kiP:65 },
                        {id:18, client:'ä½‘æ˜ŒæŠ•è³‡', sn:'SNMSELN02394', currency:'USD', amount:30, date:'2025/11/18', expiry:'2026/05/29', stocks:[{code:'AMZN', ko:223, current:242}, {code:'ARM', ko:136, current:116}, {code:'AVGO', ko:341, current:344}, {code:'TSM', ko:278, current:319}], sales:'å³å¤é”', coupon:12.26, koP:100, strikeP:75, kiP:65 },
                        {id:33, client:'å³æŸè¼', sn:'SNBARELN00369', currency:'USD', amount:30, date:'2025/10/15', expiry:'2026/04/27', stocks:[{code:'AVGO', ko:334, current:344}, {code:'DELL', ko:146, current:120}, {code:'GOOGL', ko:238, current:322}, {code:'ORCL', ko:288, current:193}], sales:'å³å¤é”', coupon:12.0, koP:95, strikeP:70.44, kiP:60 },
                        {id:36, client:'å³é©ç²', sn:'SNBARELN00334', currency:'USD', amount:30, date:'2025/10/08', expiry:'2026/04/22', stocks:[{code:'AVGO', ko:328, current:344}, {code:'GOOGL', ko:232, current:322}, {code:'META', ko:682, current:649}, {code:'ORCL', ko:274, current:193}], sales:'å³å¤é”', coupon:12.0, koP:95, strikeP:73.04, kiP:63 },
                        {id:41, client:'å³æŸè¼', sn:'SNMSELN02205', currency:'USD', amount:30, date:'2025/08/19', expiry:'2026/03/03', stocks:[{code:'AVGO', ko:295, current:344}, {code:'NFLX', ko:121, current:91}, {code:'NVDA', ko:176, current:189}, {code:'TSM', ko:233, current:319}], sales:'å³å¤é”', coupon:12.88, koP:100, strikeP:75, kiP:65 }
                    ]
                }
            },
            computed: {
                clientNames() { return [...new Set(this.inventory.map(i => i.client))].sort(); },
                totalJPY() { return this.inventory.filter(i => i.currency === 'JPY').reduce((s, i) => s + i.amount, 0); },
                totalUSD() { return this.inventory.filter(i => i.currency === 'USD').reduce((s, i) => s + i.amount, 0); },
                jpyCount() { return this.inventory.filter(i => i.currency === 'JPY').length; },
                usdCount() { return this.inventory.filter(i => i.currency === 'USD').length; },
                groupedBySales() {
                    const g = {};
                    this.inventory.forEach(i => { if (!g[i.sales]) g[i.sales] = []; g[i.sales].push(i); });
                    return g;
                },
                kiList() { return this.inventory.filter(i => i.kiP > 0 && i.stocks.some(s => parseFloat(this.getPerf(i, s)) <= i.kiP)); },
                // å…¨éƒ¨æ¨™çš„ > KO çš„æ¸…å–® (å³å°‡å‡ºå ´)
                exitList() { return this.inventory.filter(i => i.stocks.every(s => parseFloat(this.getPerf(i, s)) >= i.koP)); },
                // éƒ¨åˆ†æ¨™çš„ > KO çš„æ¸…å–® (ä½†ä¸ç¬¦åˆå…¨éƒ¨é”æ¨™)
                koAlertList() { return this.inventory.filter(i => i.stocks.some(s => parseFloat(this.getPerf(i, s)) >= i.koP) && !this.exitList.includes(i)); },
                alertCount() { return this.kiList.length + this.exitList.length; },
                filteredClientList() { return this.inventory.filter(i => i.client === this.selectedClient); }
            },
            methods: {
                formatNum(n) { return Math.floor(n).toLocaleString(); },
                getPerf(item, s) { return ((s.current / s.ko) * item.koP).toFixed(2); },
                perfBadgeClass(item, s) {
                    const p = this.getPerf(item, s);
                    if (p >= item.koP) return 'bg-emerald-500 text-white';
                    if (item.kiP > 0 && p <= item.kiP) return 'bg-rose-500 text-white animate-pulse shadow-[0_0_15px_#f43f5e]';
                    return 'bg-blue-600/20 text-blue-400';
                },
                itemStatusClass(item) {
                    if (this.exitList.includes(item)) return 'exit-glow bg-emerald-950/20';
                    if (this.kiList.includes(item)) return 'ki-glow bg-rose-950/20';
                    return '';
                },
                stockStatusClass(item, s) {
                    const p = this.getPerf(item, s);
                    if (p >= item.koP) return 'border-emerald-500/50 bg-emerald-500/10 shadow-lg shadow-emerald-500/10';
                    if (item.kiP > 0 && p <= item.kiP) return 'border-rose-500 shadow-lg shadow-rose-500/20';
                    return '';
                },
                getWpu(item) { return item.stocks.reduce((p, c) => (parseFloat(this.getPerf(item, p)) < parseFloat(this.getPerf(item, c)) ? p : c)); },
                navClass(active) { return `p-4 rounded-2xl cursor-pointer transition-all duration-300 flex items-center gap-3 font-black text-sm ${active ? 'bg-blue-600 text-white shadow-xl translate-x-2 shadow-blue-500/20' : 'text-slate-400 hover:bg-slate-800'}`; },
                goClient(name) { this.selectedClient = name; this.view = 'client'; },

                async fetchRealPrices() {
                    const symbols = [...new Set(this.inventory.flatMap(i => i.stocks.map(s => s.code)))];
                    try {
                        const url = `https://query1.finance.yahoo.com/v7/finance/quote?symbols=${symbols.join(',')}`;
                        const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
                        const data = await response.json();
                        const result = JSON.parse(data.contents);
                        if (result.quoteResponse && result.quoteResponse.result) {
                            const quotes = result.quoteResponse.result;
                            this.inventory.forEach(item => {
                                item.stocks.forEach(stock => {
                                    const q = quotes.find(quote => quote.symbol === stock.code);
                                    if (q) {
                                        const oldPrice = stock.current;
                                        stock.current = q.regularMarketPrice;
                                        stock.color = stock.current > oldPrice ? 'text-emerald-400' : 'text-rose-400';
                                    }
                                });
                            });
                            this.lastTime = new Date().toLocaleTimeString();
                        }
                    } catch (e) { console.error("API Error", e); }
                }
            },
            mounted() {
                this.fetchRealPrices();
                setInterval(() => this.fetchRealPrices(), 60000);
            }
        }).mount('#app')
    </script>
</body>
</html>
