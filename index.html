<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸Šæ–°èŠåˆ†è¡Œ - FCN æ ¸å¿ƒç®¡ç†ç³»çµ±</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        [v-cloak] { display: none; }
        body { background-color: #f0f2f5; color: #333; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        .fcn-card { background: white; border-radius: 28px; padding: 24px; margin-bottom: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .stock-tag { background: #f4f5f7; border-radius: 10px; padding: 6px 12px; text-align: center; min-width: 85px; }
        .nav-header { background: white; padding: 12px; border-radius: 40px; display: flex; gap: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .nav-btn { padding: 10px 20px; border-radius: 30px; font-weight: bold; color: #666; transition: 0.3s; }
        .nav-btn.active { background: #e8f0fe; color: #1a73e8; }
        .text-value { font-family: "Monaco", "Consolas", monospace; font-weight: 800; color: #111; }
        .risk-tab-container { display: flex; border-bottom: 1px solid #ddd; margin-bottom: 16px; }
        .risk-tab { padding: 10px 15px; font-weight: bold; color: #888; position: relative; }
        .risk-tab.active { color: #1a73e8; border-bottom: 3px solid #1a73e8; }
    </style>
</head>
<body class="p-4 md:p-10">
    <div id="app" v-cloak class="max-w-2xl mx-auto">
        
        <!-- é ‚éƒ¨å°èˆª -->
        <div class="nav-header sticky top-4 z-50">
            <button @click="view = 'branch'" :class="['nav-btn', view === 'branch' ? 'active' : '']">æŒ‰åˆ†è¡Œ</button>
            <button @click="view = 'client'" :class="['nav-btn', view === 'client' ? 'active' : '']">æŒ‰å®¢æˆ¶</button>
            <button @click="view = 'sales'" :class="['nav-btn', view === 'sales' ? 'active' : '']">æŒ‰æ¥­å‹™</button>
            <button @click="view = 'alerts'" :class="['nav-btn', view === 'alerts' ? 'active' : '']">é è­¦</button>
            <div class="ml-auto flex items-center px-4"><i class="fa-solid fa-rotate text-gray-400" :class="{'animate-spin': isSyncing}"></i></div>
        </div>

        <!-- 1. åˆ†è¡Œç¸½è¦½ -->
        <div v-if="view === 'branch'" class="space-y-6">
            <h2 class="text-xl font-black px-2">ä¸Šæ–°èŠåˆ†è¡Œç¸½è³‡ç”¢</h2>
            <div class="grid grid-cols-1 gap-4">
                <div class="fcn-card bg-gradient-to-br from-blue-500 to-blue-700 text-white">
                    <p class="text-xs opacity-80 font-bold uppercase tracking-widest">JPY æ—¥å¹£ç¸½åº«å­˜</p>
                    <div class="text-4xl font-black mt-2 italic">Â¥ {{ formatNum(totalJPY) }} <span class="text-sm">è¬</span></div>
                    <div class="mt-4 flex justify-between text-xs opacity-90 border-t border-white/20 pt-4 font-bold">
                        <span>ç¸½ç­†æ•¸: {{ countJPY }} ç­†</span>
                        <span>äº¤å‰²ä¸­: {{ settlingJPY }} ç­†</span>
                        <span>æœˆé…æ¯: Â¥{{ formatNum(monthlyJPY) }}</span>
                    </div>
                </div>
                <div class="fcn-card bg-gradient-to-br from-emerald-500 to-emerald-700 text-white">
                    <p class="text-xs opacity-80 font-bold uppercase tracking-widest">USD ç¾é‡‘ç¸½åº«å­˜</p>
                    <div class="text-4xl font-black mt-2 italic">$ {{ formatNum(totalUSD) }} <span class="text-sm">è¬</span></div>
                    <div class="mt-4 flex justify-between text-xs opacity-90 border-t border-white/20 pt-4 font-bold">
                        <span>ç¸½ç­†æ•¸: {{ countUSD }} ç­†</span>
                        <span>äº¤å‰²ä¸­: {{ settlingUSD }} ç­†</span>
                        <span>æœˆé…æ¯: ${{ formatNum(monthlyUSD) }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. é¢¨éšªé è­¦ä¸­å¿ƒ -->
        <div v-if="view === 'alerts'" class="space-y-4">
            <div class="risk-tab-container">
                <button @click="riskSubView = 'ki'" :class="['risk-tab', riskSubView === 'ki' ? 'active' : '']">å·²è§¸åŠ KI ({{kiList.length}})</button>
                <button @click="riskSubView = 'anyKO'" :class="['risk-tab', riskSubView === 'anyKO' ? 'active' : '']">æ¨™çš„é” KO ({{anyKOList.length}})</button>
                <button @click="riskSubView = 'exit'" :class="['risk-tab', riskSubView === 'exit' ? 'active' : '']">å³å°‡å‡ºå ´ ({{readyExitList.length}})</button>
            </div>
            <div v-for="item in currentRiskList" class="fcn-card flex justify-between items-center" @click="goClient(item.client)">
                <div><p class="font-black text-lg">{{ item.client }}</p><p class="text-[10px] text-gray-400 uppercase font-bold">{{ item.sn }}</p></div>
                <i class="fa-solid fa-chevron-right text-gray-300"></i>
            </div>
        </div>

        <!-- 3. æ¥­å‹™å“¡ç®¡ç† -->
        <div v-if="view === 'sales'" class="space-y-4">
            <div class="px-2 mb-4">
                <p class="text-xs font-bold text-gray-500 mb-2">è«‹é¸å–ç‡Ÿæ¥­å“¡</p>
                <select v-model="selectedSales" class="w-full p-4 rounded-2xl bg-white border-none shadow-sm font-black text-blue-600 outline-none">
                    <option v-for="name in allSales" :value="name">{{ name }}</option>
                </select>
            </div>
            <div v-for="item in salesList" class="fcn-card flex justify-between items-center" @click="goClient(item.client)">
                <div><p class="font-black text-lg">{{ item.client }}</p><p class="text-[10px] text-gray-400 font-bold uppercase">{{ item.sn }}</p></div>
                <div class="text-right font-black italic" :class="item.amount===0?'text-gray-300':'text-gray-800'">{{ item.amount===0?'äº¤å‰²ä¸­':formatNum(item.amount) + ' ' + item.currency }}</div>
            </div>
        </div>

        <!-- 4. å®¢æˆ¶æ˜ç´° (æ ¸å¿ƒç‰ˆé¢) -->
        <div v-if="view === 'client'" class="space-y-4">
            <div class="px-2 mb-4">
                <input v-model="search" type="text" placeholder="ğŸ” æœå°‹å®¢æˆ¶å§“å" class="w-full p-4 rounded-2xl bg-white border-none shadow-sm font-bold outline-none">
            </div>

            <div v-for="item in clientList" class="fcn-card">
                <!-- æ¨™é¡Œ -->
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h3 class="text-3xl font-black tracking-tighter">{{ item.client }}</h3>
                        <div class="bg-gray-100 text-gray-500 text-[10px] px-3 py-0.5 rounded-full inline-block font-bold mt-1 tracking-widest uppercase">{{ item.sn }}</div>
                    </div>
                    <div class="text-right">
                        <span class="text-[10px] bg-indigo-50 text-indigo-500 px-2 py-1 rounded font-black italic">é…æ¯: {{ item.coupon }}%</span>
                        <p class="text-[9px] text-gray-400 font-bold mt-1">æ¥­å‹™: {{ item.sales }}</p>
                    </div>
                </div>

                <!-- æ¨™çš„å°æ¨™ç±¤åˆ— -->
                <div class="flex flex-wrap gap-2 mb-6">
                    <div v-for="s in item.stocks" :key="s.code" class="stock-tag">
                        <p class="text-[9px] font-bold text-gray-400">{{ s.code.replace('.T', '') }}</p>
                        <p class="text-sm font-black" :class="perfColor(item, s)">{{ getPerf(item, s) }}%</p>
                    </div>
                </div>

                <!-- æ•¸æ“šæ¸…å–® -->
                <div class="space-y-2 border-t border-gray-100 pt-4 text-xs font-bold text-gray-500">
                    <div class="flex justify-between"><span>é‡‘é¡: <span class="text-gray-800 font-black">{{ item.amount===0?'äº¤å‰²ä¸­':formatNum(item.amount*10000) }}</span></span><span>æœˆé ˜æ¯: <span class="text-emerald-600 font-black">${{ formatNum(calcMonthly(item)) }}</span></span></div>
                    <div class="flex justify-between"><span>ä¸‹å–®: <span class="text-gray-800">{{ item.date }}</span></span><span>åˆ°æœŸ: <span class="text-blue-600 italic">{{ item.expiry }}</span></span></div>
                    <div class="flex justify-between text-[10px] bg-gray-50 p-2 rounded-lg mt-2">
                        <span>KO: {{ item.koP }}%</span>
                        <span>PUT (å±¥ç´„): {{ item.strikeP }}%</span>
                        <span :class="{'text-rose-500': hasKI(item)}">KI: {{ item.kiP }}%</span>
                        <span class="text-gray-400">è§€å¯Ÿæ—¥: {{ item.koStart }}</span>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        const { createApp } = Vue
        createApp({
            data() {
                return {
                    view: 'branch', riskSubView: 'ki', selectedSales: 'å³å¤é”', selectedClient: '', search: '', lastTime: '-', isSyncing: false,
                    inventory: [
                        {id:1, client:'å³æŸè¼', sn:'SNUBSELN01051', currency:'JPY', amount:5300, date:'2026/01/06', koStart:'2026/02/16', expiry:'2026/07/17', stocks:[{code:'6146.T', init:54200, current:56880}, {code:'6501.T', init:5445, current:5124}, {code:'7011.T', init:4260, current:4233}], sales:'å³å¤é”', coupon:12.76, koP:95, strikeP:70, kiP:55 },
                        {id:2, client:'æ±Ÿé›ªå¬Œ', sn:'SNUBSELN01051', currency:'JPY', amount:200, date:'2026/01/06', koStart:'2026/02/16', expiry:'2026/07/17', stocks:[{code:'6146.T', init:54200, current:56880}, {code:'6501.T', init:5445, current:5124}, {code:'7011.T', init:4260, current:4233}], sales:'é™³é›…éˆ´', coupon:12.76, koP:95, strikeP:70, kiP:55 },
                        {id:3, client:'æ±Ÿé›ªå¬Œ', sn:'SNUBSELN01051', currency:'JPY', amount:200, date:'2026/01/06', koStart:'2026/02/16', expiry:'2026/07/17', stocks:[{code:'6146.T', init:54200, current:56880}, {code:'6501.T', init:5445, current:5124}, {code:'7011.T', init:4260, current:4233}], sales:'é™³é›…éˆ´', coupon:12.76, koP:95, strikeP:70, kiP:55 },
                        {id:4, client:'é™³æ½¤çº“', sn:'SNJPMELN01153', currency:'USD', amount:33, date:'2026/01/02', koStart:'2026/02/12', expiry:'2026/07/15', stocks:[{code:'NVDA', init:189, current:189}, {code:'TSLA', init:438, current:431}, {code:'TSM', init:320, current:319}], sales:'è³´å©‰ç”„', coupon:18.00, koP:100, strikeP:80.76, kiP:0 },
                        {id:5, client:'åŠ‰ä»‹æ­£', sn:'SNJPMELN01155', currency:'USD', amount:2, date:'2026/01/02', koStart:'2026/02/09', expiry:'2026/10/14', stocks:[{code:'AMD', init:223, current:210}, {code:'NVDA', init:189, current:189}, {code:'TSM', init:320, current:319}], sales:'é»ƒæ€å©·', coupon:11.53, koP:100, strikeP:75, kiP:65 },
                        {id:6, client:'æ±Ÿé›ªå¬Œ', sn:'SNNOELN01419', currency:'USD', amount:11, date:'2025/12/31', koStart:'2026/02/09', expiry:'2026/07/10', stocks:[{code:'MU', init:285, current:340}, {code:'NVDA', init:187, current:189}, {code:'TSLA', init:450, current:431}], sales:'é™³é›…éˆ´', coupon:13.91, koP:100, strikeP:75, kiP:55 },
                        {id:7, client:'æ±Ÿé›ªå¬Œ', sn:'SNBARELN00625', currency:'USD', amount:10, date:'2025/12/31', koStart:'2026/02/09', expiry:'2026/07/13', stocks:[{code:'MU', init:285, current:340}, {code:'NVDA', init:187, current:189}, {code:'TSLA', init:450, current:431}], sales:'é™³é›…éˆ´', coupon:17.70, koP:100, strikeP:85, kiP:55 },
                        {id:8, client:'å¾å† æ¦®', sn:'SNNOELN01419', currency:'USD', amount:1, date:'2025/12/31', koStart:'2026/02/09', expiry:'2026/07/10', stocks:[{code:'MU', init:285, current:340}, {code:'NVDA', init:187, current:189}, {code:'TSLA', init:450, current:431}], sales:'å³å¤é”', coupon:13.91, koP:100, strikeP:75, kiP:55 },
                        {id:9, client:'æ±Ÿé›ªå¬Œ', sn:'SNUBSELN01039', currency:'USD', amount:10, date:'2025/12/29', koStart:'2026/02/06', expiry:'2026/09/11', stocks:[{code:'ARM', init:111, current:116}, {code:'MU', init:294, current:340}, {code:'NVDA', init:188, current:189}, {code:'TSLA', init:460, current:431}], sales:'é™³é›…éˆ´', coupon:19.17, koP:100, strikeP:75, kiP:65 },
                        {id:10, client:'å³é©ç²', sn:'SNUBSELN00988', currency:'JPY', amount:5300, date:'2025/12/04', koStart:'2026/01/13', expiry:'2026/06/16', stocks:[{code:'6857.T', init:20700, current:20555}, {code:'7011.T', init:4048, current:4233}, {code:'7012.T', init:10680, current:11955}], sales:'å³å¤é”', coupon:13.76, koP:95, strikeP:70, kiP:60 },
                        {id:11, client:'è”¡ç‰æ¢…', sn:'SNUBSELN00988', currency:'JPY', amount:500, date:'2025/12/04', koStart:'2026/01/13', expiry:'2026/06/16', stocks:[{code:'6857.T', init:20700, current:20555}, {code:'7011.T', init:4048, current:4233}, {code:'7012.T', init:10680, current:11955}], sales:'è³´ç§‹è', coupon:13.76, koP:95, strikeP:70, kiP:60 },
                        {id:12, client:'åŠ‰ä»‹æ­£', sn:'SNNOELN01366', currency:'USD', amount:2, date:'2025/12/03', koStart:'2026/01/12', expiry:'2026/06/12', stocks:[{code:'GOOG', init:321, current:322}, {code:'MU', init:234, current:340}, {code:'TSM', init:295, current:319}], sales:'é»ƒæ€å©·', coupon:15.88, koP:100, strikeP:75, kiP:60 },
                        {id:13, client:'æ±Ÿé›ªå¬Œ', sn:'SNNOELN01366', currency:'USD', amount:2, date:'2025/12/03', koStart:'2026/01/12', expiry:'2026/06/12', stocks:[{code:'GOOG', init:321, current:322}, {code:'MU', init:234, current:340}, {code:'TSM', init:295, current:319}], sales:'é™³é›…éˆ´', coupon:15.88, koP:100, strikeP:75, kiP:60 },
                        {id:14, client:'ä½‘æ˜ŒæŠ•è³‡', sn:'SNGSELN01264', currency:'JPY', amount:7000, date:'2025/12/01', koStart:'2026/01/08', expiry:'2026/06/10', stocks:[{code:'7013.T', init:2730, current:3144}, {code:'7974.T', init:13065, current:10215}, {code:'8035.T', init:31630, current:37120}], sales:'å³å¤é”', coupon:12.78, koP:97, strikeP:75, kiP:65 },
                        {id:15, client:'å³æŸè¼', sn:'SNUBSELN00980', currency:'JPY', amount:0, date:'2025/11/19', koStart:'2025/12/19', expiry:'2026/06/01', stocks:[{code:'VOD.L', init:100, current:100}], sales:'å³å¤é”', coupon:12.48, koP:95, strikeP:67.5, kiP:60 },
                        {id:16, client:'æ±Ÿé›ªå¬Œ', sn:'SNUBSELN00980', currency:'JPY', amount:0, date:'2025/11/19', koStart:'2025/12/19', expiry:'2026/06/01', stocks:[{code:'VOD.L', init:100, current:100}], sales:'é™³é›…éˆ´', coupon:12.48, koP:95, strikeP:67.5, kiP:60 },
                        {id:17, client:'æ±Ÿé›ªå¬Œ', sn:'SNUBSELN00980', currency:'JPY', amount:0, date:'2025/11/19', koStart:'2025/12/19', expiry:'2026/06/01', stocks:[{code:'VOD.L', init:100, current:100}], sales:'é™³é›…éˆ´', coupon:12.48, koP:95, strikeP:67.5, kiP:60 },
                        {id:18, client:'ä½‘æ˜ŒæŠ•è³‡', sn:'SNMSELN02394', currency:'USD', amount:30, date:'2025/11/18', koStart:'2025/12/26', expiry:'2026/05/29', stocks:[{code:'AMZN', init:223, current:242}, {code:'ARM', init:136, current:116}, {code:'AVGO', init:341, current:344}, {code:'TSM', init:278, current:319}], sales:'å³å¤é”', coupon:12.26, koP:100, strikeP:75, kiP:65 },
                        {id:19, client:'æ±Ÿé›ªå¬Œ', sn:'SNMSELN02390', currency:'JPY', amount:300, date:'2025/11/12', koStart:'2025/12/19', expiry:'2026/05/22', stocks:[{code:'5803.T', init:20075, current:21000}, {code:'6857.T', init:19830, current:20555}, {code:'8697.T', init:1797, current:1748}], sales:'é™³é›…éˆ´', coupon:15.79, koP:100, strikeP:75, kiP:60 },
                        {id:20, client:'èƒ¡å¼µç´ è“‰', sn:'SNUBSELN00963', currency:'JPY', amount:500, date:'2025/11/12', koStart:'2025/12/19', expiry:'2026/05/22', stocks:[{code:'6146.T', init:47860, current:56880}, {code:'7011.T', init:4327, current:4233}, {code:'8002.T', init:3994, current:4660}], sales:'é™³é›…éˆ´', coupon:11.07, koP:100, strikeP:75, kiP:60 },
                        {id:21, client:'æ±Ÿé›ªå¬Œ', sn:'SNMSELN02380', currency:'USD', amount:30, date:'2025/11/06', koStart:'2025/12/15', expiry:'2026/02/20', stocks:[{code:'AVGO', init:3552, current:344}, {code:'NVDA', init:1879, current:189}, {code:'OKLO', init:1066, current:98}, {code:'TSM', init:2890, current:319}], sales:'é™³é›…éˆ´', coupon:35.23, koP:999, strikeP:80, kiP:65 },
                        {id:22, client:'æéº—å¨Ÿ', sn:'SNMSELN02369', currency:'USD', amount:1, date:'2025/11/03', koStart:'2025/12/10', expiry:'2026/05/14', stocks:[{code:'ARM', init:168, current:116}, {code:'AVGO', init:362, current:344}, {code:'DELL', init:160, current:120}, {code:'ORCL', init:257, current:193}], sales:'ç‹æ·‘æ¿±', coupon:12.69, koP:95, strikeP:68.5, kiP:64 },
                        {id:23, client:'å³æŸè¼', sn:'SNMSELN02369', currency:'USD', amount:30, date:'2025/11/03', koStart:'2025/12/10', expiry:'2026/05/14', stocks:[{code:'ARM', init:168, current:116}, {code:'AVGO', init:362, current:344}, {code:'DELL', init:160, current:120}, {code:'ORCL', init:257, current:193}], sales:'å³å¤é”', coupon:12.69, koP:95, strikeP:68.5, kiP:64 },
                        {id:24, client:'åŠ‰ä»‹æ­£', sn:'SNMSELN02369', currency:'USD', amount:2, date:'2025/11/03', koStart:'2025/12/10', expiry:'2026/05/14', stocks:[{code:'ARM', init:168, current:116}, {code:'AVGO', init:362, current:344}, {code:'DELL', init:160, current:120}, {code:'ORCL', init:257, current:193}], sales:'é»ƒæ€å©·', coupon:12.69, koP:95, strikeP:68.5, kiP:64 },
                        {id:25, client:'ä½‘æ˜ŒæŠ•è³‡', sn:'SNDBSELN00251', currency:'USD', amount:30, date:'2025/10/31', koStart:'2025/12/08', expiry:'2026/05/11', stocks:[{code:'ARM', init:169, current:116}, {code:'AVGO', init:369, current:344}, {code:'DELL', init:162, current:120}, {code:'ORCL', init:262, current:193}], sales:'å³å¤é”', coupon:12.00, koP:95, strikeP:68.5, kiP:64 },
                        {id:26, client:'åŠ‰ä»‹æ­£', sn:'SNBARELN00447', currency:'USD', amount:2, date:'2025/10/30', koStart:'2025/12/08', expiry:'2026/09/11', stocks:[{code:'ARM', init:165, current:116}, {code:'NVDA', init:203, current:189}, {code:'TSM', init:303, current:319}], sales:'é»ƒæ€å©·', coupon:11.30, koP:100, strikeP:75, kiP:55 },
                        {id:27, client:'é™³ä¿ä»»', sn:'SNGSELN01175', currency:'USD', amount:1, date:'2025/10/23', koStart:'2025/12/01', expiry:'2026/05/04', stocks:[{code:'ARM', init:166, current:116}, {code:'AVGO', init:344, current:344}, {code:'DELL', init:154, current:120}, {code:'META', init:733, current:649}], sales:'ä¸å¿ƒæ¢…', coupon:13.956, koP:95, strikeP:70.5, kiP:60 },
                        {id:28, client:'å³é©ç²', sn:'SNGSELN01175', currency:'USD', amount:30, date:'2025/10/23', koStart:'2025/12/01', expiry:'2026/05/04', stocks:[{code:'ARM', init:166, current:116}, {code:'AVGO', init:344, current:344}, {code:'DELL', init:154, current:120}, {code:'META', init:733, current:649}], sales:'å³å¤é”', coupon:13.956, koP:95, strikeP:70.5, kiP:60 },
                        {id:29, client:'æ±Ÿé›ªå¬Œ', sn:'SNUBSELN00905', currency:'USD', amount:7, date:'2025/10/17', koStart:'2025/11/24', expiry:'2026/04/29', stocks:[{code:'AMZN', init:212, current:242}, {code:'ARM', init:165, current:116}, {code:'DELL', init:149, current:120}, {code:'META', init:716, current:649}], sales:'é™³é›…éˆ´', coupon:13.67, koP:95, strikeP:70, kiP:60 },
                        {id:30, client:'æ˜“å²‘æŠ•è³‡', sn:'SNUBSELN00905', currency:'USD', amount:30, date:'2025/10/17', koStart:'2025/11/24', expiry:'2026/04/29', stocks:[{code:'AMZN', init:212, current:242}, {code:'ARM', init:165, current:116}, {code:'DELL', init:149, current:120}, {code:'META', init:716, current:649}], sales:'å³å¤é”', coupon:13.67, koP:95, strikeP:70, kiP:60 },
                        {id:31, client:'è”¡ç‰æ¢…', sn:'SNGSELN01138', currency:'USD', amount:1, date:'2025/10/16', koStart:'2025/11/24', expiry:'2026/04/27', stocks:[{code:'MSFT', init:512, current:483}, {code:'NVDA', init:182, current:189}, {code:'TSM', init:300, current:319}], sales:'è³´ç§‹è', coupon:10.008, koP:100, strikeP:77.56, kiP:65 },
                        {id:32, client:'æ—éŒ«ç‰', sn:'SNGSELN01138', currency:'USD', amount:21, date:'2025/10/16', koStart:'2025/11/24', expiry:'2026/04/27', stocks:[{code:'MSFT', init:512, current:483}, {code:'NVDA', init:182, current:189}, {code:'TSM', init:300, current:319}], sales:'è³´ç§‹è', coupon:10.008, koP:100, strikeP:77.56, kiP:65 },
                        {id:33, client:'å³æŸè¼', sn:'SNBARELN00369', currency:'USD', amount:30, date:'2025/10/15', koStart:'2025/11/24', expiry:'2026/04/27', stocks:[{code:'AVGO', init:351, current:344}, {code:'DELL', init:153, current:120}, {code:'GOOGL', init:250, current:322}, {code:'ORCL', init:303, current:193}], sales:'å³å¤é”', coupon:12.00, koP:95, strikeP:70.44, kiP:60 },
                        {id:34, client:'åŠ‰ä»‹æ­£', sn:'SNBARELN00369', currency:'USD', amount:2, date:'2025/10/15', koStart:'2025/11/24', expiry:'2026/04/27', stocks:[{code:'AVGO', init:351, current:344}, {code:'DELL', init:153, current:120}, {code:'GOOGL', init:250, current:322}, {code:'ORCL', init:303, current:193}], sales:'é»ƒæ€å©·', coupon:12.00, koP:95, strikeP:70.44, kiP:60 },
                        {id:35, client:'æ±Ÿé›ªå¬Œ', sn:'SNBARELN00340', currency:'USD', amount:6, date:'2025/10/09', koStart:'2025/11/20', expiry:'2026/04/23', stocks:[{code:'ARM', init:171, current:116}, {code:'AVGO', init:345, current:344}, {code:'PLTR', init:185, current:182}, {code:'TSM', init:300, current:319}], sales:'é™³é›…éˆ´', coupon:20.64, koP:100, strikeP:75, kiP:62 },
                        {id:36, client:'å³é©ç²', sn:'SNBARELN00334', currency:'USD', amount:30, date:'2025/10/08', koStart:'2025/11/17', expiry:'2026/04/22', stocks:[{code:'AVGO', init:345, current:344}, {code:'GOOGL', init:244, current:322}, {code:'META', init:717, current:649}, {code:'ORCL', init:288, current:193}], sales:'å³å¤é”', coupon:12.00, koP:95, strikeP:73.04, kiP:63 },
                        {id:37, client:'æ—éŒ«ç‰', sn:'SNBARELN00328', currency:'USD', amount:12, date:'2025/10/08', koStart:'2025/11/17', expiry:'2026/04/22', stocks:[{code:'AVGO', init:346, current:344}, {code:'META', init:718, current:649}, {code:'ORCL', init:289, current:193}, {code:'TSM', init:305, current:319}], sales:'è³´ç§‹è', coupon:12.00, koP:100, strikeP:68.35, kiP:60 },
                        {id:38, client:'æ±Ÿé›ªå¬Œ', sn:'SNBARELN00328', currency:'USD', amount:20, date:'2025/10/08', koStart:'2025/11/17', expiry:'2026/04/22', stocks:[{code:'AVGO', init:346, current:344}, {code:'META', init:718, current:649}, {code:'ORCL', init:289, current:193}, {code:'TSM', init:305, current:319}], sales:'é™³é›…éˆ´', coupon:12.00, koP:100, strikeP:68.35, kiP:60 },
                        {id:39, client:'åŠ‰ä»‹æ­£', sn:'SNMSELN02244', currency:'USD', amount:2, date:'2025/09/12', koStart:'2025/10/20', expiry:'2026/03/24', stocks:[{code:'AMD', init:159, current:210}, {code:'META', init:756, current:649}, {code:'NVDA', init:178, current:189}, {code:'TSM', init:259, current:319}], sales:'é»ƒæ€å©·', coupon:9.12, koP:100, strikeP:75, kiP:65 },
                        {id:40, client:'é™³ä¿ä»»', sn:'SNMSELN02205', currency:'USD', amount:1, date:'2025/08/19', koStart:'2025/09/26', expiry:'2026/03/03', stocks:[{code:'AVGO', init:295, current:344}, {code:'NFLX', init:121, current:91}, {code:'NVDA', init:176, current:189}, {code:'TSM', init:233, current:319}], sales:'ä¸å¿ƒæ¢…', coupon:12.88, koP:100, strikeP:75, kiP:65 },
                        {id:41, client:'å³æŸè¼', sn:'SNMSELN02205', currency:'USD', amount:30, date:'2025/08/19', koStart:'2025/09/26', expiry:'2026/03/03', stocks:[{code:'AVGO', init:295, current:344}, {code:'NFLX', init:121, current:91}, {code:'NVDA', init:176, current:189}, {code:'TSM', init:233, current:319}], sales:'å³å¤é”', coupon:12.88, koP:100, strikeP:75, kiP:65 }
                    ]
                }
            },
            computed: {
                clientNames() { return [...new Set(this.inventory.map(i => i.client))].sort(); },
                allSales() { return [...new Set(this.inventory.map(i => i.sales))].sort(); },
                totalJPY() { return this.inventory.filter(i => i.currency === 'JPY').reduce((s, i) => s + i.amount, 0); },
                totalUSD() { return this.inventory.filter(i => i.currency === 'USD').reduce((s, i) => s + i.amount, 0); },
                settlingJPY() { return this.inventory.filter(i => i.currency === 'JPY' && i.amount === 0).length; },
                settlingUSD() { return this.inventory.filter(i => i.currency === 'USD' && i.amount === 0).length; },
                monthlyJPY() { return this.inventory.filter(i => i.currency === 'JPY').reduce((s, i) => s + this.calcMonthly(i), 0); },
                monthlyUSD() { return this.inventory.filter(i => i.currency === 'USD').reduce((s, i) => s + this.calcMonthly(i), 0); },
                countJPY() { return this.inventory.filter(i => i.currency === 'JPY').length; },
                countUSD() { return this.inventory.filter(i => i.currency === 'USD').length; },
                
                kiList() { return this.inventory.filter(i => this.hasBreachedKI(i)); },
                anyKOList() { return this.inventory.filter(i => i.stocks.some(s => s.current >= (s.init * (i.koP/100))) && !this.isReadyExit(i)); },
                readyExitList() { return this.inventory.filter(i => this.isReadyExit(i)); },
                currentRiskList() { 
                    if(this.riskSubView==='ki') return this.kiList;
                    if(this.riskSubView==='anyKO') return this.anyKOList;
                    return this.readyExitList;
                },
                alertCount() { return this.kiList.length + this.readyExitList.length; },
                clientList() { return this.inventory.filter(i => i.client.includes(this.search)); },
                salesList() { return this.inventory.filter(i => i.sales === this.selectedSales); },
                filteredClientList() { return this.inventory.filter(i => i.client === this.selectedClient || (this.search && i.client.includes(this.search))); }
            },
            methods: {
                formatNum(n) { return Math.floor(n).toLocaleString(); },
                calcMonthly(i) { return (i.amount * 10000 * i.coupon / 100) / 12; },
                getPerf(item, s) { return ((s.current / s.init) * 100).toFixed(2); },
                hasBreachedKI(item) { return item.kiP > 0 && item.stocks.some(s => parseFloat(this.getPerf(item, s)) <= item.kiP); },
                isReadyExit(item) { 
                    const started = new Date() >= new Date(item.koStart);
                    const allKO = item.stocks.every(s => s.current >= (s.init * (item.koP/100)));
                    return started && allKO;
                },
                perfColor(item, s) {
                    const p = parseFloat(this.getPerf(item, s));
                    if (p >= item.koP) return 'text-success';
                    if (p <= item.strikeP) return 'text-danger';
                    return '';
                },
                itemStatusClass(item) {
                    if (this.isReadyExit(item)) return 'exit-glow';
                    if (this.hasBreachedKI(item)) return 'ki-alert';
                    return '';
                },
                navClass(active) { return `nav-btn ${active ? 'active' : ''}`; },
                goClient(name) { this.search = name; this.view = 'client'; },
                async fetchRealPrices() {
                    this.isSyncing = true;
                    const symbols = [...new Set(this.inventory.flatMap(i => i.stocks.map(s => s.code)))];
                    try {
                        const url = `https://query1.finance.yahoo.com/v7/finance/quote?symbols=${symbols.join(',')}`;
                        const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
                        const data = await response.json();
                        const result = JSON.parse(data.contents);
                        if (result.quoteResponse?.result) {
                            const quotes = result.quoteResponse.result;
                            this.inventory.forEach(item => {
                                item.stocks.forEach(stock => {
                                    const q = quotes.find(quote => quote.symbol === stock.code);
                                    if (q) stock.current = q.regularMarketPrice;
                                });
                            });
                            this.lastTime = new Date().toLocaleTimeString();
                        }
                    } catch (e) { console.error(e); }
                    finally { this.isSyncing = false; }
                }
            },
            mounted() {
                this.fetchRealPrices();
                setInterval(() => this.fetchRealPrices(), 60000);
            }
        }).mount('#app')
    </script>
</body>
</html>
