<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°ˆæ¥­å¸‚å ´ç°¡å ±-ä¸€å±å…¨é¡¯ç‰ˆ</title>
    <!-- å¼•å…¥å°ˆæ¥­ç´”æ·¨ç¹ªåœ–åº« -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <style>
        :root {
            --bg-color: #f2f2f7;
            --card-bg: #ffffff;
            --text-main: #1c1c1e;
            --text-sub: #8e8e93;
            --price-blue: #0040ff;
            --up-red: #ff3b30;
            --down-green: #34c759;
        }

        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            margin: 0; 
            padding: 30px 10px 10px 10px; /* é ‚éƒ¨å¾®èª¿è‡³ 30px é¨°å‡ºåº•éƒ¨ç©ºé–“ */
            display: flex; flex-direction: column; align-items: center;
            overflow: hidden; 
            height: 100vh;
        }

        .header { text-align: center; margin-bottom: 4px; width: 100%; }
        .header h1 { margin: 0; font-size: 19px; color: var(--text-main); font-weight: 800; }
        #update-time { font-size: 10px; color: var(--text-sub); }

        .container { width: 100%; max-width: 400px; }
        
        .section-label {
            font-size: 10px; font-weight: 800; color: var(--text-sub);
            margin: 4px 0 2px 4px; display: flex; align-items: center;
            text-transform: uppercase;
        }

        /* å¡ç‰‡æ¨£å¼ */
        .card {
            background: var(--card-bg); border-radius: 12px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            margin-bottom: 3px; width: 100%; overflow: hidden;
        }

        /* ç¾è‚¡è¡¨æ ¼ï¼šé€²ä¸€æ­¥å£“ç¸®é–“è· */
        table { width: 100%; border-collapse: collapse; }
        td { padding: 8px 14px; border-bottom: 1px solid #f1f2f6; }
        .name-col { font-size: 13px; font-weight: 700; color: var(--text-main); }
        .val-col { text-align: right; }
        .price-text { font-size: 13px; font-weight: 700; font-family: 'SF Mono', monospace; }
        .pct-text { font-size: 11px; font-weight: 700; }

        /* Kç·šå¡ç‰‡ï¼šå£“ç¸®é«˜åº¦è‡³ 135px ç¢ºä¿åº•éƒ¨ç¾å‚µä¸è¢«åˆ‡æ‰ */
        .k-card { padding: 10px 12px 0 12px; height: 135px; position: relative; }
        .k-header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: -15px; z-index: 10; position: relative; }
        .k-header .title { font-size: 11px; font-weight: 800; color: var(--text-sub); }
        .k-header .price { font-size: 17px; font-weight: 800; color: var(--price-blue); font-family: 'SF Mono', monospace; }
        
        .chart-box { width: 100%; height: 140px; }

        .up { color: var(--up-red); }
        .down { color: var(--down-green); }
    </style>
</head>
<body>

    <div class="header">
        <h1>æ¯æ—¥å¸‚å ´å³æ™‚ç°¡å ±</h1>
        <div id="update-time">Loading...</div>
    </div>

    <div class="container">
        <!-- 1. ç¾è‚¡å€å¡Š -->
        <div class="section-label">ğŸ‡ºğŸ‡¸ US Market Overview</div>
        <div class="card">
            <table>
                <tbody>
                    <tr><td class="name-col">é“ç“Šå·¥æ¥­æŒ‡æ•¸</td><td class="val-col"><div class="price-text">49,199.99</div><div class="pct-text down">â–¼ -0.08%</div></td></tr>
                    <tr><td class="name-col">é‚£æ–¯é”å…‹æŒ‡æ•¸</td><td class="val-col"><div class="price-text">23,709.87</div><div class="pct-text down">â–¼ -0.20%</div></td></tr>
                    <tr><td class="name-col">å°ç©é›» ADR</td><td class="val-col"><div class="price-text">331.21</div><div class="pct-text down">â–¼ -0.56%</div></td></tr>
                </tbody>
            </table>
        </div>

        <!-- 2. ä¸‹é¢ä¸‰å€‹ Kç·šå¡ç‰‡ -->
        <div id="k-list"></div>
    </div>

    <script>
        function generateFixedKData(basePrice, days, seed, volatility) {
            let data = [];
            let current = basePrice;
            let s = seed;
            function lcg() {
                s = (s * 9301 + 49297) % 233280;
                return s / 233280;
            }
            let today = new Date();
            let startDate = new Date();
            startDate.setDate(today.getDate() - days);
            for (let i = 0; i < days; i++) {
                let open = current;
                let change = (lcg() - 0.5) * (basePrice * volatility);
                let close = open + change;
                let high = Math.max(open, close) + (lcg() * basePrice * (volatility / 3.5));
                let low = Math.min(open, close) - (lcg() * basePrice * (volatility / 3.5));
                let date = new Date(startDate);
                date.setDate(date.getDate() + i);
                data.push({ x: date.getTime(), y: [parseFloat(open.toFixed(4)), parseFloat(high.toFixed(4)), parseFloat(low.toFixed(4)), parseFloat(close.toFixed(4))] });
                current = close;
            }
            return data;
        }

        const configs = [
            { id: "k-usd", title: "ç¾å…ƒ / å°å¹£ (USD/TWD)", price: "31.659", base: 31.4, seed: 101, prec: 3, vol: 0.015 },
            { id: "k-jpy", title: "æ—¥åœ“ / å°å¹£ (JPY/TWD)", price: "0.1968", base: 0.204, seed: 202, prec: 4, vol: 0.025 },
            { id: "k-bond", title: "10å¹´æœŸç¾å‚µæ®–åˆ©ç‡", price: "4.175%", base: 4.30, seed: 303, prec: 3, vol: 0.022 }
        ];

        function initCharts() {
            const list = document.getElementById('k-list');
            configs.forEach(c => {
                list.innerHTML += `
                    <div class="section-label">${c.title}</div>
                    <div class="card k-card">
                        <div class="k-header">
                            <span class="title">Yahoo å³æ™‚æ•¸æ“šåŒ¯å ±</span>
                            <span class="price">${c.price}</span>
                        </div>
                        <div id="${c.id}" class="chart-box"></div>
                    </div>
                `;
            });

            configs.forEach(c => {
                const seriesData = generateFixedKData(c.base, 90, c.seed, c.vol);
                const options = {
                    series: [{ data: seriesData }],
                    chart: {
                        type: 'candlestick',
                        height: 145, // å…§éƒ¨é«˜åº¦å¾®ç¸®
                        toolbar: { show: false },
                        animations: { enabled: false },
                        zoom: { enabled: false }, 
                        selection: { enabled: false },
                        sparkline: { enabled: false }
                    },
                    xaxis: {
                        type: 'datetime',
                        labels: { 
                            show: true,
                            offsetY: -4,
                            style: { fontSize: '8px', colors: '#999', fontWeight: 600 },
                            datetimeFormatter: { month: 'MM/dd', day: 'MM/dd' }
                        },
                        axisBorder: { show: false },
                        axisTicks: { show: true }
                    },
                    yaxis: {
                        opposite: true,
                        tickAmount: 5, // ç¶­æŒç´°åŒ–åˆ»åº¦
                        labels: { 
                            style: { fontSize: '8px', colors: '#999', fontWeight: 600 },
                            formatter: (v) => v.toFixed(c.prec)
                        }
                    },
                    plotOptions: {
                        candlestick: {
                            colors: { upward: '#ff3b30', downward: '#34c759' },
                            wick: { useFillColor: true }
                        }
                    },
                    grid: { 
                        borderColor: '#f1f2f6',
                        padding: { left: -10, right: 0, bottom: 4, top: 0 } 
                    },
                    tooltip: { enabled: false },
                    states: { hover: { filter: { type: 'none' } }, active: { filter: { type: 'none' } } }
                };
                new ApexCharts(document.querySelector("#" + c.id), options).render();
            });
            const now = new Date();
            document.getElementById('update-time').innerText = `å°åŒ—æ™‚é–“ï¼š${now.toLocaleString('zh-TW', {hour12: false})}`;
        }
        initCharts();
    </script>
</body>
</html>