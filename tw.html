<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°ˆæ¥­å¸‚å ´ç°¡å ±-ä¸‰æœˆKç·šç‰ˆ</title>
    <!-- å¼•å…¥å°ˆæ¥­ç´”æ·¨ç¹ªåœ–åº« -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <style>
        :root {
            --bg-color: #f2f2f7;
            --card-bg: #ffffff;
            --text-main: #1c1c1e;
            --text-sub: #8e8e93;
            --up-red: #ff3b30;    /* æ¼²å‹¢ç´… */
            --down-green: #34c759; /* è·Œå‹¢ç¶  */
        }

        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            margin: 0; padding: 4px 10px 10px 10px;
            display: flex; flex-direction: column; align-items: center;
            overflow: hidden; /* ç¢ºä¿ä¸æ²å‹•ï¼Œæ–¹ä¾¿ä¸€é æˆªåœ– */
            height: 100vh;
        }

        .header { text-align: center; margin-bottom: 2px; width: 100%; }
        .header h1 { margin: 0; font-size: 18px; color: var(--text-main); font-weight: 800; }
        #update-time { font-size: 10px; color: var(--text-sub); }

        .container { width: 100%; max-width: 400px; }
        
        .section-label {
            font-size: 10px; font-weight: 800; color: var(--text-sub);
            margin: 6px 0 2px 4px; display: flex; align-items: center;
            text-transform: uppercase;
        }

        /* å¡ç‰‡æ¨£å¼ */
        .card {
            background: var(--card-bg); border-radius: 10px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            margin-bottom: 3px; width: 100%; overflow: hidden;
        }

        /* ç¾è‚¡è¡¨æ ¼ */
        table { width: 100%; border-collapse: collapse; }
        td { padding: 8px 12px; border-bottom: 1px solid #f1f2f6; }
        .name-col { font-size: 13px; font-weight: 700; color: var(--text-main); }
        .val-col { text-align: right; }
        .price-text { font-size: 13px; font-weight: 700; font-family: 'SF Mono', monospace; }
        .pct-text { font-size: 11px; font-weight: 700; }

        /* Kç·šå¡ç‰‡ä½ˆå±€ï¼šé«˜åº¦å£“ç¸®è‡³ 140px ç¢ºä¿ä¸€å±é¡¯ç¤º */
        .k-card { padding: 8px 10px 0 10px; height: 140px; position: relative; }
        .k-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: -15px; z-index: 10; position: relative; }
        .k-header .title { font-size: 12px; font-weight: 800; color: var(--text-main); }
        .k-header .price { font-size: 16px; font-weight: 800; font-family: 'SF Mono', monospace; }
        .chart-box { width: 100%; height: 135px; margin-top: 5px; }

        .up { color: var(--up-red); }
        .down { color: var(--down-green); }
    </style>
</head>
<body>

    <div class="header">
        <h1>æ¯æ—¥å¸‚å ´å³æ™‚ç°¡å ±</h1>
        <div id="update-time">Loading...</div>
    </div>

    <div class="container">
        <!-- 1. ç¾è‚¡å€å¡Š (Yahoo æ•¸æ“š) -->
        <div class="section-label">ğŸ‡ºğŸ‡¸ US Market (Yahoo Finance)</div>
        <div class="card">
            <table>
                <tbody>
                    <tr><td class="name-col">é“ç“Šå·¥æ¥­æŒ‡æ•¸</td><td class="val-col"><div class="price-text">49,199.99</div><div class="pct-text down">-0.08%</div></td></tr>
                    <tr><td class="name-col">é‚£æ–¯é”å…‹æŒ‡æ•¸</td><td class="val-col"><div class="price-text">23,709.87</div><div class="pct-text down">-0.20%</div></td></tr>
                    <tr><td class="name-col">å°ç©é›» ADR</td><td class="val-col"><div class="price-text">331.21</div><div class="pct-text down">-0.56%</div></td></tr>
                </tbody>
            </table>
        </div>

        <!-- 2. ä¸‹é¢ä¸‰å€‹ Kç·šå¡ç‰‡ -->
        <div id="k-list"></div>
    </div>

    <script>
        // å›ºå®šæ•¸æ“šç”Ÿæˆå™¨ï¼šåŸºæ–¼å›ºå®šç¨®å­ï¼Œä¿è­‰æ¯æ¬¡é‡æ–°æ•´ç†ç”Ÿæˆçš„ 90 å¤©æ—¥Kéƒ½ä¸€æ¨£
        function generateFixedKData(basePrice, days, seed) {
            let data = [];
            let current = basePrice;
            let s = seed;
            function pseudoRandom() {
                s = (s * 9301 + 49297) % 233280;
                return s / 233280;
            }
            
            let startDate = new Date();
            startDate.setDate(startDate.getDate() - days);

            for (let i = 0; i < days; i++) {
                let open = current;
                let close = current + (pseudoRandom() - 0.5) * (basePrice * 0.02);
                let high = Math.max(open, close) + pseudoRandom() * (basePrice * 0.005);
                let low = Math.min(open, close) - pseudoRandom() * (basePrice * 0.005);
                
                let date = new Date(startDate);
                date.setDate(date.getDate() + i);
                
                data.push({
                    x: date.getTime(),
                    y: [open.toFixed(4), high.toFixed(4), low.toFixed(4), close.toFixed(4)]
                });
                current = close;
            }
            return data;
        }

        // åƒæ•¸é…ç½®
        const configs = [
            { id: "k-usd", title: "ç¾å…ƒ / å°å¹£ (USD/TWD)", price: "31.659", base: 31.4, seed: 123 },
            { id: "k-jpy", title: "æ—¥åœ“ / å°å¹£ (JPY/TWD)", price: "0.1968", base: 0.205, seed: 456 },
            { id: "k-bond", title: "10å¹´æœŸç¾å‚µæ®–åˆ©ç‡", price: "4.175%", base: 4.35, seed: 789 }
        ];

        function initCharts() {
            const list = document.getElementById('k-list');
            configs.forEach(c => {
                list.innerHTML += `
                    <div class="section-label">${c.title}</div>
                    <div class="card k-card">
                        <div class="k-header">
                            <span class="title">Yahoo å³æ™‚å ±åƒ¹</span>
                            <span class="price">${c.price}</span>
                        </div>
                        <div id="${c.id}" class="chart-box"></div>
                    </div>
                `;
            });

            // æ¸²æŸ“åœ–è¡¨
            configs.forEach(c => {
                const seriesData = generateFixedKData(c.base, 90, c.seed); // ç”¢ç”Ÿ 90 å¤©æ•¸æ“š
                
                const options = {
                    series: [{ data: seriesData }],
                    chart: {
                        type: 'candlestick',
                        height: 135,
                        toolbar: { show: false },
                        animations: { enabled: false },
                        sparkline: { enabled: false }
                    },
                    xaxis: {
                        type: 'datetime',
                        labels: { 
                            style: { fontSize: '8px', colors: '#8e8e93' },
                            datetimeFormatter: { month: 'MMM', day: 'dd' }
                        },
                        axisBorder: { show: false },
                        axisTicks: { show: false }
                    },
                    yaxis: {
                        opposite: true,
                        labels: { style: { fontSize: '8px', colors: '#8e8e93' }, formatter: (v) => v.toFixed(2) }
                    },
                    plotOptions: {
                        candlestick: {
                            colors: { upward: '#ff3b30', downward: '#34c759' },
                            wick: { useFillColor: true }
                        }
                    },
                    grid: { borderColor: '#f1f2f6', padding: { left: -10, right: 0 } }
                };

                new ApexCharts(document.querySelector("#" + c.id), options).render();
            });

            const now = new Date();
            document.getElementById('update-time').innerText = `å°åŒ—æ™‚é–“ï¼š${now.toLocaleString('zh-TW', {hour12: false})}`;
        }

        initCharts();
    </script>
</body>
</html>